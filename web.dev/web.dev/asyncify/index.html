<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><style>@charset "UTF-8";@keyframes unsupported-appear{0%,to{visibility:hidden}}@keyframes hold-visibility{0%,to{visibility:visible}}@keyframes loading-progress-before{0%{transform:translate(-50%)}to{transform:translate(100vw) translate(-50%)}}@keyframes equalizer-morph{0%{transform:scaleY(1)}25%{transform:scaleY(.3)}50%{transform:scaleY(.7)}75%{transform:scaleY(.15)}}.overflow-hidden{overflow:hidden}*,::after,::before{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}:focus{outline:1px solid #3740ff}.w-force-focus{outline:0!important}div,form,li,ol,ul{margin:0;padding:0}input,q{hyphens:none}code,input,q{-moz-hyphens:none;-webkit-hyphens:none}:not([href])[id]::before{content:" ";display:block;height:calc(64px + 1.5rem);margin-top:calc(-64px - 1.5rem);pointer-events:none;visibility:hidden}:root{--flow-space:1em}body,html{font:400 12px/1.5 Segoe UI,system-ui,-apple-system,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;margin:0;overflow-wrap:break-word;padding:0;word-wrap:break-word}@media (min-width:241px){body,html{font:400 14px/1.5 Segoe UI,system-ui,-apple-system,sans-serif}}@media (min-width:321px){body,html{font:400 16px/1.5 Segoe UI,system-ui,-apple-system,sans-serif}}h1,h2,h3{color:#202124;margin:0;overflow:visible}h3,h4{font:500 13.5px/1.4814814815 "Google Sans",sans-serif}h4{margin:0;overflow:visible;margin-top:24px;margin-bottom:6px;color:#5f6368}h1{font:500 38px/1.3157894737 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:9px}@media (min-width:241px){h1{font:500 49px/1.3265306122 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:10px}}@media (min-width:321px){h1{font:500 56px/1.3214285714 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:11px}}h2{font:400 18px/1.3333333333 "Google Sans",sans-serif;margin-top:48px;margin-bottom:24px}@media (min-width:241px){h2{font:400 21px/1.3333333333 "Google Sans",sans-serif;margin-top:56px;margin-bottom:28px}}@media (min-width:321px){h2{font:400 24px/1.3333333333 "Google Sans",sans-serif;margin-top:64px;margin-bottom:32px}}h3{margin-top:36px;margin-bottom:12px}@media (min-width:241px){h3{font:500 16px/1.375 "Google Sans",sans-serif;margin-top:42px;margin-bottom:14px}}@media (min-width:321px){h3{font:500 20px/1.2 "Google Sans",sans-serif;margin-top:48px;margin-bottom:16px}}@media (min-width:241px){h4{font:500 16px/.9375 "Google Sans",sans-serif;margin-top:28px;margin-bottom:7px}}@media (min-width:321px){h4{font:500 19px/1.0526315789 "Google Sans",sans-serif;margin-top:32px;margin-bottom:10px}}p{font:400 13.5px/1.5555555556 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:27px;margin-bottom:27px}@media (min-width:241px){p{font:400 15px/1.8666666667 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:31.5px;margin-bottom:31.5px}}@media (min-width:321px){p{font:400 18px/1.7777777778 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:36px;margin-bottom:36px}}h1+*,h1+[class],h2+*,h2+[class],h3+*,h3+[class],h4+*,h4+[class]{margin-top:0}cite,em{font-style:italic}strong{font-weight:500}main{padding-bottom:64px}@media print{main{padding-bottom:0}}img{-ms-interpolation-mode:bicubic;display:inline-block;height:auto;max-width:100%;vertical-align:middle}input[type=email],input[type=text]{border:1px solid #dadce0;font:inherit;font-size:inherit;padding:14px 8px;width:100%}input[type=email]:focus,input[type=text]:focus{border-color:#3740ff;outline:0}input[type=radio]{-moz-appearance:none;-webkit-appearance:none;appearance:none;border:2px solid #dadce0;border-radius:50%;cursor:pointer;flex-shrink:0;height:24px;margin:2px;width:24px}input[type=radio]:checked{background-clip:content-box;background-color:#3740ff;border:2px solid #3740ff;padding:4px}a{color:#3740ff;text-decoration:none}a:active,a:focus,a:hover{text-decoration:underline}a:active,a:focus{outline:1px solid #3740ff}.w-post-content :link,.w-post-content :visited,.w-post-content a{text-decoration:underline}.w-post-content :link:active,.w-post-content :link:focus,.w-post-content :link:hover,.w-post-content :visited:active,.w-post-content :visited:focus,.w-post-content :visited:hover,.w-post-content a:active,.w-post-content a:focus,.w-post-content a:hover{text-decoration:none}p :link:active,p :visited:active,p a:active{background-color:rgba(55,64,255,.16)}a code{color:#3740ff}ol:not([class]),ul:not([class]){list-style:none;margin:32px 0;position:relative}ol:not([class]){counter-reset:ol-step-counter;padding-left:32px}ol:not([class])>li{counter-increment:ol-step-counter}ol:not([class])>li::before,ul:not([class])>li::before{background:#5f6368;border-radius:50%;color:#fff;left:0;position:absolute}ol:not([class])>li::before{-ms-flex-align:center;-ms-flex-negative:0;-ms-flex-pack:center;-webkit-box-align:center;-webkit-box-pack:center;align-items:center;content:counter(ol-step-counter);display:-ms-inline-flexbox;display:-webkit-inline-box;display:inline-flex;flex-shrink:0;font-size:.75em;height:20px;justify-content:center;margin:6px 0 0;width:20px}ul:not([class]){padding-left:24px}ol:not([class])>li,ul:not([class])>li{font-size:1.125rem;line-height:1.778rem;margin-bottom:8px}ul:not([class])>li::before{content:"";height:8px;margin:12px 0 0;width:8px}li>ol:not([class]),li>ul:not([class]),ol:not([class])>li>p,ul:not([class])>li>p{margin:8px 0}ol:not([class])>li>p:first-child,table ol:not([class]):first-child,table ul:not([class]):first-child,ul:not([class])>li>p:first-child{margin-top:0}ol:not([class])>li>p:last-child,table ol:not([class]):last-child,table ul:not([class]):last-child,ul:not([class])>li>p:last-child{margin-bottom:0}select{-moz-appearance:none;-webkit-appearance:none;appearance:none;background-color:#fff;background-image:url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10L12 15L17 10H7Z' fill='%235F6368'/%3E%3C/svg%3E%0A");background-position:right .5em top 50%;background-repeat:no-repeat;background-size:1.5em;border-radius:1px;border:1px solid #dadce0;box-sizing:border-box;color:inherit;display:block;font-family:inherit;font-size:1em;line-height:1.5;margin:0;max-width:100%;padding:.6em 3em .5em .8em}select::-ms-expand{display:none}select:-moz-focusring{color:transparent;text-shadow:0 0 0 #000}select:hover{border-color:#9aa0a6}select option,table code{font-weight:400}.w-select--borderless{border-color:transparent}.w-select--borderless:hover{border-color:transparent;background-color:#f1f3f4}table{border-collapse:collapse;font-size:inherit;margin:0;min-width:512px;width:100%}table code{background:0 0;border:0;font-size:.9em;line-height:1.7em;margin:0;padding:0}table ol:not([class]),table ul:not([class]){margin:24px 0;padding-left:40px}table ol:not([class]) li,table ul:not([class]) li{font-size:inherit;line-height:inherit}table ul:not([class]) li::before{margin:8px 0 0}table ol:not([class]) li::before{margin:2px 0 0}code{margin:0 .25em;padding:.125em .25em}code,pre{background:#f7f7f7;border:1px solid #dadce0;color:#202124;font:1rem/1.5em SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;hyphens:none;tab-size:2;text-align:left;word-spacing:normal}:not(pre)>code{white-space:pre-wrap}pre,pre[class*=language-]{margin:32px -24px;border-width:1px 0;overflow:auto;padding:16px;white-space:pre;scrollbar-color:#80868b transparent;scrollbar-width:thin}pre::-webkit-scrollbar,pre[class*=language-]::-webkit-scrollbar{height:10px;width:10px}pre::-webkit-scrollbar-thumb,pre[class*=language-]::-webkit-scrollbar-thumb{background:#80868b;background-clip:padding-box;border:2.5px solid transparent;border-radius:5px}pre::-webkit-scrollbar-thumb:hover,pre[class*=language-]::-webkit-scrollbar-thumb:hover{background-color:#62676c}pre::-webkit-scrollbar-thumb:active,pre[class*=language-]::-webkit-scrollbar-thumb:active{background-color:#4a4e51}pre::-webkit-scrollbar-track,pre[class*=language-]::-webkit-scrollbar-track{background:0 0}@media (min-width:481px){pre,pre[class*=language-]{margin:32px -32px}}@media (min-width:865px){pre,pre[class*=language-]{margin:32px 0;border-width:1px}}pre code,pre[class*=language-] code{font-size:1em;line-height:1.5em;margin:0;padding:0}pre code{background:0 0;border:0}h1 code,h2 code,h3 code,h4 code{background:0 0;border:0;color:inherit;font-size:inherit;margin:0;padding:0;white-space:normal}cite code{font-size:.9em}.token.comment{color:#696969}.token.punctuation,.token.string{color:#183691}.token.property,.token.tag{color:#385d34}.token.boolean,.token.number{color:#007aa2}.token.important,.token.keyword{color:#9f1c59}.token.operator,.token.url{color:#a71d5d}.namespace{opacity:.7}video{max-width:100%}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/cyrillic.woff2) format("woff2");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/greek.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/vietnamese.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/latin-ext.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/latin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/cyrillic.woff2) format("woff2");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/greek.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/vietnamese.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/latin-ext.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/latin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:url(/fonts/material-icons/regular.woff2) format("woff2")}.scrollbar,.w-toc__content{scrollbar-color:#9aa0a6 transparent;scrollbar-width:thin}.scrollbar::-webkit-scrollbar,.w-toc__content::-webkit-scrollbar{height:6px;width:6px}.scrollbar::-webkit-scrollbar-thumb,.w-toc__content::-webkit-scrollbar-thumb{background:#9aa0a6;background-clip:padding-box;border:1.5px solid transparent;border-radius:3px}.scrollbar::-webkit-scrollbar-thumb:hover,.w-toc__content::-webkit-scrollbar-thumb:hover{background-color:#798189}.scrollbar::-webkit-scrollbar-thumb:active,.w-toc__content::-webkit-scrollbar-thumb:active{background-color:#61686e}.scrollbar::-webkit-scrollbar-track,.w-toc__content::-webkit-scrollbar-track{background:0 0}.w-visually-hidden{clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(1px);display:block;height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}:root{--list-separator:"·";--list-separator-gap:0.5rem}.w-actions{align-items:flex-end;bottom:24px;display:flex;flex-direction:column;position:fixed;right:24px;z-index:100}@media print{.w-actions{display:none}}.w-actions>*{margin-top:20px}.w-actions__fab{align-items:center;background-color:#3740ff;border:0;border-radius:50%;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);color:#fff;cursor:pointer;display:inline-flex;font-family:Segoe UI,system-ui,-apple-system,sans-serif;font-size:.875em;font-weight:600;height:56px;letter-spacing:1px;overflow:hidden;padding:0;position:relative;text-indent:-9999px;text-overflow:initial;text-transform:uppercase;width:56px}@media (min-width:1264px){.w-actions__fab{border-radius:28px;padding:0 24px 0 52px;text-indent:0;width:auto}}.w-actions__fab:active,.w-actions__fab:hover{background-color:#3740ff}.w-actions__fab:active{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.w-actions__fab:active,.w-actions__fab:focus,.w-actions__fab:hover{outline:0;text-decoration:none}.w-actions__fab::before{background-size:24px 24px;content:"";height:24px;left:16px;position:absolute;top:16px;width:24px}.w-actions__fab::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}.w-actions__fab:hover::after{background-color:rgba(255,255,255,.08)}.w-actions__fab:focus::after{background-color:rgba(255,255,255,.24)}.w-actions__fab:active::after{background-color:rgba(255,255,255,.32)}.w-actions__fab--share::before{background-image:url(/images/icons/share_white.svg)}.w-actions__fab--subscribe{background-color:#fff;color:#3740ff}.w-actions__fab--subscribe:active,.w-actions__fab--subscribe:hover{background-color:#fff}.w-actions__fab--subscribe::before{background-image:url(/images/icons/subscribe.svg)}.w-actions__fab--subscribe:hover::after{background-color:rgba(55,64,255,.04)}.w-actions__fab--subscribe:focus::after{background-color:rgba(55,64,255,.12)}.w-actions__fab--subscribe:active::after{background-color:rgba(55,64,255,.16)}:root{--app-bar-height:64px}.w-article-header{margin:0 0 48px;padding-top:40px}@media (min-width:865px){.w-article-header{margin:0 0 64px;padding-top:56px}}@media print{.w-article-header{margin:0;padding-top:0}}.w-article-header__headline{font-size:27px;font-weight:400;line-height:33px;margin:0 auto 11px}@media (min-width:241px){.w-article-header__headline{font-size:31px;line-height:38px}}@media (min-width:321px){.w-article-header__headline{font-size:36px;line-height:44px}}@media (min-width:865px){.w-article-header__headline{font-size:44px;line-height:52px}}.w-article-navigation{background-color:#dadce0;display:flex;flex-direction:column;padding:1px 0}@media (min-width:481px){.w-article-navigation{flex-direction:row}}@media print{.w-article-navigation{display:none}}.w-article-navigation__link{align-items:center;background-color:#fff;color:#202124;display:flex;font-family:"Google Sans",sans-serif;position:relative}.w-article-navigation__link:active,.w-article-navigation__link:focus,.w-article-navigation__link:hover{background-color:#fff;outline:0;text-decoration:none}.w-article-navigation__link::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal}.w-article-navigation__link::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}.w-article-navigation__link:hover::after{background-color:rgba(32,33,36,.04)}.w-article-navigation__link:focus::after{background-color:rgba(32,33,36,.12)}.w-article-navigation__link:active::after{background-color:rgba(32,33,36,.16)}.w-article-navigation__link--back{flex-basis:33.3%;margin:0 0 1px;padding:32px 32px 32px 80px}@media (min-width:481px){.w-article-navigation__link--back{margin:0 1px 0 0}}.w-article-navigation__link--back::before,.w-aside::after{content:"arrow_back";left:32px;position:absolute}.w-article-navigation__link--single{flex:1;margin:0}@media (min-width:481px){.w-article-navigation__link--single{margin:0}}.w-article-navigation code{background:0 0;border:0;color:inherit;padding:0}.w-aside{font-family:Segoe UI,system-ui,-apple-system,sans-serif;font-size:13.5px;line-height:21px;margin:48px 0 32px;padding:24px 0 0 48px;position:relative}@media (min-width:241px){.w-aside{font-size:15px;line-height:28px}}@media (min-width:321px){.w-aside{font-size:18px;line-height:32px}}.w-aside strong{font-weight:700}.w-aside::after{content:"";height:2px;left:0;right:0;top:0}.w-aside::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;float:left;margin:4px 0 0 -48px}.w-aside--warning{color:#eb0f00}.w-aside--warning::after{background-color:#eb0f00}.w-aside--warning::before{content:"warning"}.w-aside a,.w-aside code,.w-aside p{color:inherit}.w-aside code{white-space:pre-wrap}.w-aside pre,.w-aside pre code{font-size:.889em;line-height:1.5;white-space:pre}.w-aside a{text-decoration:underline}.w-aside p{font-family:inherit;letter-spacing:normal;margin:0}.w-aside p+p{margin-top:8px}.w-aside p,.w-aside ul li{font-size:inherit;line-height:inherit}.w-authors{display:flex;flex-wrap:wrap;gap:32px}.w-author{display:flex;padding:8px}.w-author__image{background-color:#dadce0;border-radius:50%;border:2px solid #fff;flex-shrink:0;height:64px;margin:0 12px 0 0;min-width:64px;object-fit:cover;overflow:hidden;width:64px}.w-author__name,.w-author__published{display:block;font-size:14px;font-style:normal}.w-author__name{color:#202124}.w-author__name-link{display:inline-block;color:inherit}.w-author__name-link:focus,.w-author__name-link:hover{text-decoration:none}.w-post-content .w-author__name-link{text-decoration:none}.w-post-content .w-author__name-link:focus,.w-post-content .w-author__name-link:hover{text-decoration:underline}.w-author__published{color:#5f6368}.w-author__link,web-event-schedule{display:block}.w-author__link-list{display:flex;flex-wrap:wrap;list-style:none;overflow:hidden;margin-top:9px}.w-author__link-listitem{font-size:14px;display:flex}.w-author__link-listitem+.w-author__link-listitem::before{content:"·";display:block;margin:0 4px}.w-author__link:focus{box-shadow:inset 0 0 0 1px #3740ff;outline:0}.w-breadcrumbs,.w-breadcrumbs__crumb{align-items:center;display:flex;min-width:0}.w-breadcrumbs{margin:0;padding:0}.w-breadcrumbs__crumb{font-size:.875rem}.w-breadcrumbs__icon{width:1.1rem;height:1.1rem;fill:#5f6368}.w-breadcrumbs__crumb:not(:last-of-type){flex-shrink:0}.w-breadcrumbs__crumb:last-of-type>a{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.w-breadcrumbs__link{color:#5f6368;padding:0 8px}.w-breadcrumbs__link--left-justify{margin-left:-8px}.w-button{-webkit-tap-highlight-color:transparent;align-items:center;background:0 0;border:0;border-radius:3px;color:#3740ff;cursor:pointer;display:inline-flex;font:500 .875rem/2.25rem Segoe UI,system-ui,-apple-system,sans-serif;height:56px;justify-content:center;letter-spacing:1px;outline:0;padding:0 16px;text-decoration:none;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;overflow:hidden;position:relative;transition:background-color .2s,box-shadow .2s;vertical-align:middle;white-space:nowrap}.w-button::-moz-focus-inner{border:0}@media (hover:hover){.w-button:focus,.w-button:hover{background:#fff;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);outline:0;text-decoration:none}}.w-button:active{background:#fff;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);outline:0;text-decoration:none}.w-button:focus{outline:1px solid rgba(55,64,255,.8);outline-offset:-3px}.w-button[disabled]{background:#dadce0;box-shadow:none;color:rgba(0,0,0,.26);cursor:default;pointer-events:none}.w-button::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}@media (hover:hover){.w-button:hover::after{background-color:rgba(55,64,255,.04)}.w-button:focus::after{background-color:rgba(55,64,255,.12)}}.w-button:active::after{background-color:rgba(55,64,255,.16)}.w-button--primary,.w-button--primary:active,.w-button--primary:focus,.w-button--primary:hover{background-color:#3740ff;color:#fff}@media (hover:hover){.w-button--primary:hover::after{background-color:rgba(255,255,255,.08)}.w-button--primary:focus::after{background-color:rgba(255,255,255,.24)}}.w-button--primary:active::after{background-color:rgba(255,255,255,.32)}.w-button--primary:focus{outline:1px solid rgba(255,255,255,.8)}.w-button--secondary,.w-button--secondary:active,.w-button--secondary:focus,.w-button--secondary:hover{background-color:#fff;border:1px solid #dadce0;color:#202124}@media (hover:hover){.w-button--secondary:hover::after{background-color:rgba(0,0,0,.04)}.w-button--secondary:focus::after{background-color:rgba(0,0,0,.08)}}.w-button--secondary:active::after{background-color:rgba(0,0,0,.1)}.w-button--secondary:focus{outline:1px solid rgba(32,33,36,.6)}.w-button--icon,.w-button--svg{-webkit-tap-highlight-color:transparent;align-items:center;background:0 0;border:0;border-radius:3px;cursor:pointer;display:inline-flex;font:500 .875rem/2.25rem Segoe UI,system-ui,-apple-system,sans-serif;height:56px;justify-content:center;letter-spacing:1px;outline:0;position:relative;text-decoration:none;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;color:#5f6368;height:3rem;overflow:unset;padding:0;transition:background .2s ease,color .2s ease;width:3rem}@media (hover:hover){.w-button--icon:focus,.w-button--icon:hover,.w-button--svg:focus,.w-button--svg:hover{background:#f1f3f4;color:#202124}}.w-button--icon:active,.w-button--svg:active{background:#e8eaed}.w-button--icon:focus,.w-button--svg:focus{box-shadow:0 0 0 1px #3740ff;outline:0}.w-button--round{border-radius:50%}.w-button--icon::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;content:attr(data-icon);display:inline-block;height:24px;speak:none;width:24px;margin:0}.button{appearance:none;border:0;background:0 0;padding:0}.w-chips{display:flex;flex-flow:row wrap}.w-chip,.w-post-content .w-chip{background-color:transparent;border:1px solid rgba(32,33,36,.16);border-radius:20px;box-sizing:border-box;color:#202124;display:block;font-size:14px;height:32px;line-height:30px;margin:0 8px 12px 0;overflow:hidden;padding:0 12px;text-decoration:none;transition:background-color .2s,border .2s}.w-chip:active,.w-chip:focus,.w-chip:hover,.w-post-content .w-chip:active,.w-post-content .w-chip:focus,.w-post-content .w-chip:hover{outline:0;text-decoration:none}.w-chip:hover,.w-post-content .w-chip:hover{background-color:rgba(32,33,36,.04);border:1px solid rgba(32,33,36,.2)}.w-chip:focus,.w-post-content .w-chip:focus{background-color:rgba(32,33,36,.12);border:1px solid rgba(32,33,36,.28)}.w-chip:active,.w-post-content .w-chip:active{background-color:rgba(0,0,0,.16);border:1px solid rgba(32,33,36,.43);box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.w-callout__header{padding-bottom:1rem}.w-callout__lockup{font:500 13.5px/1.4814814815 "Google Sans",sans-serif;margin-top:36px;margin-bottom:12px;display:inline-flex;margin:0 0 .75rem!important}@media (min-width:241px){.w-callout__lockup{font:500 16px/1.375 "Google Sans",sans-serif;margin-top:42px;margin-bottom:14px}}@media (min-width:321px){.w-callout__lockup{font:500 20px/1.2 "Google Sans",sans-serif;margin-top:48px;margin-bottom:16px}}.w-callout__lockup::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;display:inline-block;font-size:20px;margin:0 8px 0 0}.w-callout__blurb{margin:0}.w-details{border:1px solid #dadce0;border-width:1px 0;margin:36px 0;padding:18px 0;position:relative}.w-details+.w-details{border-top:0;margin-top:-36px}.w-details__summary{-webkit-tap-highlight-color:transparent;cursor:pointer;font:inherit;list-style:none}.w-details__summary::marker{display:none}.w-details__summary:focus{outline:0}@media (hover:hover){.w-details__summary:focus .w-details__header::after,.w-details__summary:hover .w-details__header::after{background:#e7e8ff}}.w-details__summary:focus .w-details__header::after{box-shadow:0 0 0 1px #3740ff}.w-details__summary:active .w-details__header::after{background:#c3c6ff}.w-details__header{color:#3740ff;margin:0;padding:.75rem 40px .75rem 0;position:relative}.w-details__header::after{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;border-radius:50%;content:"expand_more";cursor:pointer;font-size:24px;padding:2px;position:absolute;right:1px;speak:none;top:50%;transform:translateY(-50%);transition:background .2s;visibility:visible}@media (min-width:321px){.w-details__header{padding:1.125em 48px 1.125em 0}.w-details__header::after{padding:.25em}}.w-details[open] .w-details__header::after{transform:rotate(180deg) translateY(50%)}.w-details__header:only-child{line-height:1.5rem;padding:.375rem 40px .375rem 0}h2.w-details__header:only-child{line-height:1.3333em;padding:.75rem 40px .75rem 0}.w-details>p:first-of-type{margin-top:0}.drawer-default__contents{background:#fff;display:flex;flex-direction:column;height:100vh;width:268px;max-width:90vw}.drawer-default__header{align-items:center;display:flex;padding:16px;border-bottom:1px solid #dadce0}.drawer-default__hide{height:2.75rem;margin:0 10px 0 -6px;width:2.75rem;color:#5f6368}.drawer-default__link{border-bottom:1px solid #dadce0;color:#5f6368;font-size:14px;font-weight:500;padding:16px 24px}.drawer-default__link[active]{-webkit-box-shadow:0 -2px 0 #3740ff inset;box-shadow:0 -2px 0 #3740ff inset}.drawer-default__link:active,.drawer-default__link:focus,.drawer-default__link:hover{text-decoration:none;outline:0}.drawer-default__link:hover{background-color:rgba(32,33,36,.04)}.drawer-default__link:focus{background-color:rgba(32,33,36,.12)}.drawer-default__link:active{background-color:rgba(32,33,36,.16)}.w-footer{border-top:1px solid #dadce0}@media print{.w-footer{display:none}}.w-footer__license{padding-top:32px;width:100%}.w-footer__license p{font-size:.75rem;margin:0;max-width:960px}.w-footer__linkboxes{background:#fff;display:block;font:400 14px/16px Segoe UI,system-ui,-apple-system,sans-serif}.w-footer__linkboxes-list{display:block;list-style:none;padding:24px 0}@media (min-width:865px){.w-footer__linkboxes-list{display:flex;padding:24px 12px 0}}.w-footer__linkbox{flex-grow:1;padding:0 16px 24px}@media (min-width:865px){.w-footer__linkbox{flex:1;margin:0}}.w-footer__linkbox:last-of-type{padding:0 16px}.w-footer__linkbox-heading{font:500 14px/16px Segoe UI,system-ui,-apple-system,sans-serif;margin:0 0 8px}.w-footer__linkbox-list{list-style-type:none;padding:0}.w-footer__linkbox-item{margin:0}.w-footer__linkbox-link{color:#202124;display:block;padding:16px 0}.w-footer__linkbox-link:focus,.w-footer__linkbox-link:hover,.w-footer__utility-link:focus,.w-footer__utility-link:hover{color:#3740ff;text-decoration:none}.w-footer__utility{background:#fff;display:block}.w-footer__utility-nav{border-top:1px solid #ddd;display:block;font:400 14px/16px Segoe UI,system-ui,-apple-system,sans-serif;margin:0 16px;padding:24px 0}@media (min-width:865px){.w-footer__utility-nav{align-items:center;display:flex;flex-wrap:wrap;margin:0 24px}}.w-footer__utility-list{display:block;list-style:none;padding:0}@media (min-width:865px){.w-footer__utility-list{align-items:center;display:flex;flex:1;flex-wrap:wrap}}.w-footer__utility-item{margin:0}@media (min-width:865px){.w-footer__utility-item{margin-right:40px}}.w-footer__utility-link{color:#202124;display:block;padding:16px 0}.w-footer__utility-logo-link{display:block;line-height:1;margin-right:40px}.w-footer__utility-logo{margin:-2px 0 16px;max-width:185px}@media (min-width:865px){.w-footer__utility-logo{margin:-2px 0 0}}.header-default{position:fixed;top:0}.header-default [data-open-drawer-button]{margin:0 8px 0 -8px}@media (min-width:865px){.header-default [data-open-drawer-button]{display:none}}.header-default__middle{align-items:center;display:flex;flex:1;height:100%;overflow:hidden;position:relative}.header-default__links{display:none;flex:1;height:100%;line-height:20px;min-width:50%;padding-left:48px}@media (min-width:865px){.header-default__links{display:flex}}.header-default__link{align-items:center;color:#202124;display:flex;font-weight:500;margin:0;padding:0 16px;position:relative}.header-default__link[active]{box-shadow:0 -2px 0 #3740ff inset}@media (min-width:1264px){.header-default__link{padding:0 24px}}.header-default__link:active,.header-default__link:focus,.header-default__link:hover{outline:0;text-decoration:none}.header-default__link:hover{background-color:rgba(32,33,36,.04)}.header-default__link:focus{background-color:rgba(32,33,36,.12)}.header-default__link:active{background-color:rgba(32,33,36,.16)}.header-default web-search{flex:1}@media (min-width:865px){.header-default web-search .web-search__input-wrapper{max-width:calc(200% - 16px*2);min-width:calc(200% - 16px*2);transform:translateX(calc(50% - 200px + 16px));transition:var(--web-search-animation-time) transform;width:calc(200% - 16px*2);display:flex}.header-default web-search .web-search__close-btn,.header-default web-search .web-search__open-btn{display:none}.header-default web-search[expanded] .web-search__input-wrapper{transform:translate(calc(-50% + 16px))}}.header-default .web-search-popout{border-top:1px solid #ddd;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15);left:0;padding:16px 0;position:absolute;top:55px;width:calc(100% - 45px)}@media (min-width:865px){.header-default .web-search-popout{left:calc(16px*2);width:calc(100% - 16px*2)}}web-header.web-header--has-expanded-search .header-default__logo-link,web-header.web-header--has-expanded-search web-profile-switcher-container{display:none}@media (min-width:865px){web-header.web-header--has-expanded-search .header-default__logo-link{display:inline}}web-header.web-header--has-expanded-search .header-default__middle{overflow:visible}@media (min-width:865px){web-header.web-header--has-expanded-search web-profile-switcher-container{display:flex}}.header-default~main{margin-top:64px}.icon{fill:currentColor}.w-hero,web-table-of-contents,web-table-of-contents-button[opened]{display:none}@media (min-width:481px){.w-hero{display:block;margin:0 auto;max-height:480px;width:1600px}}.w-hero--cover{object-fit:cover}.w-layout-container--narrow{box-sizing:content-box;margin:0 auto;overflow:visible;padding:24px}@media (min-width:481px){.w-layout-container--narrow{padding:32px}}.w-layout-container--narrow{max-width:800px}:root{--grid-min:150px;--grid-max:.5fr;--grid-gap:24px}web-livestream-container{background-color:#fff;display:flex;margin:auto;max-width:1600px}@media (min-width:865px){web-livestream-container{border-left:1px solid #dadce0;border-right:1px solid #dadce0}}web-subscribe:not(:defined){display:flex;justify-content:center;width:100%}.w-subscribe__error{color:#eb0f00}@media (min-width:865px){main.w-toc-open>*{width:calc(100% - 268px)}main.w-toc-open>* .w-actions{right:calc(24px + 268px)}}web-table-of-contents h2{line-height:32px}web-table-of-contents .w-scroll-spy__active{position:relative;display:inline-block}web-table-of-contents .w-scroll-spy__active::before{content:"";display:inline-block;border-left:3px solid #3740ff;margin-left:-24px;padding-left:21px;height:100%;position:absolute;top:0;left:0}web-table-of-contents[opened]{background-color:#fff;border-bottom:1px solid #dadce0;border-top:1px solid #dadce0;display:block;padding:24px 0;top:63px;width:100%;z-index:100}@media (min-width:481px){web-table-of-contents[opened]{padding-top:32px}}@media (min-width:865px){web-table-of-contents[opened]{border-bottom:0;border-left:1px solid #dadce0;border-top:0;height:calc(100% - 64px);position:fixed;right:0;width:268px}}.w-toc__button--open{background-color:#fff;border:1px solid #dadce0;height:40px;overflow:hidden;padding:8px}web-table-of-contents-button{display:flex;height:0;justify-content:flex-end;margin-bottom:-24px;margin-right:24px;padding-top:24px;top:64px;z-index:1}@media (min-width:481px){web-table-of-contents-button{margin-bottom:-32px;padding-top:32px}}@media (min-width:865px){web-table-of-contents-button{max-height:none;position:sticky}}@media print{web-table-of-contents-button{display:none}}.w-toc__content{height:calc(100% - 24px);overflow-y:auto;padding:0 24px}@media (min-width:481px){.w-toc__content{height:calc(100% - 32px)}}.w-toc__content a{display:inline-block}.w-toc__header{margin-bottom:12px;margin-top:12px}.w-toc__header--link{font-family:"Google Sans",sans-serif;font-size:1.2rem;font-weight:500}@media (min-width:865px){.w-toc__header--link{color:#202124}.w-toc__header--link.w-scroll-spy__active,.w-toc__header--link:hover{color:#3740ff}}.w-toc__label{display:flex;height:40px;justify-content:space-between;padding:0 24px}.w-toc__label>*{font-size:.9rem;height:40px;line-height:40px;vertical-align:middle}.w-toc__list ul{margin:0;padding:0}.w-toc__list ul li::before{content:none}.w-toc__list ul li a{font-size:1rem}@media (min-width:865px){.w-toc__list ul li a{color:#202124}.w-toc__list ul li a.w-scroll-spy__active,.w-toc__list ul li a:hover{color:#3740ff}}.w-headline-link{color:transparent;display:none;font-weight:500;margin-left:4px}@media (min-width:481px){.w-headline-link{display:inline}}.w-headline-link:focus,:hover>.w-headline-link{color:#5f6368;display:inline}.w-tooltip{background:#000;border-radius:3px;color:#fff;font:500 12px/1 Segoe UI,system-ui,-apple-system,sans-serif;left:50%;letter-spacing:.3px;opacity:0;padding:6px 8px;pointer-events:none;position:absolute;text-transform:none;top:calc(100% + 3px);transform:scale(.85) translateX(-50%);transform-origin:top left;transition:opacity 75ms,transform 0s 75ms,visibility 0s 75ms;visibility:hidden;white-space:nowrap;z-index:1}.w-tooltip--left{left:0;transform:scale(.85)}.w-tooltip--right{left:100%;transform:translateX(-100%) scale(.85);transform-origin:top right}@media (hover:hover){:hover>.w-tooltip{opacity:.77;transform:scale(1) translateX(-50%);transition:opacity .15s .3s,transform .15s .3s,visibility 0s;visibility:visible}:hover>.w-tooltip--left{transform:scale(1)}:hover>.w-tooltip--right{transform:translateX(-100%) scale(1)}}:active>.w-tooltip,:focus .w-tooltip{opacity:.77;transform:scale(1) translateX(-50%);transition:opacity .15s .3s,transform .15s .3s,visibility 0s;visibility:visible}:active>.w-tooltip{transition:opacity .15s .5s,transform .15s .5s,visibility 0s}:active>.w-tooltip--left,:focus .w-tooltip--left{transform:scale(1)}:active>.w-tooltip--right,:focus .w-tooltip--right{transform:translateX(-100%) scale(1)}web-audio-fab{border-radius:50%;bottom:12px;box-shadow:0 8px 12px 6px rgba(60,64,67,.15),0 4px 4px rgba(60,64,67,.3);display:block;height:56px;opacity:0;pointer-events:none;position:fixed;right:12px;transition:opacity .2s cubic-bezier(.4,0,.2,1);width:56px;z-index:1}web-audio-fab[showing]{opacity:1;pointer-events:auto}web-copy-code{display:block;position:relative}web-copy-code:active .web-copy-code__button,web-copy-code:focus .web-copy-code__button,web-copy-code:hover .web-copy-code__button{opacity:1}web-copy-code .web-copy-code__button{color:#202124;height:48px;margin:8px;opacity:0;position:absolute;right:0;width:48px}web-copy-code .web-copy-code__button::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;content:"content_copy"}web-copy-code .web-copy-code__button:focus,web-copy-code .web-copy-code__button:hover{background-color:rgba(63,196,255,.2);opacity:1}web-copy-code .web-copy-code__button:active{background-color:rgba(63,196,255,.4);opacity:1}web-copy-code pre{min-height:64px}web-header{align-items:center;background:#fff;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15);color:#202124;contain:layout;display:flex;font-size:14px;height:64px;padding:0 24px;width:100%;z-index:200}@media print{web-header{display:none}}web-navigation-drawer{display:block;height:100%;left:0;pointer-events:none;position:fixed;top:0;width:100%;z-index:300}web-navigation-drawer [data-drawer-container]{box-shadow:2px 0 12px rgba(0,0,0,.4);position:relative;transform:translateX(-110%);width:fit-content}@media (min-width:1264px){web-navigation-drawer[type=standard]{align-self:flex-start;position:sticky;pointer-events:auto;top:0;width:auto}web-navigation-drawer[type=standard] [data-drawer-container]{box-shadow:none;transform:none}web-navigation-drawer[type=standard] [data-drawer-close-button]{visibility:hidden}}web-navigation-drawer::before{content:"";display:block;position:absolute;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.4);opacity:0;transition:opacity .2s cubic-bezier(.4,0,.2,1)}web-navigation-drawer[open]{pointer-events:auto;visibility:visible}web-navigation-drawer[open]::before{opacity:1}web-navigation-drawer[open] [data-drawer-container]{transform:none}web-navigation-drawer[animating] [data-drawer-container],web-navigation-drawer[open][animating] [data-drawer-container]{transition:transform .2s cubic-bezier(.4,0,.2,1)}.youtube{padding-top:56.25%;position:relative;width:100%;border-radius:8px;overflow:hidden}lite-youtube{height:100%;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%}web-codelab{display:flex;flex-flow:column;padding:16px}@media (min-width:865px){web-codelab{flex-flow:row}}web-codelab .web-codelab__glitch{min-height:160px}.w-event-carousel__day{color:#3c4043;font-family:"Google Sans",sans-serif;font-size:14px;font-weight:500;margin-right:16px}.w-event-carousel__day:last-child{margin-right:0}.w-event-carousel__day.w-event-carousel__pending{opacity:.6}.w-event-carousel__thumbnail{margin-bottom:8px;background-color:#e8eaed;border-radius:3px;overflow:hidden;width:178px;height:110px}.w-event-carousel__thumbnail>img{height:100%;object-fit:cover}.w-event-schedule__video{align-self:center;font-weight:500;z-index:1}web-progress-bar{background-color:#fff;visibility:hidden;z-index:1}.guide-landing-page{position:relative}.w-post-breadcrumbs{padding:0 0 32px}@media (min-width:865px){.w-post-breadcrumbs{padding:0 0 44px}}.w-post-content{margin-bottom:64px}@media (min-width:481px){.w-post-content{margin-bottom:160px}}.w-post-github-link{color:#5f6368;font-size:.875em}:root{--course-content-margin:24px}.w-text--center{text-align:center!important}.w-display--flex{display:flex}.w-justify-content--center{justify-content:center}.w-mb--sm{margin-bottom:8px!important}.w-mt--sm{margin-top:8px!important}.w-mr--sm{margin-right:8px!important}.w-pt--sm{padding-top:8px!important}.w-mb--l{margin-bottom:32px!important}.w-mt--l{margin-top:32px!important}.w-mt--xl{margin-top:56px!important}.hidden,[hidden]{display:none!important}:not(body).unresolved,web-tabs.unresolved>:not(.w-tabs-default){display:none}web-tabs.unresolved{padding-top:50px;display:block}web-event-time.unresolved{min-height:120px;display:block}</style><link href=/fonts/material-icons/regular.woff2 rel=preload as=font crossorigin><link href=/fonts/google-sans/regular/latin.woff2 rel=preload as=font crossorigin><link href=/fonts/google-sans/bold/latin.woff2 rel=preload as=font crossorigin><meta content=#fff name=theme-color><title>Using asynchronous web APIs from WebAssembly</title><meta content="Learn how to invoke asynchronous web APIs when compiling traditionally synchronous languages to WebAssembly." name=description><link href=https://web.dev/asyncify/ rel=canonical><meta content="Using asynchronous web APIs from WebAssembly" itemprop=name><meta content="Learn how to invoke asynchronous web APIs when compiling traditionally synchronous languages to WebAssembly." itemprop=description><meta content="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&fit=max&w=1200&fm=auto" itemprop=image><meta content=en_US property=og:locale><meta content=article property=og:type><meta content=https://web.dev/asyncify/ property=og:url><meta content=web.dev property=og:site_name><meta content="Using asynchronous web APIs from WebAssembly" property=og:title><meta content="Learn how to invoke asynchronous web APIs when compiling traditionally synchronous languages to WebAssembly." property=og:description><meta content="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&fit=max&w=1200&fm=auto" property=og:image><meta content="A crosswalk signal asking pedestrians to wait." property=og:image:alt><meta content=webassembly property=tag><meta content=file-system property=tag><meta content=summary_large_image name=twitter:card><meta content="Using asynchronous web APIs from WebAssembly" name=twitter:title><meta content="Learn how to invoke asynchronous web APIs when compiling traditionally synchronous languages to WebAssembly." name=twitter:description><meta content="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&fit=max&w=1200&fm=auto" name=twitter:image><link href=/feed.xml rel=alternate type=application/atom+xml data-title="web.dev feed"><link href=/manifest.webmanifest rel=manifest><link href=/images/favicon.ico rel="shortcut icon"><link href=/images/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/images/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/images/safari-pinned-tab.svg rel=mask-icon color=#0054ff><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-126406676-2"),ga("set","transport","beacon"),ga("set","anonymizeIp",!0),ga("set","page",window.location.pathname),ga("set","dimension5","4"),ga("send","pageview");</script><script>function loadScript(e,t){const d=document.createElement("script");if(d.src=e,t&&(d.type=t),"module"===t){d.async=!1;const t=document.createElement("link");t.rel="modulepreload",t.href=e,document.head.append(t),window.addEventListener("DOMContentLoaded",(()=>{document.head.append(d)}))}else document.head.append(d)}loadScript("/js/app.js?v=c4d27698","module"),loadScript("/js/content.js?v=9e7685c5","module"),loadScript("https://www.google-analytics.com/analytics.js",null);</script></head><body class=unresolved><web-snackbar-container></web-snackbar-container><web-header class=header-default role=navigation><button aria-label="Open menu" class="w-button--round w-button--svg" data-open-drawer-button><svg class=icon height=24 viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg aria-label=menu role=img><path d="M0 0h24v24H0z" fill=none /><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <span class="w-tooltip w-tooltip--left">Open menu</span></button> <a href=/ class="gc-analytics-event header-default__logo-link" data-category="Site-Wide Custom Events" data-label="Site logo"><img alt=web.dev height=30 src=/images/lockup.svg width=125 class=header-default__logo></a><div class=header-default__middle><div class=header-default__links><a href=/learn/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Learn">Learn </a><a href=/measure/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Measure">Measure </a><a href=/blog/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Blog">Blog </a><a href=/about/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: About">About</a></div><web-search results-id=search-main-results></web-search><web-search-results id=search-main-results></web-search-results></div><web-profile-switcher-container></web-profile-switcher-container></web-header><web-navigation-drawer class=drawer-default type=modal><nav data-drawer-container><div class=drawer-default__contents><div class=drawer-default__header><button aria-label=Close class="w-button--round w-button--svg drawer-default__hide" data-drawer-close-button><svg class=icon height=24 viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg aria-label=close role=img><path d="M0 0h24v24H0z" fill=none /><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <span class=w-tooltip>Close</span></button> <a href=/ class=gc-analytics-event data-category="Site-Wide Custom Events" data-label="Site logo"><img alt=web.dev height=30 src=/images/lockup.svg width=125 class=drawer-default__logo></a></div><a href=/learn/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Learn">Learn </a><a href=/measure/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Measure">Measure </a><a href=/blog/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Blog">Blog </a><a href=/about/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: About">About</a></div></nav></web-navigation-drawer><main><div id=content><div class=guide-landing-page><img alt="A crosswalk signal asking pedestrians to wait." height=480 src="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format" width=1600 class="w-hero w-hero--cover" decoding=auto sizes=100vw srcset="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=200 200w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=228 228w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=260 260w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=296 296w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=338 338w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=385 385w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=439 439w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=500 500w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=571 571w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=650 650w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=741 741w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=845 845w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=964 964w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/3XqfQyjjfxEw8T3azz0W.jpg?auto=format&w=1600 1600w"><web-table-of-contents><h2 class=w-toc__header><a href=#using-asynchronous-web-apis-from-webassembly class=w-toc__header--link>Using asynchronous web APIs from WebAssembly</a></h2><div class=w-toc__list><ul><li><a href=#io-in-system-languages>I/O in system languages</a></li><li><a href=#asynchronous-model-of-the-web>Asynchronous model of the web</a></li><li><a href=#bridging-the-gap-with-asyncify>Bridging the gap with Asyncify</a></li><li><a href=#usage-in-c-c++-with-emscripten>Usage in C / C++ with Emscripten</a></li><li><a href=#usage-from-other-languages>Usage from other languages</a></li><li><a href=#how-does-this-all-work-under-the-hood>How does this all work under the hood?</a></li><li><a href=#transformation-costs>Transformation costs</a></li><li><a href=#real-world-demos>Real-world demos</a></li></ul></div></web-table-of-contents><web-table-of-contents-button></web-table-of-contents-button><div class=w-actions><share-action authors=@RReverser class="gc-analytics-event w-actions__fab w-actions__fab--share" data-action=click data-category=web.dev data-icon=share data-label=share role=button tabindex=0><span>Share</span></share-action><a href=/newsletter/ class="gc-analytics-event w-actions__fab w-actions__fab--subscribe" data-category=web.dev data-label=view-subscribe data-action=click><span>subscribe</span></a></div><div class="w-layout-container--narrow w-post-content"><header class=w-article-header><div class=w-post-breadcrumbs><ul class=w-breadcrumbs><li class=w-breadcrumbs__crumb><a href=/ class="gc-analytics-event w-breadcrumbs__link w-breadcrumbs__link--left-justify" data-category=web.dev data-label="post, home breadcrumb" data-action=click>Home</a></li><svg class=w-breadcrumbs__icon height=24 viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg aria-hidden=true><path d="M0 0h24v24H0V0z" fill=none /><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg><li class=w-breadcrumbs__crumb><a href=/blog class="gc-analytics-event w-breadcrumbs__link" data-category=web.dev data-label="post, path breadcrumb" data-action=click>All articles</a></li></ul></div><h1 class=w-article-header__headline id=using-asynchronous-web-apis-from-webassembly>Using asynchronous web APIs from WebAssembly</h1><div class=w-author__published><time>Apr 26, 2021</time></div><div class="w-authors w-mt--xl w-pt--sm"><div class=w-author><a href=/authors/rreverser/ ><img alt="Ingvar Stepanyan" height=64 src="https://web-dev.imgix.net/image/admin/Ma3ckXmLV7aj1rVgVT1I.jpg?auto=format&fit=crop&h=64&w=64" width=64 class=w-author__image decoding=async sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/Ma3ckXmLV7aj1rVgVT1I.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75, https://web-dev.imgix.net/image/admin/Ma3ckXmLV7aj1rVgVT1I.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x, https://web-dev.imgix.net/image/admin/Ma3ckXmLV7aj1rVgVT1I.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x, https://web-dev.imgix.net/image/admin/Ma3ckXmLV7aj1rVgVT1I.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x, https://web-dev.imgix.net/image/admin/Ma3ckXmLV7aj1rVgVT1I.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x" loading=lazy></a><div class=w-author__info style="display: flex; flex-direction: column; justify-content: center;"><cite class=w-author__name><a href=/authors/rreverser/ class=w-author__name-link>Ingvar Stepanyan</a></cite><ul class=w-author__link-list><li class=w-author__link-listitem><a href=https://twitter.com/RReverser class=w-author__link>Twitter</a></li><li class=w-author__link-listitem><a href=https://github.com/RReverser class=w-author__link>GitHub</a></li><li class=w-author__link-listitem><a href=https://rreverser.com/ class=w-author__link>Blog</a></li></ul></div></div></div></header><p>The I/O APIs on the web are asynchronous, but they're synchronous in most system languages. When compiling code to WebAssembly, you need to bridge one kind of APIs to another—and this bridge is Asyncify. In this post, you'll learn when and how to use Asyncify and how it works under the hood.</p><h2 id=io-in-system-languages>I/O in system languages <a href=#io-in-system-languages class=w-headline-link>#</a></h2><p>I'll start with a simple example in C. Say, you want to read the user's name from a file, and greet them with a "Hello, (username)!" message:</p><web-copy-code><pre class=language-cpp><code class=language-cpp><span class="token macro property"><span class="token directive-hash">#</span><span class="token keyword directive">include</span> <span class="token string">&lt;stdio.h></span></span><br><br><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    FILE <span class="token operator">*</span>stream <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"name.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    size_t len <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&</span>name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    name<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span><br>    <span class="token function">fclose</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello, %s!\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></web-copy-code><p>While the example doesn't do much, it already demonstrates something you'll find in an application of any size: it reads some inputs from the external world, processes them internally and writes outputs back to the external world. All such interaction with the outside world happens via a few functions commonly called input-output functions, also shortened to I/O.</p><p>To read the name from C, you need at least two crucial I/O calls: <code>fopen</code>, to open the file, and <code>fread</code> to read data from it. Once you retrieve the data, you can use another I/O function <code>printf</code> to print the result to the console.</p><p>Those functions look quite simple at first glance and you don't have to think twice about the machinery involved to read or write data. However, depending on the environment, there can be quite a lot going on inside:</p><ul><li>If the input file is located on a local drive, the application needs to perform a series of memory and disk accesses to locate the file, check permissions, open it for reading, and then read block by block until the requested number of bytes is retrieved. This can be pretty slow, depending on the speed of your disk and the requested size.</li><li>Or, the input file might be located on a mounted network location, in which case, the network stack will now be involved too, increasing the complexity, latency and number of potential retries for each operation.</li><li>Finally, even <code>printf</code> is not guaranteed to print things to the console and might be redirected to a file or a network location, in which case it would have to go via the same steps above.</li></ul><p>Long story short, I/O can be slow and you can't predict how long a particular call will take by a quick glance at the code. While that operation is running, your whole application will appear frozen and unresponsive to the user.</p><p>This is not limited to C or C++ either. Most system languages present all the I/O in a form of synchronous APIs. For example, if you translate the example to Rust, the API might look simpler, but the same principles apply. You just make a call and synchronously wait for it to return the result, while it performs all the expensive operations and eventually returns the result in a single invocation:</p><web-copy-code><pre class=language-rust><code class=language-rust><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token string">"name.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello, {}!"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></web-copy-code><p>But what happens when you try to compile any of those samples to WebAssembly and translate them to the web? Or, to provide a specific example, what could "file read" operation translate to? It would need to read data from some storage.</p><h2 id=asynchronous-model-of-the-web>Asynchronous model of the web <a href=#asynchronous-model-of-the-web class=w-headline-link>#</a></h2><p>The web has a variety of different storage options you could map to, such as in-memory storage (JS objects), <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage rel=noopener><code>localStorage</code></a>, <a href=https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API rel=noopener>IndexedDB</a>, server-side storage, and a new <a href=https://web.dev/file-system-access/ >File System Access API</a>.</p><p>However, only two of those APIs—the in-memory storage and the <code>localStorage</code>—can be used synchronously, and both are the most limiting options in what you can store and for how long. All the other options provide only asynchronous APIs.</p><p>This is one of the core properties of executing code on the web: any time-consuming operation, which includes any I/O, has to be asynchronous.</p><p>The reason is that the web is historically single-threaded, and any user code that touches the UI has to run on the same thread as the UI. It has to compete with the other important tasks like layout, rendering and event handling for the CPU time. You wouldn't want a piece of JavaScript or WebAssembly to be able to start a "file read" operation and block everything else—the entire tab, or, in the past, the entire browser—for a range from milliseconds to a few seconds, until it's over.</p><p>Instead, code is only allowed to schedule an I/O operation together with a callback to be executed once it's finished. Such callbacks are executed as part of the browser's event loop. I won't be going into details here, but if you're interested in learning how the event loop works under the hood, check out <a href=https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/ rel=noopener>Tasks, microtasks, queues and schedules</a> which explains this topic in-depth.</p><p>The short version is that the browser runs all the pieces of code in sort of an infinite loop, by taking them from the queue one by one. When some event is triggered, the browser queues the corresponding handler, and on the next loop iteration it's taken out from the queue and executed. This mechanism allows simulating concurrency and running lots of parallel operations while using only a single thread.</p><p>The important thing to remember about this mechanism is that, while your custom JavaScript (or WebAssembly) code executes, the event loop is blocked and, while it is, there is no way to react to any external handlers, events, I/O, etc. The only way to get the I/O results back is to register a callback, finish executing your code, and give the control back to the browser so that it can keep processing any pending tasks. Once I/O is finished, your handler will become one of those tasks and will get executed.</p><p>For example, if you wanted to rewrite the samples above in modern JavaScript and decided to read a name from a remote URL, you would use Fetch API and async-await syntax:</p><web-copy-code><pre class=language-js><code class=language-js><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"name.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello, %s!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></web-copy-code><p>Even though it looks synchronous, under the hood each <code>await</code> is essentially syntax sugar for callbacks:</p><web-copy-code><pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"name.txt"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello, %s!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></web-copy-code><p>In this de-sugared example, which is a bit clearer, a request is started and responses are subscribed to with the first callback. Once the browser receives the initial response—just the HTTP headers—it asynchronously invokes this callback. The callback starts reading the body as text using <code>response.text()</code>, and subscribes to the result with another callback. Finally, once <code>fetch</code> has retrieved all the contents, it invokes the last callback, which prints "Hello, (username)!" to the console.</p><p>Thanks to the asynchronous nature of those steps, the original function can return control to the browser as soon as the I/O has been scheduled, and leave the entire UI responsive and available for other tasks, including rendering, scrolling and so on, while the I/O is executing in background.</p><p>As a final example, even simple APIs like "sleep", which makes an application wait a specified number of seconds, are also a form of an I/O operation:</p><web-copy-code><pre class=language-cpp><code class=language-cpp><span class="token macro property"><span class="token directive-hash">#</span><span class="token keyword directive">include</span> <span class="token string">&lt;stdio.h></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token keyword directive">include</span> <span class="token string">&lt;unistd.h></span></span><br><span class="token comment">// ...</span><br><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"A\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"B\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>Sure, you could translate it in a very straightforward manner that would block the current thread until the time expires:</p><web-copy-code><pre class=language-js><code class=language-js>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>In fact, that's exactly what Emscripten does in <a href=https://github.com/emscripten-core/emscripten/blob/16d5755a3f71f27d0c67b8d7752f94844e56ef7c/src/library_pthread_stub.js#L47-L52 rel=noopener>its default implementation of "sleep",</a> but that's very inefficient, will block the entire UI and won't allow any other events to be handled meanwhile. Generally, don't do that in production code.</p><p>Instead, a more idiomatic version of "sleep" in JavaScript would involve calling <code>setTimeout()</code>, and subscribing with a handler:</p><web-copy-code><pre class=language-js><code class=language-js>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>What's common to all these examples and APIs? In each case, the idiomatic code in the original systems language uses a blocking API for the I/O, whereas an equivalent example for the web uses an asynchronous API instead. When compiling to the web, you need to somehow transform between those two execution models, and WebAssembly has no built-in ability to do so just yet.</p><h2 id=bridging-the-gap-with-asyncify>Bridging the gap with Asyncify <a href=#bridging-the-gap-with-asyncify class=w-headline-link>#</a></h2><p>This is where <a href=https://emscripten.org/docs/porting/asyncify.html rel=noopener>Asyncify</a> comes in. Asyncify is a compile-time feature supported by Emscripten that allows pausing the entire program and asynchronously resuming it later.</p><img alt="A call graph describing a JavaScript -> WebAssembly -> web API -> async task invocation, where Asyncify connects the result of the async task back into WebAssembly" height=200 src=https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/VSMrdTiQ7PubW6vfE6WZ.svg width=800 decoding=async loading=lazy><h3 id=usage-in-c-c++-with-emscripten>Usage in C / C++ with Emscripten <a href=#usage-in-c-c++-with-emscripten class=w-headline-link>#</a></h3><p>If you wanted to use Asyncify to implement an asynchronous sleep for the last example, you could do it like this:</p><web-copy-code><pre class=language-cpp><code class=language-cpp><span class="token macro property"><span class="token directive-hash">#</span><span class="token keyword directive">include</span> <span class="token string">&lt;stdio.h></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token keyword directive">include</span> <span class="token string">&lt;emscripten.h></span></span><br><br><span class="token function">EM_JS</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> async_sleep<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span> seconds<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    Asyncify<span class="token punctuation">.</span><span class="token function">handleSleep</span><span class="token punctuation">(</span>wakeUp <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>wakeUp<span class="token punctuation">,</span> seconds <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>…<br><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">async_sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p><a href="https://emscripten.org/docs/api_reference/emscripten.h.html?highlight=em_js#c.EM_JS" rel=noopener><code>EM_JS</code></a> is a macro that allows defining JavaScript snippets as if they were C functions. Inside, use a function <a href=https://emscripten.org/docs/porting/asyncify.html#making-async-web-apis-behave-as-if-they-were-synchronous rel=noopener><code>Asyncify.handleSleep()</code></a> which tells Emscripten to suspend the program and provides a <code>wakeUp()</code> handler that should be called once the asynchronous operation has finished. In the example above, the handler is passed to <code>setTimeout()</code>, but it could be used in any other context that accepts callbacks. Finally, you can call <code>async_sleep()</code> anywhere you want just like regular <code>sleep()</code> or any other synchronous API.</p><p>When compiling such code, you need to tell Emscripten to activate the Asyncify feature. Do that by passing <code>-s ASYNCIFY</code> as well as <a href=https://emscripten.org/docs/porting/asyncify.html#more-on-asyncify-imports rel=noopener><code>-s ASYNCIFY_IMPORTS=[func1, func2]</code></a> with an array-like list of functions that might be asynchronous.</p><web-copy-code><pre class=language-shell><code class=language-shell>emcc -O2 <span class="token punctuation">\</span><br>    -s ASYNCIFY <span class="token punctuation">\</span><br>    -s <span class="token assign-left variable">ASYNCIFY_IMPORTS</span><span class="token operator">=</span><span class="token punctuation">[</span>async_sleep<span class="token punctuation">]</span> <span class="token punctuation">\</span><br>    <span class="token punctuation">..</span>.</code></pre></web-copy-code><p>This lets Emscripten know that any calls to those functions might require saving and restoring the state, so the compiler will inject supporting code around such calls.</p><p>Now, when you execute this code in the browser you'll see a seamless output log like you'd expect, with B coming after a short delay after A.</p><web-copy-code><pre class=language-text><code class=language-text>A<br>B</code></pre></web-copy-code><p>You can <a href=https://emscripten.org/docs/porting/asyncify.html#returning-values rel=noopener>return values from Asyncify</a> functions too. What you need to do is return the result of <code>handleSleep()</code>, and pass the result to the <code>wakeUp()</code> callback. For example, if, instead of reading from a file, you want to fetch a number from a remote resource, you can use a snippet like the one below to issue a request, suspend the C code, and resume once the response body is retrieved—all done seamlessly as if the call were synchronous.</p><web-copy-code><pre class=language-js><code class=language-js><span class="token constant">EM_JS</span><span class="token punctuation">(</span>int<span class="token punctuation">,</span> get_answer<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>     <span class="token keyword">return</span> Asyncify<span class="token punctuation">.</span><span class="token function">handleSleep</span><span class="token punctuation">(</span><span class="token parameter">wakeUp</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"answer.txt"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=></span> <span class="token function">wakeUp</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Getting answer..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>int answer <span class="token operator">=</span> <span class="token function">get_answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Answer is %d\n"</span><span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>In fact, for Promise-based APIs like <code>fetch()</code>, you can even combine Asyncify with JavaScript's async-await feature instead of using the callback-based API. For that, instead of <code>Asyncify.handleSleep()</code>, call <code>Asyncify.handleAsync()</code>. Then, instead of having to schedule a <code>wakeUp()</code> callback, you can pass an <code>async</code> JavaScript function and use <code>await</code> and <code>return</code> inside, making code look even more natural and synchronous, while not losing any of the benefits of the asynchronous I/O.</p><web-copy-code><pre class=language-js><code class=language-js><span class="token constant">EM_JS</span><span class="token punctuation">(</span>int<span class="token punctuation">,</span> get_answer<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>     <span class="token keyword">return</span> Asyncify<span class="token punctuation">.</span><span class="token function">handleAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"answer.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>int answer <span class="token operator">=</span> <span class="token function">get_answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><h4 id=awaiting-complex-values>Awaiting complex values <a href=#awaiting-complex-values class=w-headline-link>#</a></h4><p>But this example still limits you only to numbers. What if you want to implement the original example, where I tried to get a user's name from a file as a string? Well, you can do that too!</p><p>Emscripten provides a feature called <a href=https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html rel=noopener>Embind</a> that allows you to handle conversions between JavaScript and C++ values. It has support for Asyncify as well, so you can call <code>await()</code> on external <code>Promise</code>s and it will act just like <code>await</code> in async-await JavaScript code:</p><web-copy-code><pre class=language-cpp><code class=language-cpp>val fetch <span class="token operator">=</span> val<span class="token punctuation double-colon">::</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token string">"fetch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>val response <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span>std<span class="token punctuation double-colon">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"answer.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>val text <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">call</span><span class="token class-name generic"><span class="token operator">&lt;</span>val<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">auto</span> answer <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token class-name generic"><span class="token operator">&lt;</span>std<span class="token punctuation double-colon">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>When using this method, you don't even need to pass <code>ASYNCIFY_IMPORTS</code> as a compile flag, as it's already included by default.</p><p>Okay, so this all works great in Emscripten. What about other toolchains and languages?</p><h3 id=usage-from-other-languages>Usage from other languages <a href=#usage-from-other-languages class=w-headline-link>#</a></h3><p>Say that you have a similar synchronous call somewhere in your Rust code that you want to map to an async API on the web. Turns out, you can do that too!</p><p>First, you need to define such a function as a regular import via <code>extern</code> block (or your chosen language's syntax for foreign functions).</p><web-copy-code><pre class=language-rust><code class=language-rust><span class="token keyword">extern</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function function-definition">get_answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Getting answer..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> answer <span class="token operator">=</span> <span class="token function">get_answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Answer is {}"</span><span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>And compile your code to WebAssembly:</p><web-copy-code><pre class=language-shell><code class=language-shell>cargo build --target wasm32-unknown-unknown</code></pre></web-copy-code><p>Now you need to instrument the WebAssembly file with code for storing/restoring the stack. For C / C++, Emscripten would do this for us, but it's not used here, so the process is a bit more manual.</p><p>Luckily, the Asyncify transform itself is completely toolchain-agnostic. It can transform arbitrary WebAssembly files, no matter which compiler it's produced by. The transform is provided separately as part of the <code>wasm-opt</code> optimiser from the <a href=https://github.com/WebAssembly/binaryen rel=noopener>Binaryen toolchain</a> and can be invoked like this:</p><web-copy-code><pre class=language-shell><code class=language-shell>wasm-opt -O2 --asyncify <span class="token punctuation">\</span><br>      --pass-arg<span class="token operator">=</span>asyncify-imports@env.get_answer <span class="token punctuation">\</span><br>      <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre></web-copy-code><p>Pass <code>--asyncify</code> to enable the transform, and then use <code>--pass-arg=…</code> to provide a comma-separated list of asynchronous functions, where the program state should be suspended and later resumed.</p><p>All that's left is to provide supporting runtime code that will actually do that—suspend and resume WebAssembly code. Again, in the C / C++ case this would be included by Emscripten, but now you need custom JavaScript glue code that would handle arbitrary WebAssembly files. We've created a library just for that.</p><p>You can find it on Github at <a href=https://github.com/GoogleChromeLabs/asyncify rel=noopener>https://github.com/GoogleChromeLabs/asyncify</a> or npm under the name <a href=https://www.npmjs.com/package/asyncify-wasm rel=noopener><code>asyncify-wasm</code></a>.</p><p>It simulates a standard <a href=https://developer.mozilla.org/en-US/docs/WebAssembly rel=noopener>WebAssembly instantiation API</a>, but under its own namespace. The only difference is that, under a regular WebAssembly API you can only provide synchronous functions as imports, while under the Asyncify wrapper, you can provide asynchronous imports as well:</p><web-copy-code><pre class=language-js><code class=language-js><span class="token keyword">const</span> <span class="token punctuation">{</span> instance <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> Asyncify<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'app.wasm'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    env<span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token keyword">async</span> <span class="token function">get_answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"answer.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>…<br><span class="token keyword">await</span> instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>Once you try to call such an asynchronous function - like <code>get_answer()</code> in the example above - from the WebAssembly side, the library will detect the returned <code>Promise</code>, suspend and save the state of the WebAssembly application, subscribe to the promise completion, and later, once it's resolved, seamlessly restore the call stack and state and continue execution as if nothing has happened.</p><p>Since any function in the module might make an asynchronous call, all the exports become potentially asynchronous too, so they get wrapped as well. You might have noticed in the example above that you need to <code>await</code> the result of <code>instance.exports.main()</code> to know when the execution is truly finished.</p><h3 id=how-does-this-all-work-under-the-hood>How does this all work under the hood? <a href=#how-does-this-all-work-under-the-hood class=w-headline-link>#</a></h3><p>When Asyncify detects a call to one of the <code>ASYNCIFY_IMPORTS</code> functions, it starts an asynchronous operation, saves the entire state of the application, including the call stack and any temporary locals, and later, when that operation is finished, restores all the memory and call stack and resumes from the same place and with the same state as if the program has never stopped.</p><p>This is quite similar to async-await feature in JavaScript that I showed earlier, but, unlike the JavaScript one, doesn't require any special syntax or runtime support from the language, and instead works by transforming plain synchronous functions at compile-time.</p><p>When compiling the earlier shown asynchronous sleep example:</p><web-copy-code><pre class=language-js><code class=language-js><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">async_sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>Asyncify takes this code and transforms it to roughly like the following one (pseudo-code, real transformation is more involved than this):</p><web-copy-code><pre class=language-js><code class=language-js><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">mode <span class="token operator">==</span> <span class="token constant">NORMAL_EXECUTION</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">async_sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">saveLocals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    mode <span class="token operator">=</span> <span class="token constant">UNWINDING</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">mode <span class="token operator">==</span> <span class="token constant">REWINDING</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">restoreLocals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    mode <span class="token operator">=</span> <span class="token constant">NORMAL_EXECUTION</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>Initially <code>mode</code> is set to <code>NORMAL_EXECUTION</code>. Correspondingly, the first time such transformed code is executed, only the part leading up to <code>async_sleep()</code> will get evaluated. As soon as the asynchronous operation is scheduled, Asyncify saves all the locals, and unwinds the stack by returning from each function all the way to the top, this way giving control back to the browser event loop.</p><p>Then, once <code>async_sleep()</code> resolves, Asyncify support code will change <code>mode</code> to <code>REWINDING</code>, and call the function again. This time, the "normal execution" branch is skipped - since it already did the job last time and I want to avoid printing "A" twice - and instead it comes straight to the "rewinding" branch. Once it's reached, it restores all the stored locals, changes mode back to "normal" and continues the execution as if the code were never stopped in the first place.</p><h3 id=transformation-costs>Transformation costs <a href=#transformation-costs class=w-headline-link>#</a></h3><p>Unfortunately, Asyncify transform isn't completely free, since it has to inject quite a bit of supporting code for storing and restoring all those locals, navigating the call stack under different modes and so on. It tries to modify only functions marked as asynchronous on the command line, as well as any of their potential callers, but the code size overhead might still add up to approximately 50% before compression.</p><img alt="A graph showing code size overhead for various benchmarks, from near-0% under fine-tuned conditions to over 100% in worst cases" height=494 src="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format" width=800 decoding=async loading=lazy sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/Im4hmQOYRHFcsg8UTfTR.png?auto=format&w=1600 1600w"><p>This isn't ideal, but in many cases acceptable when the alternative is not having the functionality altogether or having to make significant rewrites to the original code.</p><p>Make sure to always enable optimizations for the final builds to avoid it going even higher. You can also check <a href=https://emscripten.org/docs/porting/asyncify.html#optimizing rel=noopener>Asyncify-specific optimization options</a> to reduce the overhead by limiting transforms only to specified functions and/or only direct function calls. There is also a minor cost to runtime performance, but it's limited to the async calls themselves. However, compared to the cost of the actual work, it's usually negligible.</p><h2 id=real-world-demos>Real-world demos <a href=#real-world-demos class=w-headline-link>#</a></h2><p>Now that you've looked at the simple examples, I'll move on to more complicated scenarios.</p><p>As mentioned in the beginning of the article, one of the storage options on the web is an asynchronous <a href=https://web.dev/file-system-access/ >File System Access API</a>. It provides access to a real host filesystem from a web application.</p><p>On the other hand, there is a de-facto standard called <a href=https://github.com/WebAssembly/WASI rel=noopener>WASI</a> for WebAssembly I/O in the console and the server-side. It was designed as a compilation target for system languages, and exposes all sorts of file system and other operations in a traditional synchronous form.</p><p>What if you could map one to another? Then you could compile any application in any source language with any toolchain supporting the WASI target, and run it in a sandbox on the web, while still allowing it to operate on real user files! With Asyncify, you can do just that.</p><p>In this demo, I've compiled Rust <a href=https://github.com/RReverser/coreutils rel=noopener>coreutils</a> crate with a few minor patches to WASI, passed via Asyncify transform and implemented asynchronous <a href=https://github.com/GoogleChromeLabs/wasi-fs-access/blob/main/src/bindings.ts rel=noopener>bindings</a> from WASI to File System Access API on the JavaScript side. Once combined with <a href=https://xtermjs.org/ rel=noopener>Xterm.js</a> terminal component, this provides a realistic shell running in the browser tab and operating on real user files - just like an actual terminal.</p><p><video><source src=https://storage.googleapis.com/web-dev-uploads/video/9oK23mr86lhFOwKaoYZ4EySNFp02/4244yB6c9RbMCjGjP8ZW.mp4 type=video/mp4></video></p><p>Check it out live at <a href=https://wasi.rreverser.com/ rel=noopener>https://wasi.rreverser.com/</a>.</p><p>Asyncify use-cases are not limited just to timers and filesystems, either. You can go further and use more niche APIs on the web.</p><p>For example, also with the help of Asyncify, it's possible to map <a href=https://github.com/libusb/libusb rel=noopener>libusb</a>—probably the most popular native library for working with USB devices—to a <a href=https://web.dev/usb/ >WebUSB API</a>, which gives asynchronous access to such devices on the web. Once mapped and compiled, I got standard libusb tests and examples to run against chosen devices right in the sandbox of a web page.</p><img alt="Screenshot of libusb debug output on a web page, showing information about the connected Canon camera" height=548 src="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format" width=375 decoding=async loading=lazy sizes="(min-width: 375px) 375px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=200 200w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=228 228w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=260 260w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=296 296w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=338 338w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=385 385w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=439 439w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=500 500w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=571 571w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=650 650w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=741 741w, https://web-dev.imgix.net/image/9oK23mr86lhFOwKaoYZ4EySNFp02/2rscL8dyhOVMacuq54Ad.jpg?auto=format&w=750 750w"><p>It's probably a story for another blog post though.</p><p>Those examples demonstrate just how powerful Asyncify can be for bridging the gap and porting all sorts of applications to the web, allowing you to gain cross-platform access, sandboxing, and better security, all without losing functionality.</p><div class=w-chips><a href=/tags/webassembly/ class=w-chip>WebAssembly</a> <a href=/tags/file-system/ class=w-chip>File System</a></div><div class="w-mb--l w-mt--l w-post-github-link"><span class=w-mr--sm>Last updated: <time>Apr 26, 2021</time> </span><a href=https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/asyncify/index.md>Improve article</a></div><web-feedback additional-questions=""></web-feedback></div><nav class=w-article-navigation><a href=/blog class="gc-analytics-event w-article-navigation__link w-article-navigation__link--back w-article-navigation__link--single" data-category=web.dev data-label="navigation, go back" data-action=click>Return to all articles</a></nav></div></div></main><footer class=w-footer><nav class=w-footer__linkboxes><ul class=w-footer__linkboxes-list><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Contribute</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title=" class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">File a bug</a></li><li class=w-footer__linkbox-item><a href=https://github.com/googlechrome/web.dev class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">View source</a></li></ul></li><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Related content</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href=https://blog.chromium.org/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">Chrome updates</a></li><li class=w-footer__linkbox-item><a href=https://developers.google.com/web/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">Web Fundamentals</a></li><li class=w-footer__linkbox-item><a href=https://developers.google.com/web/showcase/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">Case studies</a></li><li class=w-footer__linkbox-item><a href=https://devwebfeed.appspot.com/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">DevWeb Content Firehose</a></li><li class=w-footer__linkbox-item><a href=/podcasts/ class=w-footer__linkbox-link data-category=Podcasts data-label="Footer Link (index 5)">Podcasts</a></li><li class=w-footer__linkbox-item><a href=/shows/ class=w-footer__linkbox-link data-category=Shows data-label="Footer Link (index 6)">Shows</a></li></ul></li><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Connect</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href=https://www.twitter.com/ChromiumDev class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">Twitter</a></li><li class=w-footer__linkbox-item><a href=https://www.youtube.com/user/ChromeDevelopers class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">YouTube</a></li></ul></li></ul></nav><div class=w-footer__utility><nav class=w-footer__utility-nav><a href=https://developers.google.com/ class=w-footer__utility-logo-link data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link"><img alt="Google Developers" height=33 src=/images/lockup-color.png width=185 class=w-footer__utility-logo loading=lazy></a><ul class=w-footer__utility-list><li class=w-footer__utility-item><a href=https://developer.chrome.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">Chrome</a></li><li class=w-footer__utility-item><a href=https://firebase.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Firebase Link">Firebase</a></li><li class=w-footer__utility-item><a href=https://cloud.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Google Cloud Platform Link">Google Cloud Platform</a></li><li class=w-footer__utility-item><a href=https://developers.google.com/products class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer All products Link">All products</a></li></ul><web-language-select current=en></web-language-select></nav><nav class=w-footer__utility-nav><ul class=w-footer__utility-list><li class=w-footer__utility-item><a href=https://policies.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Terms and Privacy link">Terms & Privacy</a></li><li class=w-footer__utility-item><a href=/community-guidelines/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Community Guidelines link">Community Guidelines</a></li></ul><div class=w-footer__license><p>Except as otherwise noted, the content of this page is licensed under the <a href=https://creativecommons.org/licenses/by/4.0/ >Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href=https://www.apache.org/licenses/LICENSE-2.0>Apache 2.0 License</a>. For details, see the <a href=https://developers.google.com/terms/site-policies>Google Developers Site Policies</a>.</p></div></nav></div></footer></body></html>