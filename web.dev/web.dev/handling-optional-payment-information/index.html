<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><style>@charset "UTF-8";@keyframes unsupported-appear{0%,to{visibility:hidden}}@keyframes hold-visibility{0%,to{visibility:visible}}@keyframes loading-progress-before{0%{transform:translate(-50%)}to{transform:translate(100vw) translate(-50%)}}@keyframes equalizer-morph{0%{transform:scaleY(1)}25%{transform:scaleY(.3)}50%{transform:scaleY(.7)}75%{transform:scaleY(.15)}}.overflow-hidden{overflow:hidden}*,::after,::before{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}:focus{outline:1px solid #3740ff}.w-force-focus{outline:0!important}div,form,li,ol,th,ul{margin:0;padding:0}td{margin:0}input,q{hyphens:none}code,input,q{-moz-hyphens:none;-webkit-hyphens:none}:not([href])[id]::before{content:" ";display:block;height:calc(64px + 1.5rem);margin-top:calc(-64px - 1.5rem);pointer-events:none;visibility:hidden}:root{--flow-space:1em}body,html{font:400 12px/1.5 Segoe UI,system-ui,-apple-system,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;margin:0;overflow-wrap:break-word;padding:0;word-wrap:break-word}@media (min-width:241px){body,html{font:400 14px/1.5 Segoe UI,system-ui,-apple-system,sans-serif}}@media (min-width:321px){body,html{font:400 16px/1.5 Segoe UI,system-ui,-apple-system,sans-serif}}h1,h2,h3{color:#202124;margin:0;overflow:visible}h1{font:500 38px/1.3157894737 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:9px}@media (min-width:241px){h1{font:500 49px/1.3265306122 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:10px}}@media (min-width:321px){h1{font:500 56px/1.3214285714 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:11px}}h2{font:400 18px/1.3333333333 "Google Sans",sans-serif;margin-top:48px;margin-bottom:24px}@media (min-width:241px){h2{font:400 21px/1.3333333333 "Google Sans",sans-serif;margin-top:56px;margin-bottom:28px}}@media (min-width:321px){h2{font:400 24px/1.3333333333 "Google Sans",sans-serif;margin-top:64px;margin-bottom:32px}}h3{font:500 13.5px/1.4814814815 "Google Sans",sans-serif;margin-top:36px;margin-bottom:12px}@media (min-width:241px){h3{font:500 16px/1.375 "Google Sans",sans-serif;margin-top:42px;margin-bottom:14px}}@media (min-width:321px){h3{font:500 20px/1.2 "Google Sans",sans-serif;margin-top:48px;margin-bottom:16px}}p{font:400 13.5px/1.5555555556 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:27px;margin-bottom:27px}@media (min-width:241px){p{font:400 15px/1.8666666667 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:31.5px;margin-bottom:31.5px}}@media (min-width:321px){p{font:400 18px/1.7777777778 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:36px;margin-bottom:36px}}h1+*,h1+[class],h2+*,h2+[class],h3+*,h3+[class]{margin-top:0}address,cite,em{font-style:italic}strong{font-weight:500}main{padding-bottom:64px}@media print{main{padding-bottom:0}}img{-ms-interpolation-mode:bicubic;display:inline-block;height:auto;max-width:100%;vertical-align:middle}input[type=email],input[type=text]{border:1px solid #dadce0;font:inherit;font-size:inherit;padding:14px 8px;width:100%}input[type=email]:focus,input[type=text]:focus{border-color:#3740ff;outline:0}input[type=radio]{-moz-appearance:none;-webkit-appearance:none;appearance:none;border:2px solid #dadce0;border-radius:50%;cursor:pointer;flex-shrink:0;height:24px;margin:2px;width:24px}input[type=radio]:checked{background-clip:content-box;background-color:#3740ff;border:2px solid #3740ff;padding:4px}a{color:#3740ff;text-decoration:none}a:active,a:focus,a:hover{text-decoration:underline}a:active,a:focus{outline:1px solid #3740ff}.w-post-content :link,.w-post-content :visited,.w-post-content a{text-decoration:underline}.w-post-content :link:active,.w-post-content :link:focus,.w-post-content :link:hover,.w-post-content :visited:active,.w-post-content :visited:focus,.w-post-content :visited:hover,.w-post-content a:active,.w-post-content a:focus,.w-post-content a:hover{text-decoration:none}p :link:active,p :visited:active,p a:active{background-color:rgba(55,64,255,.16)}a code,td a code{color:#3740ff}ol:not([class]),ul:not([class]){list-style:none;margin:32px 0;position:relative}ol:not([class]){counter-reset:ol-step-counter;padding-left:32px}ol:not([class])>li{counter-increment:ol-step-counter}ol:not([class])>li::before,ul:not([class])>li::before{background:#5f6368;border-radius:50%;color:#fff;left:0;position:absolute}ol:not([class])>li::before{-ms-flex-align:center;-ms-flex-negative:0;-ms-flex-pack:center;-webkit-box-align:center;-webkit-box-pack:center;align-items:center;content:counter(ol-step-counter);display:-ms-inline-flexbox;display:-webkit-inline-box;display:inline-flex;flex-shrink:0;font-size:.75em;height:20px;justify-content:center;margin:6px 0 0;width:20px}ul:not([class]){padding-left:24px}ol:not([class])>li,ul:not([class])>li{font-size:1.125rem;line-height:1.778rem;margin-bottom:8px}ul:not([class])>li::before{content:"";height:8px;margin:12px 0 0;width:8px}li>ol:not([class]),li>ul:not([class]),ol:not([class])>li>p,ul:not([class])>li>p{margin:8px 0}ol:not([class])>li>p:first-child,table ol:not([class]):first-child,table ul:not([class]):first-child,ul:not([class])>li>p:first-child{margin-top:0}ol:not([class])>li>p:last-child,table ol:not([class]):last-child,table ul:not([class]):last-child,ul:not([class])>li>p:last-child{margin-bottom:0}select{-moz-appearance:none;-webkit-appearance:none;appearance:none;background-color:#fff;background-image:url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10L12 15L17 10H7Z' fill='%235F6368'/%3E%3C/svg%3E%0A");background-position:right .5em top 50%;background-repeat:no-repeat;background-size:1.5em;border-radius:1px;border:1px solid #dadce0;box-sizing:border-box;color:inherit;display:block;font-family:inherit;font-size:1em;line-height:1.5;margin:0;max-width:100%;padding:.6em 3em .5em .8em}select::-ms-expand{display:none}select:-moz-focusring{color:transparent;text-shadow:0 0 0 #000}select:hover{border-color:#9aa0a6}select option{font-weight:400}.w-select--borderless{border-color:transparent}.w-select--borderless:hover{border-color:transparent;background-color:#f1f3f4}.w-table-wrapper{margin:32px 0;overflow:auto;background:linear-gradient(to right,#fff 30%,rgba(255,255,255,0)),linear-gradient(to right,rgba(255,255,255,0),#fff 70%) 0 100%,radial-gradient(farthest-side at 0 50%,rgba(0,0,0,.2),transparent),radial-gradient(farthest-side at 100% 50%,rgba(0,0,0,.2),transparent) 0 100%;background-repeat:no-repeat;background-color:#fff;background-size:40px 100%,40px 100%,14px 100%,14px 100%;background-position:0 0,100%,0 0,100%;background-attachment:local,local,scroll,scroll}table{border-collapse:collapse;font-size:inherit;margin:0;min-width:512px;width:100%}tr{background:0 0;border-bottom:1px solid #dadce0;border-top:0;height:48px}tr:last-of-type{border-bottom:0}td,th{color:inherit;min-width:120px;text-align:left}th{font-family:"Google Sans",sans-serif;font-size:.875em;font-weight:500;line-height:24px;padding-right:24px;vertical-align:middle}td{line-height:1.5;padding:16px 24px 16px 0}table code{background:0 0;border:0;font-size:.9em;font-weight:400;line-height:1.7em;margin:0;padding:0}table ol:not([class]),table ul:not([class]){margin:24px 0;padding-left:40px}table ol:not([class]) li,table ul:not([class]) li{font-size:inherit;line-height:inherit}table ul:not([class]) li::before{margin:8px 0 0}table ol:not([class]) li::before{margin:2px 0 0}td>:last-child>li:last-child{margin-bottom:0}code{margin:0 .25em;padding:.125em .25em}code,pre{background:#f7f7f7;border:1px solid #dadce0;color:#202124;font:1rem/1.5em SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;hyphens:none;tab-size:2;text-align:left;word-spacing:normal}:not(pre)>code{white-space:pre-wrap}pre,pre[class*=language-]{margin:32px -24px;border-width:1px 0;overflow:auto;padding:16px;white-space:pre;scrollbar-color:#80868b transparent;scrollbar-width:thin}pre::-webkit-scrollbar,pre[class*=language-]::-webkit-scrollbar{height:10px;width:10px}pre::-webkit-scrollbar-thumb,pre[class*=language-]::-webkit-scrollbar-thumb{background:#80868b;background-clip:padding-box;border:2.5px solid transparent;border-radius:5px}pre::-webkit-scrollbar-thumb:hover,pre[class*=language-]::-webkit-scrollbar-thumb:hover{background-color:#62676c}pre::-webkit-scrollbar-thumb:active,pre[class*=language-]::-webkit-scrollbar-thumb:active{background-color:#4a4e51}pre::-webkit-scrollbar-track,pre[class*=language-]::-webkit-scrollbar-track{background:0 0}@media (min-width:481px){pre,pre[class*=language-]{margin:32px -32px}}@media (min-width:865px){pre,pre[class*=language-]{margin:32px 0;border-width:1px}}pre code,pre[class*=language-] code{font-size:1em;line-height:1.5em;margin:0;padding:0}pre code{background:0 0;border:0}h1 code,h2 code,h3 code{background:0 0;border:0;color:inherit;font-size:inherit;margin:0;padding:0;white-space:normal}cite code,figcaption code{font-size:.9em}.token.comment{color:#696969}.token.punctuation,.token.string{color:#183691}.token.property,.token.tag{color:#385d34}.token.boolean,.token.number{color:#007aa2}.token.important,.token.keyword{color:#9f1c59}.token.operator,.token.url{color:#a71d5d}video{max-width:100%}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/cyrillic.woff2) format("woff2");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/greek.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/vietnamese.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/latin-ext.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/latin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/cyrillic.woff2) format("woff2");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/greek.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/vietnamese.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/latin-ext.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/latin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:url(/fonts/material-icons/regular.woff2) format("woff2")}.scrollbar,.w-table-wrapper,.w-toc__content{scrollbar-color:#9aa0a6 transparent;scrollbar-width:thin}.scrollbar::-webkit-scrollbar,.w-table-wrapper::-webkit-scrollbar,.w-toc__content::-webkit-scrollbar{height:6px;width:6px}.scrollbar::-webkit-scrollbar-thumb,.w-table-wrapper::-webkit-scrollbar-thumb,.w-toc__content::-webkit-scrollbar-thumb{background:#9aa0a6;background-clip:padding-box;border:1.5px solid transparent;border-radius:3px}.scrollbar::-webkit-scrollbar-thumb:hover,.w-table-wrapper::-webkit-scrollbar-thumb:hover,.w-toc__content::-webkit-scrollbar-thumb:hover{background-color:#798189}.scrollbar::-webkit-scrollbar-thumb:active,.w-table-wrapper::-webkit-scrollbar-thumb:active,.w-toc__content::-webkit-scrollbar-thumb:active{background-color:#61686e}.scrollbar::-webkit-scrollbar-track,.w-table-wrapper::-webkit-scrollbar-track,.w-toc__content::-webkit-scrollbar-track{background:0 0}.w-visually-hidden{clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(1px);display:block;height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}:root{--list-separator:"·";--list-separator-gap:0.5rem}.w-actions{align-items:flex-end;bottom:24px;display:flex;flex-direction:column;position:fixed;right:24px;z-index:100}@media print{.w-actions{display:none}}.w-actions>*{margin-top:20px}.w-actions__fab{align-items:center;background-color:#3740ff;border:0;border-radius:50%;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);color:#fff;cursor:pointer;display:inline-flex;font-family:Segoe UI,system-ui,-apple-system,sans-serif;font-size:.875em;font-weight:600;height:56px;letter-spacing:1px;overflow:hidden;padding:0;position:relative;text-indent:-9999px;text-overflow:initial;text-transform:uppercase;width:56px}@media (min-width:1264px){.w-actions__fab{border-radius:28px;padding:0 24px 0 52px;text-indent:0;width:auto}}.w-actions__fab:active,.w-actions__fab:hover{background-color:#3740ff}.w-actions__fab:active{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.w-actions__fab:active,.w-actions__fab:focus,.w-actions__fab:hover{outline:0;text-decoration:none}.w-actions__fab::before{background-size:24px 24px;content:"";height:24px;left:16px;position:absolute;top:16px;width:24px}.w-actions__fab::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}.w-actions__fab:hover::after{background-color:rgba(255,255,255,.08)}.w-actions__fab:focus::after{background-color:rgba(255,255,255,.24)}.w-actions__fab:active::after{background-color:rgba(255,255,255,.32)}.w-actions__fab--share::before{background-image:url(/images/icons/share_white.svg)}.w-actions__fab--subscribe{background-color:#fff;color:#3740ff}.w-actions__fab--subscribe:active,.w-actions__fab--subscribe:hover{background-color:#fff}.w-actions__fab--subscribe::before{background-image:url(/images/icons/subscribe.svg)}.w-actions__fab--subscribe:hover::after{background-color:rgba(55,64,255,.04)}.w-actions__fab--subscribe:focus::after{background-color:rgba(55,64,255,.12)}.w-actions__fab--subscribe:active::after{background-color:rgba(55,64,255,.16)}:root{--app-bar-height:64px}.w-article-header{margin:0 0 48px;padding-top:40px}@media (min-width:865px){.w-article-header{margin:0 0 64px;padding-top:56px}}@media print{.w-article-header{margin:0;padding-top:0}}.w-article-header__headline{font-size:27px;font-weight:400;line-height:33px;margin:0 auto 11px}@media (min-width:241px){.w-article-header__headline{font-size:31px;line-height:38px}}@media (min-width:321px){.w-article-header__headline{font-size:36px;line-height:44px}}@media (min-width:865px){.w-article-header__headline{font-size:44px;line-height:52px}}.w-article-header__subhead{font-family:"Google Sans",sans-serif;font-size:16px;line-height:28px;margin:12px auto}@media (min-width:241px){.w-article-header__subhead{font-size:18px;line-height:32px;margin:16px auto}}.w-article-navigation{background-color:#dadce0;display:flex;flex-direction:column;padding:1px 0}@media (min-width:481px){.w-article-navigation{flex-direction:row}}@media print{.w-article-navigation{display:none}}.w-article-navigation__link{align-items:center;background-color:#fff;color:#202124;display:flex;font-family:"Google Sans",sans-serif;position:relative}.w-article-navigation__link:active,.w-article-navigation__link:focus,.w-article-navigation__link:hover{background-color:#fff;outline:0;text-decoration:none}.w-article-navigation__link::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal}.w-article-navigation__link::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}.w-article-navigation__link:hover::after{background-color:rgba(32,33,36,.04)}.w-article-navigation__link:focus::after{background-color:rgba(32,33,36,.12)}.w-article-navigation__link:active::after{background-color:rgba(32,33,36,.16)}.w-article-navigation__link--back{flex-basis:33.3%;margin:0 0 1px;padding:32px 32px 32px 80px}@media (min-width:481px){.w-article-navigation__link--back{margin:0 1px 0 0}}.w-article-navigation__link--back::before,.w-aside::after{content:"arrow_back";left:32px;position:absolute}.w-article-navigation__link--single{flex:1;margin:0}@media (min-width:481px){.w-article-navigation__link--single{margin:0}}.w-article-navigation code{background:0 0;border:0;color:inherit;padding:0}.w-aside{font-family:Segoe UI,system-ui,-apple-system,sans-serif;font-size:13.5px;line-height:21px;margin:48px 0 32px;padding:24px 0 0 48px;position:relative}@media (min-width:241px){.w-aside{font-size:15px;line-height:28px}}@media (min-width:321px){.w-aside{font-size:18px;line-height:32px}}.w-aside strong{font-weight:700}.w-aside::after{content:"";height:2px;left:0;right:0;top:0}.w-aside::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;float:left;margin:4px 0 0 -48px}.w-aside--note{color:#3740ff}.w-aside--note::after{background-color:#3740ff}.w-aside--note::before{content:"star"}.w-aside--warning{color:#eb0f00}.w-aside--warning::after{background-color:#eb0f00}.w-aside--warning::before{content:"warning"}.w-aside--key-term{color:#6001ff}.w-aside--key-term::after{background-color:#6001ff}.w-aside--key-term::before{content:"font_download"}.w-aside a,.w-aside code,.w-aside p{color:inherit}.w-aside code{white-space:pre-wrap}.w-aside pre,.w-aside pre code{font-size:.889em;line-height:1.5;white-space:pre}.w-aside a{text-decoration:underline}.w-aside p{font-family:inherit;letter-spacing:normal;margin:0}.w-aside p+p{margin-top:8px}.w-aside p,.w-aside ul li{font-size:inherit;line-height:inherit}.w-authors{display:flex;flex-wrap:wrap;gap:32px}.w-author{display:flex;padding:8px}.w-author__image{background-color:#dadce0;border-radius:50%;border:2px solid #fff;flex-shrink:0;height:64px;margin:0 12px 0 0;min-width:64px;object-fit:cover;overflow:hidden;width:64px}.w-author__name,.w-author__published{display:block;font-size:14px;font-style:normal}.w-author__name{color:#202124}.w-author__name-link{display:inline-block;color:inherit}.w-author__name-link:focus,.w-author__name-link:hover{text-decoration:none}.w-post-content .w-author__name-link{text-decoration:none}.w-post-content .w-author__name-link:focus,.w-post-content .w-author__name-link:hover{text-decoration:underline}.w-author__published{color:#5f6368}.w-author__link,web-event-schedule{display:block}.w-author__link-list{display:flex;flex-wrap:wrap;list-style:none;overflow:hidden;margin-top:9px}.w-author__link-listitem{font-size:14px;display:flex}.w-author__link-listitem+.w-author__link-listitem::before{content:"·";display:block;margin:0 4px}.w-author__link:focus{box-shadow:inset 0 0 0 1px #3740ff;outline:0}.w-button{-webkit-tap-highlight-color:transparent;align-items:center;background:0 0;border:0;border-radius:3px;color:#3740ff;cursor:pointer;display:inline-flex;font:500 .875rem/2.25rem Segoe UI,system-ui,-apple-system,sans-serif;height:56px;justify-content:center;letter-spacing:1px;outline:0;padding:0 16px;text-decoration:none;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;overflow:hidden;position:relative;transition:background-color .2s,box-shadow .2s;vertical-align:middle;white-space:nowrap}.w-button::-moz-focus-inner{border:0}@media (hover:hover){.w-button:focus,.w-button:hover{background:#fff;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);outline:0;text-decoration:none}}.w-button:active{background:#fff;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);outline:0;text-decoration:none}.w-button:focus{outline:1px solid rgba(55,64,255,.8);outline-offset:-3px}.w-button[disabled]{background:#dadce0;box-shadow:none;color:rgba(0,0,0,.26);cursor:default;pointer-events:none}.w-button::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}@media (hover:hover){.w-button:hover::after{background-color:rgba(55,64,255,.04)}.w-button:focus::after{background-color:rgba(55,64,255,.12)}}.w-button:active::after{background-color:rgba(55,64,255,.16)}.w-button--primary,.w-button--primary:active,.w-button--primary:focus,.w-button--primary:hover{background-color:#3740ff;color:#fff}@media (hover:hover){.w-button--primary:hover::after{background-color:rgba(255,255,255,.08)}.w-button--primary:focus::after{background-color:rgba(255,255,255,.24)}}.w-button--primary:active::after{background-color:rgba(255,255,255,.32)}.w-button--primary:focus{outline:1px solid rgba(255,255,255,.8)}.w-button--secondary,.w-button--secondary:active,.w-button--secondary:focus,.w-button--secondary:hover{background-color:#fff;border:1px solid #dadce0;color:#202124}@media (hover:hover){.w-button--secondary:hover::after{background-color:rgba(0,0,0,.04)}.w-button--secondary:focus::after{background-color:rgba(0,0,0,.08)}}.w-button--secondary:active::after{background-color:rgba(0,0,0,.1)}.w-button--secondary:focus{outline:1px solid rgba(32,33,36,.6)}.w-button--icon,.w-button--svg{-webkit-tap-highlight-color:transparent;align-items:center;background:0 0;border:0;border-radius:3px;cursor:pointer;display:inline-flex;font:500 .875rem/2.25rem Segoe UI,system-ui,-apple-system,sans-serif;height:56px;justify-content:center;letter-spacing:1px;outline:0;position:relative;text-decoration:none;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;color:#5f6368;height:3rem;overflow:unset;padding:0;transition:background .2s ease,color .2s ease;width:3rem}@media (hover:hover){.w-button--icon:focus,.w-button--icon:hover,.w-button--svg:focus,.w-button--svg:hover{background:#f1f3f4;color:#202124}}.w-button--icon:active,.w-button--svg:active{background:#e8eaed}.w-button--icon:focus,.w-button--svg:focus{box-shadow:0 0 0 1px #3740ff;outline:0}.w-button--round{border-radius:50%}.w-button--icon::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;content:attr(data-icon);display:inline-block;height:24px;speak:none;width:24px;margin:0}.button{appearance:none;border:0;background:0 0;padding:0}.w-chips{display:flex;flex-flow:row wrap}.w-chip,.w-post-content .w-chip{background-color:transparent;border:1px solid rgba(32,33,36,.16);border-radius:20px;box-sizing:border-box;color:#202124;display:block;font-size:14px;height:32px;line-height:30px;margin:0 8px 12px 0;overflow:hidden;padding:0 12px;text-decoration:none;transition:background-color .2s,border .2s}.w-chip:active,.w-chip:focus,.w-chip:hover,.w-post-content .w-chip:active,.w-post-content .w-chip:focus,.w-post-content .w-chip:hover{outline:0;text-decoration:none}.w-chip:hover,.w-post-content .w-chip:hover{background-color:rgba(32,33,36,.04);border:1px solid rgba(32,33,36,.2)}.w-chip:focus,.w-post-content .w-chip:focus{background-color:rgba(32,33,36,.12);border:1px solid rgba(32,33,36,.28)}.w-chip:active,.w-post-content .w-chip:active{background-color:rgba(0,0,0,.16);border:1px solid rgba(32,33,36,.43);box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.w-callout__header{padding-bottom:1rem}.w-callout__lockup{font:500 13.5px/1.4814814815 "Google Sans",sans-serif;margin-top:36px;margin-bottom:12px;display:inline-flex;margin:0 0 .75rem!important}@media (min-width:241px){.w-callout__lockup{font:500 16px/1.375 "Google Sans",sans-serif;margin-top:42px;margin-bottom:14px}}@media (min-width:321px){.w-callout__lockup{font:500 20px/1.2 "Google Sans",sans-serif;margin-top:48px;margin-bottom:16px}}.w-callout__lockup::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;display:inline-block;font-size:20px;margin:0 8px 0 0}.w-callout__blurb{margin:0}.w-details{border:1px solid #dadce0;border-width:1px 0;margin:36px 0;padding:18px 0;position:relative}.w-details+.w-details{border-top:0;margin-top:-36px}.w-details__summary{-webkit-tap-highlight-color:transparent;cursor:pointer;font:inherit;list-style:none}.w-details__summary::marker{display:none}.w-details__summary:focus{outline:0}@media (hover:hover){.w-details__summary:focus .w-details__header::after,.w-details__summary:hover .w-details__header::after{background:#e7e8ff}}.w-details__summary:focus .w-details__header::after{box-shadow:0 0 0 1px #3740ff}.w-details__summary:active .w-details__header::after{background:#c3c6ff}.w-details__header{color:#3740ff;margin:0;padding:.75rem 40px .75rem 0;position:relative}.w-details__header::after{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;border-radius:50%;content:"expand_more";cursor:pointer;font-size:24px;padding:2px;position:absolute;right:1px;speak:none;top:50%;transform:translateY(-50%);transition:background .2s;visibility:visible}@media (min-width:321px){.w-details__header{padding:1.125em 48px 1.125em 0}.w-details__header::after{padding:.25em}}.w-details[open] .w-details__header::after{transform:rotate(180deg) translateY(50%)}.w-details__header:only-child{line-height:1.5rem;padding:.375rem 40px .375rem 0}h2.w-details__header:only-child{line-height:1.3333em;padding:.75rem 40px .75rem 0}.w-details>p:first-of-type{margin-top:0}.drawer-default__contents{background:#fff;display:flex;flex-direction:column;height:100vh;width:268px;max-width:90vw}.drawer-default__header{align-items:center;display:flex;padding:16px;border-bottom:1px solid #dadce0}.drawer-default__hide{height:2.75rem;margin:0 10px 0 -6px;width:2.75rem;color:#5f6368}.drawer-default__link{border-bottom:1px solid #dadce0;color:#5f6368;font-size:14px;font-weight:500;padding:16px 24px}.drawer-default__link[active]{-webkit-box-shadow:0 -2px 0 #3740ff inset;box-shadow:0 -2px 0 #3740ff inset}.drawer-default__link:active,.drawer-default__link:focus,.drawer-default__link:hover{text-decoration:none;outline:0}.drawer-default__link:hover{background-color:rgba(32,33,36,.04)}.drawer-default__link:focus{background-color:rgba(32,33,36,.12)}.drawer-default__link:active{background-color:rgba(32,33,36,.16)}.w-footer{border-top:1px solid #dadce0}@media print{.w-footer{display:none}}.w-footer__license{padding-top:32px;width:100%}.w-footer__license p{font-size:.75rem;margin:0;max-width:960px}.w-footer__linkboxes{background:#fff;display:block;font:400 14px/16px Segoe UI,system-ui,-apple-system,sans-serif}.w-footer__linkboxes-list{display:block;list-style:none;padding:24px 0}@media (min-width:865px){.w-footer__linkboxes-list{display:flex;padding:24px 12px 0}}.w-footer__linkbox{flex-grow:1;padding:0 16px 24px}@media (min-width:865px){.w-footer__linkbox{flex:1;margin:0}}.w-footer__linkbox:last-of-type{padding:0 16px}.w-footer__linkbox-heading{font:500 14px/16px Segoe UI,system-ui,-apple-system,sans-serif;margin:0 0 8px}.w-footer__linkbox-list{list-style-type:none;padding:0}.w-footer__linkbox-item{margin:0}.w-footer__linkbox-link{color:#202124;display:block;padding:16px 0}.w-footer__linkbox-link:focus,.w-footer__linkbox-link:hover,.w-footer__utility-link:focus,.w-footer__utility-link:hover{color:#3740ff;text-decoration:none}.w-footer__utility{background:#fff;display:block}.w-footer__utility-nav{border-top:1px solid #ddd;display:block;font:400 14px/16px Segoe UI,system-ui,-apple-system,sans-serif;margin:0 16px;padding:24px 0}@media (min-width:865px){.w-footer__utility-nav{align-items:center;display:flex;flex-wrap:wrap;margin:0 24px}}.w-footer__utility-list{display:block;list-style:none;padding:0}@media (min-width:865px){.w-footer__utility-list{align-items:center;display:flex;flex:1;flex-wrap:wrap}}.w-footer__utility-item{margin:0}@media (min-width:865px){.w-footer__utility-item{margin-right:40px}}.w-footer__utility-link{color:#202124;display:block;padding:16px 0}.w-footer__utility-logo-link{display:block;line-height:1;margin-right:40px}.w-footer__utility-logo{margin:-2px 0 16px;max-width:185px}@media (min-width:865px){.w-footer__utility-logo{margin:-2px 0 0}}.header-default{position:fixed;top:0}.header-default [data-open-drawer-button]{margin:0 8px 0 -8px}@media (min-width:865px){.header-default [data-open-drawer-button]{display:none}}.header-default__middle{align-items:center;display:flex;flex:1;height:100%;overflow:hidden;position:relative}.header-default__links{display:none;flex:1;height:100%;line-height:20px;min-width:50%;padding-left:48px}@media (min-width:865px){.header-default__links{display:flex}}.header-default__link{align-items:center;color:#202124;display:flex;font-weight:500;margin:0;padding:0 16px;position:relative}.header-default__link[active]{box-shadow:0 -2px 0 #3740ff inset}@media (min-width:1264px){.header-default__link{padding:0 24px}}.header-default__link:active,.header-default__link:focus,.header-default__link:hover{outline:0;text-decoration:none}.header-default__link:hover{background-color:rgba(32,33,36,.04)}.header-default__link:focus{background-color:rgba(32,33,36,.12)}.header-default__link:active{background-color:rgba(32,33,36,.16)}.header-default web-search{flex:1}@media (min-width:865px){.header-default web-search .web-search__input-wrapper{max-width:calc(200% - 16px*2);min-width:calc(200% - 16px*2);transform:translateX(calc(50% - 200px + 16px));transition:var(--web-search-animation-time) transform;width:calc(200% - 16px*2);display:flex}.header-default web-search .web-search__close-btn,.header-default web-search .web-search__open-btn{display:none}.header-default web-search[expanded] .web-search__input-wrapper{transform:translate(calc(-50% + 16px))}}.header-default .web-search-popout{border-top:1px solid #ddd;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15);left:0;padding:16px 0;position:absolute;top:55px;width:calc(100% - 45px)}@media (min-width:865px){.header-default .web-search-popout{left:calc(16px*2);width:calc(100% - 16px*2)}}web-header.web-header--has-expanded-search .header-default__logo-link,web-header.web-header--has-expanded-search web-profile-switcher-container,web-table-of-contents,web-table-of-contents-button[opened]{display:none}@media (min-width:865px){web-header.web-header--has-expanded-search .header-default__logo-link{display:inline}}web-header.web-header--has-expanded-search .header-default__middle{overflow:visible}@media (min-width:865px){web-header.web-header--has-expanded-search web-profile-switcher-container{display:flex}}.header-default~main{margin-top:64px}.icon{fill:currentColor}.w-screenshot{border:1px solid #dadce0;padding:4px;box-sizing:content-box;margin-left:-5px}.w-screenshot+.w-screenshot{margin-top:32px}.w-figure{margin:32px 0;text-align:center}.w-figcaption{font-size:.875em;line-height:1.5em;margin:16px 0 0}.w-layout-container--narrow{box-sizing:content-box;margin:0 auto;overflow:visible;padding:24px}@media (min-width:481px){.w-layout-container--narrow{padding:32px}}.w-layout-container--narrow{max-width:800px}:root{--grid-min:150px;--grid-max:.5fr;--grid-gap:24px}.w-label{opacity:.7;margin-bottom:4px}.w-label+web-copy-code{display:block;margin-top:-28px}web-livestream-container{background-color:#fff;display:flex;margin:auto;max-width:1600px}@media (min-width:865px){web-livestream-container{border-left:1px solid #dadce0;border-right:1px solid #dadce0}}web-subscribe:not(:defined){display:flex;justify-content:center;width:100%}.w-subscribe__error{color:#eb0f00}@media (min-width:865px){main.w-toc-open>*{width:calc(100% - 268px)}main.w-toc-open>* .w-actions{right:calc(24px + 268px)}}web-table-of-contents h2{line-height:32px}web-table-of-contents .w-scroll-spy__active{position:relative;display:inline-block}web-table-of-contents .w-scroll-spy__active::before{content:"";display:inline-block;border-left:3px solid #3740ff;margin-left:-24px;padding-left:21px;height:100%;position:absolute;top:0;left:0}web-table-of-contents[opened]{background-color:#fff;border-bottom:1px solid #dadce0;border-top:1px solid #dadce0;display:block;padding:24px 0;top:63px;width:100%;z-index:100}@media (min-width:481px){web-table-of-contents[opened]{padding-top:32px}}@media (min-width:865px){web-table-of-contents[opened]{border-bottom:0;border-left:1px solid #dadce0;border-top:0;height:calc(100% - 64px);position:fixed;right:0;width:268px}}.w-toc__button--open{background-color:#fff;border:1px solid #dadce0;height:40px;overflow:hidden;padding:8px}web-table-of-contents-button{display:flex;height:0;justify-content:flex-end;margin-bottom:-24px;margin-right:24px;padding-top:24px;top:64px;z-index:1}@media (min-width:481px){web-table-of-contents-button{margin-bottom:-32px;padding-top:32px}}@media (min-width:865px){web-table-of-contents-button{max-height:none;position:sticky}}@media print{web-table-of-contents-button{display:none}}.w-toc__content{height:calc(100% - 24px);overflow-y:auto;padding:0 24px}@media (min-width:481px){.w-toc__content{height:calc(100% - 32px)}}.w-toc__content a{display:inline-block}.w-toc__header{margin-bottom:12px;margin-top:12px}.w-toc__header--link{font-family:"Google Sans",sans-serif;font-size:1.2rem;font-weight:500}@media (min-width:865px){.w-toc__header--link{color:#202124}.w-toc__header--link.w-scroll-spy__active,.w-toc__header--link:hover{color:#3740ff}}.w-toc__label{display:flex;height:40px;justify-content:space-between;padding:0 24px}.w-toc__label>*{font-size:.9rem;height:40px;line-height:40px;vertical-align:middle}.w-toc__list ul{margin:0;padding:0}.w-toc__list ul li::before{content:none}.w-toc__list ul li a{font-size:1rem}@media (min-width:865px){.w-toc__list ul li a{color:#202124}.w-toc__list ul li a.w-scroll-spy__active,.w-toc__list ul li a:hover{color:#3740ff}}.w-headline-link{color:transparent;display:none;font-weight:500;margin-left:4px}@media (min-width:481px){.w-headline-link{display:inline}}.w-headline-link:focus,:hover>.w-headline-link{color:#5f6368;display:inline}.w-tooltip{background:#000;border-radius:3px;color:#fff;font:500 12px/1 Segoe UI,system-ui,-apple-system,sans-serif;left:50%;letter-spacing:.3px;opacity:0;padding:6px 8px;pointer-events:none;position:absolute;text-transform:none;top:calc(100% + 3px);transform:scale(.85) translateX(-50%);transform-origin:top left;transition:opacity 75ms,transform 0s 75ms,visibility 0s 75ms;visibility:hidden;white-space:nowrap;z-index:1}.w-tooltip--left{left:0;transform:scale(.85)}.w-tooltip--right{left:100%;transform:translateX(-100%) scale(.85);transform-origin:top right}@media (hover:hover){:hover>.w-tooltip{opacity:.77;transform:scale(1) translateX(-50%);transition:opacity .15s .3s,transform .15s .3s,visibility 0s;visibility:visible}:hover>.w-tooltip--left{transform:scale(1)}:hover>.w-tooltip--right{transform:translateX(-100%) scale(1)}}:active>.w-tooltip,:focus .w-tooltip{opacity:.77;transform:scale(1) translateX(-50%);transition:opacity .15s .3s,transform .15s .3s,visibility 0s;visibility:visible}:active>.w-tooltip{transition:opacity .15s .5s,transform .15s .5s,visibility 0s}:active>.w-tooltip--left,:focus .w-tooltip--left{transform:scale(1)}:active>.w-tooltip--right,:focus .w-tooltip--right{transform:translateX(-100%) scale(1)}web-audio-fab{border-radius:50%;bottom:12px;box-shadow:0 8px 12px 6px rgba(60,64,67,.15),0 4px 4px rgba(60,64,67,.3);display:block;height:56px;opacity:0;pointer-events:none;position:fixed;right:12px;transition:opacity .2s cubic-bezier(.4,0,.2,1);width:56px;z-index:1}web-audio-fab[showing]{opacity:1;pointer-events:auto}web-copy-code{display:block;position:relative}web-copy-code:active .web-copy-code__button,web-copy-code:focus .web-copy-code__button,web-copy-code:hover .web-copy-code__button{opacity:1}web-copy-code .web-copy-code__button{color:#202124;height:48px;margin:8px;opacity:0;position:absolute;right:0;width:48px}web-copy-code .web-copy-code__button::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;content:"content_copy"}web-copy-code .web-copy-code__button:focus,web-copy-code .web-copy-code__button:hover{background-color:rgba(63,196,255,.2);opacity:1}web-copy-code .web-copy-code__button:active{background-color:rgba(63,196,255,.4);opacity:1}web-copy-code pre{min-height:64px}web-header{align-items:center;background:#fff;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15);color:#202124;contain:layout;display:flex;font-size:14px;height:64px;padding:0 24px;width:100%;z-index:200}@media print{web-header{display:none}}web-navigation-drawer{display:block;height:100%;left:0;pointer-events:none;position:fixed;top:0;width:100%;z-index:300}web-navigation-drawer [data-drawer-container]{box-shadow:2px 0 12px rgba(0,0,0,.4);position:relative;transform:translateX(-110%);width:fit-content}@media (min-width:1264px){web-navigation-drawer[type=standard]{align-self:flex-start;position:sticky;pointer-events:auto;top:0;width:auto}web-navigation-drawer[type=standard] [data-drawer-container]{box-shadow:none;transform:none}web-navigation-drawer[type=standard] [data-drawer-close-button]{visibility:hidden}}web-navigation-drawer::before{content:"";display:block;position:absolute;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.4);opacity:0;transition:opacity .2s cubic-bezier(.4,0,.2,1)}web-navigation-drawer[open]{pointer-events:auto;visibility:visible}web-navigation-drawer[open]::before{opacity:1}web-navigation-drawer[open] [data-drawer-container]{transform:none}web-navigation-drawer[animating] [data-drawer-container],web-navigation-drawer[open][animating] [data-drawer-container]{transition:transform .2s cubic-bezier(.4,0,.2,1)}.youtube{padding-top:56.25%;position:relative;width:100%;border-radius:8px;overflow:hidden}lite-youtube{height:100%;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%}web-codelab{display:flex;flex-flow:column;padding:16px}@media (min-width:865px){web-codelab{flex-flow:row}}web-codelab .web-codelab__glitch{min-height:160px}.w-event-carousel__day{color:#3c4043;font-family:"Google Sans",sans-serif;font-size:14px;font-weight:500;margin-right:16px}.w-event-carousel__day:last-child{margin-right:0}.w-event-carousel__day.w-event-carousel__pending{opacity:.6}.w-event-carousel__thumbnail{margin-bottom:8px;background-color:#e8eaed;border-radius:3px;overflow:hidden;width:178px;height:110px}.w-event-carousel__thumbnail>img{height:100%;object-fit:cover}.w-event-schedule__video{align-self:center;font-weight:500;z-index:1}web-progress-bar{background-color:#fff;visibility:hidden;z-index:1}.guide-landing-page{position:relative}.w-post-content{margin-bottom:64px}@media (min-width:481px){.w-post-content{margin-bottom:160px}}.w-post-github-link{color:#5f6368;font-size:.875em}.w-post-signpost{font-size:14px;font-style:normal;line-height:20px;margin-top:4px;padding:0 0 4px}.w-post-signpost__link{margin:0 0 4px}.w-post-signpost__title{color:#5f6368;margin:0 4px 4px 0}:root{--course-content-margin:24px}.w-text--center{text-align:center!important}.w-display--flex{display:flex}.w-justify-content--center{justify-content:center}.w-mb--non{margin-bottom:0!important}.w-mb--sm{margin-bottom:8px!important}.w-mt--sm{margin-top:8px!important}.w-mr--sm{margin-right:8px!important}.w-pt--sm{padding-top:8px!important}.w-mb--l{margin-bottom:32px!important}.w-mt--l{margin-top:32px!important}.w-mt--xl{margin-top:56px!important}.hidden,[hidden]{display:none!important}:not(body).unresolved,web-tabs.unresolved>:not(.w-tabs-default){display:none}web-tabs.unresolved{padding-top:50px;display:block}web-event-time.unresolved{min-height:120px;display:block}</style><link href=/fonts/material-icons/regular.woff2 rel=preload as=font crossorigin><link href=/fonts/google-sans/regular/latin.woff2 rel=preload as=font crossorigin><link href=/fonts/google-sans/bold/latin.woff2 rel=preload as=font crossorigin><meta content=#fff name=theme-color><title>Handling optional payment information with a service worker</title><meta content="Once a web-based payment app is registered, it's ready to accept payment requests from merchants. This article teaches you how to orchestrate a payment transaction from a service worker during runtime. " name=description><link href=https://web.dev/handling-optional-payment-information/ rel=canonical><meta content="Handling optional payment information with a service worker" itemprop=name><meta content="Once a web-based payment app is registered, it's ready to accept payment requests from merchants. This article teaches you how to orchestrate a payment transaction from a service worker during runtime. " itemprop=description><meta content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" itemprop=image><meta content=en_US property=og:locale><meta content=article property=og:type><meta content=https://web.dev/handling-optional-payment-information/ property=og:url><meta content=web.dev property=og:site_name><meta content="Handling optional payment information with a service worker" property=og:title><meta content="Once a web-based payment app is registered, it's ready to accept payment requests from merchants. This article teaches you how to orchestrate a payment transaction from a service worker during runtime. " property=og:description><meta content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" property=og:image><meta content="" property=og:image:alt><meta content=payments property=tag><meta content=service-worker property=tag><meta content=summary_large_image name=twitter:card><meta content="Handling optional payment information with a service worker" name=twitter:title><meta content="Once a web-based payment app is registered, it's ready to accept payment requests from merchants. This article teaches you how to orchestrate a payment transaction from a service worker during runtime. " name=twitter:description><meta content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" name=twitter:image><link href=/feed.xml rel=alternate type=application/atom+xml data-title="web.dev feed"><link href=/manifest.webmanifest rel=manifest><link href=/images/favicon.ico rel="shortcut icon"><link href=/images/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/images/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/images/safari-pinned-tab.svg rel=mask-icon color=#0054ff><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-126406676-2"),ga("set","transport","beacon"),ga("set","anonymizeIp",!0),ga("set","page",window.location.pathname),ga("set","dimension5","4"),ga("send","pageview");</script><script>function loadScript(e,t){const d=document.createElement("script");if(d.src=e,t&&(d.type=t),"module"===t){d.async=!1;const t=document.createElement("link");t.rel="modulepreload",t.href=e,document.head.append(t),window.addEventListener("DOMContentLoaded",(()=>{document.head.append(d)}))}else document.head.append(d)}loadScript("/js/app.js?v=c4d27698","module"),loadScript("/js/content.js?v=9e7685c5","module"),loadScript("https://www.google-analytics.com/analytics.js",null);</script></head><body class=unresolved><web-snackbar-container></web-snackbar-container><web-header class=header-default role=navigation><button aria-label="Open menu" class="w-button--round w-button--svg" data-open-drawer-button><svg aria-label=menu class=icon height=24 role=img viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z" fill=none /><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <span class="w-tooltip w-tooltip--left">Open menu</span></button> <a href=/ class="gc-analytics-event header-default__logo-link" data-category="Site-Wide Custom Events" data-label="Site logo"><img alt=web.dev class=header-default__logo height=30 src=/images/lockup.svg width=125></a><div class=header-default__middle><div class=header-default__links><a href=/learn/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Learn">Learn </a><a href=/measure/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Measure">Measure </a><a href=/blog/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Blog">Blog </a><a href=/about/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: About">About</a></div><web-search results-id=search-main-results></web-search><web-search-results id=search-main-results></web-search-results></div><web-profile-switcher-container></web-profile-switcher-container></web-header><web-navigation-drawer class=drawer-default type=modal><nav data-drawer-container><div class=drawer-default__contents><div class=drawer-default__header><button aria-label=Close class="w-button--round w-button--svg drawer-default__hide" data-drawer-close-button><svg aria-label=close class=icon height=24 role=img viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z" fill=none /><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <span class=w-tooltip>Close</span></button> <a href=/ class=gc-analytics-event data-category="Site-Wide Custom Events" data-label="Site logo"><img alt=web.dev class=drawer-default__logo height=30 src=/images/lockup.svg width=125></a></div><a href=/learn/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Learn">Learn </a><a href=/measure/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Measure">Measure </a><a href=/blog/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Blog">Blog </a><a href=/about/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: About">About</a></div></nav></web-navigation-drawer><main><div id=content><div class=guide-landing-page><web-table-of-contents><h2 class=w-toc__header><a href=#handling-optional-payment-information-with-a-service-worker class=w-toc__header--link>Handling optional payment information with a service worker</a></h2><div class=w-toc__list><ul><li><a href=#payment-method-changes>Inform the merchant of a payment method change</a></li><li><a href=#shipping-address-changes>Inform the merchant of a shipping address change</a></li><li><a href=#inform-the-merchant-of-a-shipping-option-change>Inform the merchant of a shipping option change</a></li><li><a href=#reflect-the-updated-payment-details>Reflect the updated payment details</a></li><li><a href=#sample-code>Sample code</a></li><li><a href=#next-steps>Next steps</a></li></ul></div></web-table-of-contents><web-table-of-contents-button></web-table-of-contents-button><div class=w-actions><share-action authors=@agektmr class="gc-analytics-event w-actions__fab w-actions__fab--share" data-action=click data-category=web.dev data-icon=share data-label=share role=button tabindex=0><span>Share</span></share-action><a href=/newsletter/ class="gc-analytics-event w-actions__fab w-actions__fab--subscribe" data-category=web.dev data-label=view-subscribe data-action=click><span>subscribe</span></a></div><div class="w-layout-container--narrow w-post-content"><header class=w-article-header><h1 class=w-article-header__headline id=handling-optional-payment-information-with-a-service-worker>Handling optional payment information with a service worker</h1><p class="w-article-header__subhead w-mb--non"></p><p>How to adapt your web-based payment app to Web Payments and provide a better user experience for customers.</p><p></p><div class=w-author__published><time>Aug 31, 2020</time></div><div class="w-layout-container--narrow w-post-signpost"><span class=w-post-signpost__title>Appears in:</span> <a href=/payments class=w-post-signpost__link>Web Payments</a></div><div class="w-authors w-mt--xl w-pt--sm"><div class=w-author><a href=/authors/agektmr/ ><img alt="Eiji Kitamura" class=w-author__image height=64 src="https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?auto=format&fit=crop&h=64&w=64" width=64 loading=lazy decoding=async sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75, https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x, https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x, https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x, https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"></a><div class=w-author__info style="display: flex; flex-direction: column; justify-content: center;"><cite class=w-author__name><a href=/authors/agektmr/ class=w-author__name-link>Eiji Kitamura</a></cite><ul class=w-author__link-list><li class=w-author__link-listitem><a href=https://twitter.com/agektmr class=w-author__link>Twitter</a></li><li class=w-author__link-listitem><a href=https://github.com/agektmr class=w-author__link>GitHub</a></li><li class=w-author__link-listitem><a href=https://blog.agektmr.com class=w-author__link>Blog</a></li></ul></div></div></div></header><p>Once <a href=/orchestrating-payment-transactions>a web-based payment app receives a payment request and initiates a payment transaction</a>, the service worker will act as the hub for communication between the merchant and the payment app. This post explains how a payment app can pass information about the payment method, shipping address, or contact information to the merchant using a service worker.</p><figure class=w-figure><img alt="Handling optional payment information with a service worker" class=w-screenshot height=2335 src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format" width=800 loading=lazy decoding=async sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/kDteyNFNEVnJQyTPw5p8.png?auto=format&w=1600 1600w"><figcaption class=w-figcaption>Handling optional payment information with a service worker</figcaption></figure><h2 id=payment-method-changes>Inform the merchant of a payment method change <a href=#payment-method-changes class=w-headline-link>#</a></h2><p>Payment apps can support multiple payment instruments with different payment methods.</p><div class=w-table-wrapper><table><thead><tr><th>Customer</th><th>Payment Method</th><th>Payment Instrument</th></tr></thead><tbody><tr><td rowspan=3>A</td><td>Credit Card Issuer 1</td><td><code>****1234</code></td></tr><tr><td>Credit Card Issuer 1</td><td><code>****4242</code></td></tr><tr><td>Bank X</td><td><code>******123</code></td></tr><tr><td rowspan=2>B</td><td>Credit Card Issuer 2</td><td><code>****5678</code></td></tr><tr><td>Bank X</td><td><code>******456</code></td></tr></tbody></table></div><p>For example, in the above table, Customer A's web-based wallet has two credit cards and one bank account registered. In this case, the app is handling three payment instruments (<code>****1234</code>, <code>****4242</code>, <code>******123</code>) and two payment methods (Credit Card Issuer 1 and Bank X). On a payment transaction, the payment app can let the customer pick one of the payment instruments and use it to pay for the merchant.</p><figure class=w-figure style="width:300px; margin:auto;"><img alt="Payment method picker UI" class=w-screenshot height=1600 src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format" width=800 loading=lazy decoding=async sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/yZYmEL3y1e2cPaLNz34K.png?auto=format&w=1600 1600w"><figcaption class=w-figcaption>Payment method picker UI</figcaption></figure><p>The payment app can let the merchant know which payment method the customer picked before sending the full payment response. This is useful when the merchant wants to run a discount campaign for a specific payment method brand, for example.</p><p>With the Payment Handler API, the payment app can send a "payment method change" event to the merchant via a service worker to notify the new payment method identifier. The service worker should invoke <code>PaymentRequestEvent.changePaymentMethod()</code> with the new payment method information.</p><figure class=w-figure><img alt="Inform the merchant of a payment method change" class=w-screenshot height=659 src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format" width=800 loading=lazy decoding=async sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ogXzkcdinU3RNC9cMzN0.png?auto=format&w=1600 1600w"><figcaption class=w-figcaption>Inform the merchant of a payment method change</figcaption></figure><p>Payment apps can pass a <code>methodDetails</code> object as the optional second argument for <code>PaymentRequestEvent.changePaymentMethod()</code>. This object can contain arbitrary payment method details required for the merchant to process the change event.</p><div class="w-aside w-aside--warning"><p><strong>Warning</strong>: Sharing detailed information about a customer with the merchant before the transaction is finalized is potentially a privacy risk. As a best practice, payment apps should omit unnecessary details as much as possible.</p></div><p class=w-label>[payment handler] service-worker.js</p><web-copy-code><pre class=language-js><code class=language-js>…<br><span class="token comment">// Received a message from the frontend</span><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> details<span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      …<br>      <span class="token keyword">case</span> <span class="token string">'PAYMENT_METHOD_CHANGED'</span><span class="token operator">:</span><br>        <span class="token keyword">const</span> newMethod <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>paymentMethod<span class="token punctuation">;</span><br>        <span class="token keyword">const</span> newDetails <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>methodDetails<span class="token punctuation">;</span><br>        <span class="token comment">// Redact or check that no sensitive information is passed in</span><br>        <span class="token comment">// `newDetails`.</span><br>        <span class="token comment">// Notify the merchant of the payment method change</span><br>        details <span class="token operator">=</span><br>          <span class="token keyword">await</span> payment_request_event<span class="token punctuation">.</span><span class="token function">changePaymentMethod</span><span class="token punctuation">(</span>newMethod<span class="token punctuation">,</span> newDetails<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      …</code></pre></web-copy-code><p>When the merchant receives a <code>paymentmethodchange</code> event from the Payment Request API, they can update the payment details and respond with a <a href=https://w3c.github.io/payment-request/#paymentdetailsupdate-dictionary rel=noopener><code>PaymentDetailsUpdate</code></a> object.</p><p class=w-label>[merchant]</p><web-copy-code><pre class=language-js><code class=language-js>request<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'paymentmethodchange'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>methodName <span class="token operator">===</span> <span class="token string">'another-pay'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Apply $10 discount for example.</span><br>    <span class="token keyword">const</span> discount <span class="token operator">=</span> <span class="token punctuation">{</span><br>      label<span class="token operator">:</span> <span class="token string">'special discount'</span><span class="token punctuation">,</span><br>      amount<span class="token operator">:</span> <span class="token punctuation">{</span><br>        currency<span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span><br>        <span class="token comment">// The value being string complies the spec</span><br>        value<span class="token operator">:</span> <span class="token string">'-10.00'</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    details<span class="token punctuation">.</span>displayItems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>discount<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> details<span class="token punctuation">.</span>displayItems<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>     total <span class="token operator">+=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>amount<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// Convert the number back to string</span><br>    details<span class="token punctuation">.</span>total<span class="token punctuation">.</span>amount<span class="token punctuation">.</span>value <span class="token operator">=</span> total<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// Pass a promise to `updateWith()` and send updated payment details</span><br>  e<span class="token punctuation">.</span><span class="token function">updateWith</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>When the merchant responds, the promise that <a href=https://w3c.github.io/payment-handler/#dom-paymentrequestevent-changepaymentmethod rel=noopener><code>PaymentRequestEvent.changePaymentMethod()</code></a> returned will resolve with a <a href=https://w3c.github.io/payment-handler/#the-paymentrequestdetailsupdate rel=noopener><code>PaymentRequestDetailsUpdate</code></a> object.</p><p class=w-label>[payment handler] service-worker.js</p><web-copy-code><pre class=language-js><code class=language-js>…<br>        <span class="token comment">// Notify the merchant of the payment method change</span><br>        details <span class="token operator">=</span> <span class="token keyword">await</span> payment_request_event<span class="token punctuation">.</span><span class="token function">changePaymentMethod</span><span class="token punctuation">(</span>newMethod<span class="token punctuation">,</span> newDetails<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// Provided the new payment details,</span><br>        <span class="token comment">// send a message back to the frontend to update the UI</span><br>        <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'UPDATE_REQUEST'</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">break</span><span class="token punctuation">;</span><br>…</code></pre></web-copy-code><p>Use the object to update the UI on the frontend. See <a href=#reflect-the-updated-payment-details>Reflect the updated payment details</a>.</p><h2 id=shipping-address-changes>Inform the merchant of a shipping address change <a href=#shipping-address-changes class=w-headline-link>#</a></h2><p>Payment apps can provide the customer's shipping address to the merchant as part of the result of a payment transaction.</p><p>This is useful for merchants because they can delegate the address collection to payment apps. And, because the address data will be provided in <a href=https://w3c.github.io/payment-request/#dom-addressinit rel=noopener>the standard data format</a>, the merchant can expect to receive shipping addresses in consistent structure.</p><p>This is beneficial for customers as well because once they register their address information to their favorite payment app, they can reuse it in different shops.</p><figure class=w-figure style="width:300px; margin:auto;"><img alt="Shipping address picker UI" class=w-screenshot height=1600 src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format" width=800 loading=lazy decoding=async sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/0ytdyaEC7tkPkBTv5rIu.png?auto=format&w=1600 1600w"><figcaption class=w-figcaption>Shipping address picker UI</figcaption></figure><p>Payment apps can provide a UI to edit a shipping address or to select pre-registered address information for the customer on a payment transaction. When a shipping address is determined temporarily, the payment app can let the merchant know of the redacted address information. This provides merchants with multiple benefits:</p><ul><li>A merchant can determine whether the customer meets the regional restriction to ship the item (for example, domestic only).</li><li>A merchant can change the list of shipping options based on the region of the shipping address (For example, international regular or express).</li><li>A merchant can apply the new shipping cost based on the address and update the total price.</li></ul><p>With the Payment Handler API, the payment app can send a "shipping address change" event to the merchant from the service worker to notify the new shipping address. The service worker should invoke <a href=https://w3c.github.io/payment-handler/#dom-paymentrequestevent-changeshippingaddress rel=noopener><code>PaymentRequestEvent.changeShippingAddress()</code></a> with the <a href=https://www.w3.org/TR/payment-request/#dom-addressinit rel=noopener>new address object</a>.</p><figure class=w-figure><img alt="Inform the merchant of a shipping address change" class=w-screenshot height=675 src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format" width=800 loading=lazy decoding=async sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/aVv5d9OEcEjH1Z6nUQKb.png?auto=format&w=1600 1600w"><figcaption class=w-figcaption>Inform the merchant of a shipping address change</figcaption></figure><p class=w-label>[payment handler] service-worker.js</p><web-copy-code><pre class=language-js><code class=language-js><span class="token operator">...</span><br><span class="token comment">// Received a message from the frontend</span><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> details<span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      …<br>      <span class="token keyword">case</span> <span class="token string">'SHIPPING_ADDRESS_CHANGED'</span><span class="token operator">:</span><br>        <span class="token keyword">const</span> newAddress <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shippingAddress<span class="token punctuation">;</span><br>        details <span class="token operator">=</span><br>          <span class="token keyword">await</span> payment_request_event<span class="token punctuation">.</span><span class="token function">changeShippingAddress</span><span class="token punctuation">(</span>newAddress<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      …</code></pre></web-copy-code><div class="w-aside w-aside--key-term"><p><strong>Key Term</strong>: <strong>Redacted address</strong>. Informing the full shipping address to the merchant in this case is not necessary and risks customers' privacy. The merchant only receives the parts of the address that they need to determine the shipping cost. Specifically, the browser will clear the <code>organization</code>, <code>phone</code>, <code>recipient</code>, <code>addressLine</code> fields from the payment app provided address before raising the <code>shippingaddresschange</code> event in the merchant's DOM.</p></div><p>The merchant will receive a <code>shippingaddresschange</code> event from the Payment Request API so they can respond with the updated <a href=https://w3c.github.io/payment-request/#paymentdetailsupdate-dictionary rel=noopener><code>PaymentDetailsUpdate</code></a>.</p><p class=w-label>[merchant]</p><web-copy-code><pre class=language-js><code class=language-js>request<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'shippingaddresschange'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Read the updated shipping address and update the request.</span><br>  <span class="token keyword">const</span> addr <span class="token operator">=</span> request<span class="token punctuation">.</span>shippingAddress<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> details <span class="token operator">=</span> <span class="token function">getPaymentDetailsFromShippingAddress</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// `updateWith()` sends back updated payment details</span><br>  e<span class="token punctuation">.</span><span class="token function">updateWith</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>When the merchant responds, the promise <a href=https://w3c.github.io/payment-handler/#dom-paymentrequestevent-changeshippingaddress rel=noopener><code>PaymentRequestEvent.changeShippingAddress()</code></a> returned will resolve with a <a href=https://w3c.github.io/payment-handler/#the-paymentrequestdetailsupdate rel=noopener><code>PaymentRequestDetailsUpdate</code></a> object.</p><p class=w-label>[payment handler] service-worker.js</p><web-copy-code><pre class=language-js><code class=language-js>…<br>        <span class="token comment">// Notify the merchant of the shipping address change</span><br>        details <span class="token operator">=</span> <span class="token keyword">await</span> payment_request_event<span class="token punctuation">.</span><span class="token function">changeShippingAddress</span><span class="token punctuation">(</span>newAddress<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// Provided the new payment details,</span><br>        <span class="token comment">// send a message back to the frontend to update the UI</span><br>        <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'UPDATE_REQUEST'</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">break</span><span class="token punctuation">;</span><br>…</code></pre></web-copy-code><p>Use the object to update the UI on the frontend. See <a href=#reflect-the-updated-payment-details>Reflect the updated payment details</a>.</p><h2 id=inform-the-merchant-of-a-shipping-option-change>Inform the merchant of a shipping option change <a href=#inform-the-merchant-of-a-shipping-option-change class=w-headline-link>#</a></h2><p>Shipping options are delivery methods merchants use to ship purchased items to a customer. Typical shipping options include:</p><ul><li>Free shipping</li><li>Express shipping</li><li>International shipping</li><li>Premium international shipping</li></ul><p>Each comes with its own cost. Usually faster methods/options are more expensive.</p><p>Merchants using the Payment Request API can delegate this selection to a payment app. The payment app can use the information to construct a UI and let the customer pick a shipping option.</p><figure class=w-figure style="width:300px; margin:auto;"><img alt="Shipping option picker UI" class=w-screenshot height=1600 src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format" width=800 loading=lazy decoding=async sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/VkHwTharTqX7oFK62RkA.png?auto=format&w=1600 1600w"><figcaption class=w-figcaption>Shipping option picker UI</figcaption></figure><p>The list of shipping options specified in the merchant's Payment Request API is propagated to the payment app's service worker as a property of <code>PaymentRequestEvent</code>.</p><p class=w-label>[merchant]</p><web-copy-code><pre class=language-js><code class=language-js><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><br>  supportedMethods<span class="token operator">:</span> <span class="token string">'https://bobpay.xyz/pay'</span><span class="token punctuation">,</span><br>  data<span class="token operator">:</span> <span class="token punctuation">{</span> transactionId<span class="token operator">:</span> <span class="token string">'****'</span> <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  displayItems<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>    label<span class="token operator">:</span> <span class="token string">'Anvil L/S Crew Neck - Grey M x1'</span><span class="token punctuation">,</span><br>    amount<span class="token operator">:</span> <span class="token punctuation">{</span> currency<span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'22.15'</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  shippingOptions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>    id<span class="token operator">:</span> <span class="token string">'standard'</span><span class="token punctuation">,</span><br>    label<span class="token operator">:</span> <span class="token string">'Standard'</span><span class="token punctuation">,</span><br>    amount<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'0.00'</span><span class="token punctuation">,</span> currency<span class="token operator">:</span> <span class="token string">'USD'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    selected<span class="token operator">:</span> <span class="token boolean">true</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    id<span class="token operator">:</span> <span class="token string">'express'</span><span class="token punctuation">,</span><br>    label<span class="token operator">:</span> <span class="token string">'Express'</span><span class="token punctuation">,</span><br>    amount<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'5.00'</span><span class="token punctuation">,</span> currency<span class="token operator">:</span> <span class="token string">'USD'</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  total<span class="token operator">:</span> <span class="token punctuation">{</span><br>    label<span class="token operator">:</span> <span class="token string">'Total due'</span><span class="token punctuation">,</span><br>    amount<span class="token operator">:</span> <span class="token punctuation">{</span> currency<span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span> value <span class="token operator">:</span> <span class="token string">'22.15'</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  requestShipping<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>The payment app can let the merchant know which shipping option the customer picked. This is important for both the merchant and the customer because changing the shipping option changes the total price as well. The merchant needs to be informed of the latest price for the payment verification later and the customer also needs to be aware of the change.</p><p>With the Payment Handler API, the payment app can send a "shipping option change" event to the merchant from the service worker. The service worker should invoke <a href=https://w3c.github.io/payment-handler/#dom-paymentrequestevent-changeshippingoption rel=noopener><code>PaymentRequestEvent.changeShippingOption()</code></a> with the new shipping option ID.</p><figure class=w-figure><img alt="Inform the merchant of a shipping option change" class=w-screenshot height=667 src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format" width=800 loading=lazy decoding=async sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/mERzHqvPGrjKWu29m5q1.png?auto=format&w=1600 1600w"><figcaption class=w-figcaption>Inform the merchant of a shipping option change</figcaption></figure><p class=w-label>[payment handler] service-worker.js</p><web-copy-code><pre class=language-js><code class=language-js>…<br><span class="token comment">// Received a message from the frontend</span><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> details<span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      …<br>      <span class="token keyword">case</span> <span class="token string">'SHIPPING_OPTION_CHANGED'</span><span class="token operator">:</span><br>        <span class="token keyword">const</span> newOption <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shippingOptionId<span class="token punctuation">;</span><br>        details <span class="token operator">=</span><br>          <span class="token keyword">await</span> payment_request_event<span class="token punctuation">.</span><span class="token function">changeShippingOption</span><span class="token punctuation">(</span>newOption<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      …</code></pre></web-copy-code><p>The merchant will receive a <code>shippingoptionchange</code> event from the Payment Request API. The merchant should use the information to update the total price and then respond with the updated <a href=https://w3c.github.io/payment-request/#paymentdetailsupdate-dictionary rel=noopener><code>PaymentDetailsUpdate</code></a>.</p><p class=w-label>[merchant]</p><web-copy-code><pre class=language-js><code class=language-js>request<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'shippingoptionchange'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// selected shipping option</span><br>  <span class="token keyword">const</span> shippingOption <span class="token operator">=</span> request<span class="token punctuation">.</span>shippingOption<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> newTotal <span class="token operator">=</span> <span class="token punctuation">{</span><br>    currency<span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span><br>    label<span class="token operator">:</span> <span class="token string">'Total due'</span><span class="token punctuation">,</span><br>    value<span class="token operator">:</span> <span class="token function">calculateNewTotal</span><span class="token punctuation">(</span>shippingOption<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token comment">// `updateWith()` sends back updated payment details</span><br>  e<span class="token punctuation">.</span><span class="token function">updateWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> total<span class="token operator">:</span> newTotal <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></web-copy-code><p>When the merchant responds, the promise that <a href=https://w3c.github.io/payment-handler/#dom-paymentrequestevent-changeshippingoption rel=noopener><code>PaymentRequestEvent.changeShippingOption()</code></a> returned will resolve with a <a href=https://w3c.github.io/payment-handler/#the-paymentrequestdetailsupdate rel=noopener><code>PaymentRequestDetailsUpdate</code></a> object.</p><p class=w-label>[payment handler] service-worker.js</p><web-copy-code><pre class=language-js><code class=language-js>…<br>        <span class="token comment">// Notify the merchant of the shipping option change</span><br>        details <span class="token operator">=</span> <span class="token keyword">await</span> payment_request_event<span class="token punctuation">.</span><span class="token function">changeShippingOption</span><span class="token punctuation">(</span>newOption<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// Provided the new payment details,</span><br>        <span class="token comment">// send a message back to the frontend to update the UI</span><br>        <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'UPDATE_REQUEST'</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">break</span><span class="token punctuation">;</span><br>…</code></pre></web-copy-code><p>Use the object to update the UI on the frontend. See <a href=#reflect-the-updated-payment-details>Reflect the updated payment details</a>.</p><h2 id=reflect-the-updated-payment-details>Reflect the updated payment details <a href=#reflect-the-updated-payment-details class=w-headline-link>#</a></h2><p>Once the merchant finishes updating the payment details, the promises returned from <code>.changePaymentMethod()</code>, <code>.changeShippingAddress()</code> and <code>.changeShippingOption()</code> will resolve with a common <a href=https://w3c.github.io/payment-handler/#the-paymentrequestdetailsupdate rel=noopener><code>PaymentRequestDetailsUpdate</code></a> object. The payment handler can use the result to reflect updated total price and shipping options to the UI.</p><div class="w-aside w-aside--note"><p>The <code>PaymentRequestDetailsUpdate</code> object is passed from the merchant and it contains the exact information the merchant put in the <code>PaymentDetailsUpdate</code> object via the Payment Request API. The best way to ensure that merchants give you the information you expect is to provide good developer documentation, or provide a JavaScript library to control the information, or both.</p></div><p>Merchants may return errors for a few reasons:</p><ul><li>The payment method is not acceptable.</li><li>The shipping address is outside of their supported regions.</li><li>The shipping address contains invalid information.</li><li>The shipping option is not selectable for the provided shipping address or some other reason.</li></ul><p>Use the following properties to reflect the error status:</p><ul><li><strong><code>error</code></strong>: Human readable error string. This is the best string to display to customers.</li><li><strong><code>shippingAddressErrors</code></strong>: <a href=https://www.w3.org/TR/payment-request/#dom-addresserrors rel=noopener><code>AddressErrors</code></a> object that contains in-detail error string per address property. This is useful if you want to open a form that lets the customer edit their address and you need to point them directly to the invalid fields.</li><li><strong><code>paymentMethodErrors</code></strong>: Payment-method-specific error object. You can ask merchants to provide a structured error like <a href=https://www.w3.org/TR/payment-method-basic-card/#dom-basiccarderrors rel=noopener><code>BasicCardErrors</code></a> for basic-card, but the Web Payments spec authors recommend keeping it a simple string.</li></ul><h2 id=sample-code>Sample code <a href=#sample-code class=w-headline-link>#</a></h2><p>Most of sample codes you saw in this document were excerpts from the following working sample app:</p><p><a href=https://paymenthandler-demo.glitch.me rel=noopener>https://paymenthandler-demo.glitch.me</a></p><p class=w-label>[payment handler] service worker</p><div class=glitch-embed-wrap style="height: 420px; width: 100%;"><iframe allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi" loading=lazy src="https://glitch.com/embed/#!/embed/paymenthandler-demo?attributionHidden=true&sidebarCollapsed=true&path=public%2Fservice-worker.js&previewSize=0" style="height: 100%; width: 100%; border: 0;" title="paymenthandler-demo on Glitch"></iframe></div><p class=w-label>[payment handler] frontend</p><div class=glitch-embed-wrap style="height: 420px; width: 100%;"><iframe allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi" loading=lazy src="https://glitch.com/embed/#!/embed/paymenthandler-demo?attributionHidden=true&sidebarCollapsed=true&path=public%2Fpay.js&previewSize=0" style="height: 100%; width: 100%; border: 0;" title="paymenthandler-demo on Glitch"></iframe></div><p>To try it out:</p><ol><li>Go to <a href=https://paymentrequest-demo.glitch.me/ rel=noopener>https://paymentrequest-demo.glitch.me/</a>.</li><li>Go to the bottom of the page.</li><li>Press <strong>Add a payment button</strong>.</li><li>Enter <code>https://paymenthandler-demo.glitch.me</code> to the <strong>Payment Method Identifier</strong> field.</li><li>Press <strong>Pay</strong> button next to the field.</li></ol><h2 id=next-steps>Next steps <a href=#next-steps class=w-headline-link>#</a></h2><p>In this article, we learned how to handle optional information on the service worker. The final step for building a web-based payment app is to learn how to build the frontend.</p><ul><li>Handling payments on the payment frontend (coming soon)</li></ul><div class=w-chips><a href=/tags/payments/ class=w-chip>Payments</a> <a href=/tags/service-worker/ class=w-chip>Service Worker</a></div><div class="w-mb--l w-mt--l w-post-github-link"><span class=w-mr--sm>Last updated: <time>Aug 31, 2020</time> </span><a href=https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/payments/handling-optional-payment-information/index.md>Improve article</a></div><web-feedback additional-questions=api></web-feedback></div><nav class=w-article-navigation><a href=/payments class="gc-analytics-event w-article-navigation__link w-article-navigation__link--back w-article-navigation__link--single" data-category=web.dev data-label="navigation, go back" data-action=click>Return to all articles</a></nav></div></div></main><footer class=w-footer><nav class=w-footer__linkboxes><ul class=w-footer__linkboxes-list><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Contribute</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title=" class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">File a bug</a></li><li class=w-footer__linkbox-item><a href=https://github.com/googlechrome/web.dev class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">View source</a></li></ul></li><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Related content</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href=https://blog.chromium.org/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">Chrome updates</a></li><li class=w-footer__linkbox-item><a href=https://developers.google.com/web/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">Web Fundamentals</a></li><li class=w-footer__linkbox-item><a href=https://developers.google.com/web/showcase/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">Case studies</a></li><li class=w-footer__linkbox-item><a href=https://devwebfeed.appspot.com/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">DevWeb Content Firehose</a></li><li class=w-footer__linkbox-item><a href=/podcasts/ class=w-footer__linkbox-link data-category=Podcasts data-label="Footer Link (index 5)">Podcasts</a></li><li class=w-footer__linkbox-item><a href=/shows/ class=w-footer__linkbox-link data-category=Shows data-label="Footer Link (index 6)">Shows</a></li></ul></li><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Connect</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href=https://www.twitter.com/ChromiumDev class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">Twitter</a></li><li class=w-footer__linkbox-item><a href=https://www.youtube.com/user/ChromeDevelopers class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">YouTube</a></li></ul></li></ul></nav><div class=w-footer__utility><nav class=w-footer__utility-nav><a href=https://developers.google.com/ class=w-footer__utility-logo-link data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link"><img alt="Google Developers" class=w-footer__utility-logo height=33 src=/images/lockup-color.png width=185 loading=lazy></a><ul class=w-footer__utility-list><li class=w-footer__utility-item><a href=https://developer.chrome.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">Chrome</a></li><li class=w-footer__utility-item><a href=https://firebase.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Firebase Link">Firebase</a></li><li class=w-footer__utility-item><a href=https://cloud.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Google Cloud Platform Link">Google Cloud Platform</a></li><li class=w-footer__utility-item><a href=https://developers.google.com/products class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer All products Link">All products</a></li></ul><web-language-select current=en></web-language-select></nav><nav class=w-footer__utility-nav><ul class=w-footer__utility-list><li class=w-footer__utility-item><a href=https://policies.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Terms and Privacy link">Terms & Privacy</a></li><li class=w-footer__utility-item><a href=/community-guidelines/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Community Guidelines link">Community Guidelines</a></li></ul><div class=w-footer__license><p>Except as otherwise noted, the content of this page is licensed under the <a href=https://creativecommons.org/licenses/by/4.0/ >Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href=https://www.apache.org/licenses/LICENSE-2.0>Apache 2.0 License</a>. For details, see the <a href=https://developers.google.com/terms/site-policies>Google Developers Site Policies</a>.</p></div></nav></div></footer></body></html>