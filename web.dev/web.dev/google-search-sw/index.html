<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><style>@charset "UTF-8";@keyframes unsupported-appear{0%,to{visibility:hidden}}@keyframes hold-visibility{0%,to{visibility:visible}}@keyframes loading-progress-before{0%{transform:translate(-50%)}to{transform:translate(100vw) translate(-50%)}}@keyframes equalizer-morph{0%{transform:scaleY(1)}25%{transform:scaleY(.3)}50%{transform:scaleY(.7)}75%{transform:scaleY(.15)}}.overflow-hidden{overflow:hidden}*,::after,::before{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}:focus{outline:1px solid #3740ff}.w-force-focus{outline:0!important}div,form,li,ol,ul{margin:0;padding:0}input,q{hyphens:none}code,input,q{-moz-hyphens:none;-webkit-hyphens:none}:not([href])[id]::before{content:" ";display:block;height:calc(64px + 1.5rem);margin-top:calc(-64px - 1.5rem);pointer-events:none;visibility:hidden}:root{--flow-space:1em}body,html{font:400 12px/1.5 Segoe UI,system-ui,-apple-system,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;margin:0;overflow-wrap:break-word;padding:0;word-wrap:break-word}@media (min-width:241px){body,html{font:400 14px/1.5 Segoe UI,system-ui,-apple-system,sans-serif}}@media (min-width:321px){body,html{font:400 16px/1.5 Segoe UI,system-ui,-apple-system,sans-serif}}h1,h2,h3{color:#202124;margin:0;overflow:visible}h1{font:500 38px/1.3157894737 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:9px}@media (min-width:241px){h1{font:500 49px/1.3265306122 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:10px}}@media (min-width:321px){h1{font:500 56px/1.3214285714 "Google Sans",sans-serif;letter-spacing:-.5px;margin-top:0;margin-bottom:11px}}h2{font:400 18px/1.3333333333 "Google Sans",sans-serif;margin-top:48px;margin-bottom:24px}@media (min-width:241px){h2{font:400 21px/1.3333333333 "Google Sans",sans-serif;margin-top:56px;margin-bottom:28px}}@media (min-width:321px){h2{font:400 24px/1.3333333333 "Google Sans",sans-serif;margin-top:64px;margin-bottom:32px}}h3{font:500 13.5px/1.4814814815 "Google Sans",sans-serif;margin-top:36px;margin-bottom:12px}@media (min-width:241px){h3{font:500 16px/1.375 "Google Sans",sans-serif;margin-top:42px;margin-bottom:14px}}@media (min-width:321px){h3{font:500 20px/1.2 "Google Sans",sans-serif;margin-top:48px;margin-bottom:16px}}p{font:400 13.5px/1.5555555556 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:27px;margin-bottom:27px}@media (min-width:241px){p{font:400 15px/1.8666666667 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:31.5px;margin-bottom:31.5px}}@media (min-width:321px){p{font:400 18px/1.7777777778 Segoe UI,system-ui,-apple-system,sans-serif;margin-top:36px;margin-bottom:36px}}h1+*,h1+[class],h2+*,h2+[class],h3+*,h3+[class]{margin-top:0}cite,em{font-style:italic}strong{font-weight:500}main{padding-bottom:64px}@media print{main{padding-bottom:0}}img{-ms-interpolation-mode:bicubic;display:inline-block;height:auto;max-width:100%;vertical-align:middle}input[type=email],input[type=text]{border:1px solid #dadce0;font:inherit;font-size:inherit;padding:14px 8px;width:100%}input[type=email]:focus,input[type=text]:focus{border-color:#3740ff;outline:0}input[type=radio]{-moz-appearance:none;-webkit-appearance:none;appearance:none;border:2px solid #dadce0;border-radius:50%;cursor:pointer;flex-shrink:0;height:24px;margin:2px;width:24px}input[type=radio]:checked{background-clip:content-box;background-color:#3740ff;border:2px solid #3740ff;padding:4px}a{color:#3740ff;text-decoration:none}a:active,a:focus,a:hover{text-decoration:underline}a:active,a:focus{outline:1px solid #3740ff}.w-post-content :link,.w-post-content :visited,.w-post-content a{text-decoration:underline}.w-post-content :link:active,.w-post-content :link:focus,.w-post-content :link:hover,.w-post-content :visited:active,.w-post-content :visited:focus,.w-post-content :visited:hover,.w-post-content a:active,.w-post-content a:focus,.w-post-content a:hover{text-decoration:none}p :link:active,p :visited:active,p a:active{background-color:rgba(55,64,255,.16)}a code{color:#3740ff}ol:not([class]),ul:not([class]){list-style:none;margin:32px 0;position:relative}ol:not([class]){counter-reset:ol-step-counter;padding-left:32px}ol:not([class])>li{counter-increment:ol-step-counter}ol:not([class])>li::before,ul:not([class])>li::before{background:#5f6368;border-radius:50%;color:#fff;left:0;position:absolute}ol:not([class])>li::before{-ms-flex-align:center;-ms-flex-negative:0;-ms-flex-pack:center;-webkit-box-align:center;-webkit-box-pack:center;align-items:center;content:counter(ol-step-counter);display:-ms-inline-flexbox;display:-webkit-inline-box;display:inline-flex;flex-shrink:0;font-size:.75em;height:20px;justify-content:center;margin:6px 0 0;width:20px}ul:not([class]){padding-left:24px}ol:not([class])>li,ul:not([class])>li{font-size:1.125rem;line-height:1.778rem;margin-bottom:8px}ul:not([class])>li::before{content:"";height:8px;margin:12px 0 0;width:8px}li>ol:not([class]),li>ul:not([class]),ol:not([class])>li>p,ul:not([class])>li>p{margin:8px 0}ol:not([class])>li>p:first-child,table ol:not([class]):first-child,table ul:not([class]):first-child,ul:not([class])>li>p:first-child{margin-top:0}ol:not([class])>li>p:last-child,table ol:not([class]):last-child,table ul:not([class]):last-child,ul:not([class])>li>p:last-child{margin-bottom:0}select{-moz-appearance:none;-webkit-appearance:none;appearance:none;background-color:#fff;background-image:url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10L12 15L17 10H7Z' fill='%235F6368'/%3E%3C/svg%3E%0A");background-position:right .5em top 50%;background-repeat:no-repeat;background-size:1.5em;border-radius:1px;border:1px solid #dadce0;box-sizing:border-box;color:inherit;display:block;font-family:inherit;font-size:1em;line-height:1.5;margin:0;max-width:100%;padding:.6em 3em .5em .8em}select::-ms-expand{display:none}select:-moz-focusring{color:transparent;text-shadow:0 0 0 #000}select:hover{border-color:#9aa0a6}select option,table code{font-weight:400}.w-select--borderless{border-color:transparent}.w-select--borderless:hover{border-color:transparent;background-color:#f1f3f4}table{border-collapse:collapse;font-size:inherit;margin:0;min-width:512px;width:100%}table code{background:0 0;border:0;font-size:.9em;line-height:1.7em;margin:0;padding:0}table ol:not([class]),table ul:not([class]){margin:24px 0;padding-left:40px}table ol:not([class]) li,table ul:not([class]) li{font-size:inherit;line-height:inherit}table ul:not([class]) li::before{margin:8px 0 0}table ol:not([class]) li::before{margin:2px 0 0}code{margin:0 .25em;padding:.125em .25em;background:#f7f7f7;border:1px solid #dadce0;color:#202124;font:1rem/1.5em SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;hyphens:none;tab-size:2;text-align:left;word-spacing:normal}:not(pre)>code{white-space:pre-wrap}h1 code,h2 code,h3 code{background:0 0;border:0;color:inherit;font-size:inherit;margin:0;padding:0;white-space:normal}cite code{font-size:.9em}video{max-width:100%}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/cyrillic.woff2) format("woff2");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/greek.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/vietnamese.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/latin-ext.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:400;font-display:optional;src:local("Google Sans Regular"),local("GoogleSans-Regular"),url(/fonts/google-sans/regular/latin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/cyrillic.woff2) format("woff2");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/greek.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/vietnamese.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/latin-ext.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:"Google Sans";font-style:normal;font-weight:500;font-display:optional;src:local("Google Sans Medium"),local("GoogleSans-Medium"),url(/fonts/google-sans/bold/latin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:url(/fonts/material-icons/regular.woff2) format("woff2")}.flow>*+*{margin-top:var(--flow-space)}.scrollbar,.w-toc__content{scrollbar-color:#9aa0a6 transparent;scrollbar-width:thin}.scrollbar::-webkit-scrollbar,.w-toc__content::-webkit-scrollbar{height:6px;width:6px}.scrollbar::-webkit-scrollbar-thumb,.w-toc__content::-webkit-scrollbar-thumb{background:#9aa0a6;background-clip:padding-box;border:1.5px solid transparent;border-radius:3px}.scrollbar::-webkit-scrollbar-thumb:hover,.w-toc__content::-webkit-scrollbar-thumb:hover{background-color:#798189}.scrollbar::-webkit-scrollbar-thumb:active,.w-toc__content::-webkit-scrollbar-thumb:active{background-color:#61686e}.scrollbar::-webkit-scrollbar-track,.w-toc__content::-webkit-scrollbar-track{background:0 0}.w-visually-hidden{clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(1px);display:block;height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}:root{--list-separator:"·";--list-separator-gap:0.5rem}.w-actions{align-items:flex-end;bottom:24px;display:flex;flex-direction:column;position:fixed;right:24px;z-index:100}@media print{.w-actions{display:none}}.w-actions>*{margin-top:20px}.w-actions__fab{align-items:center;background-color:#3740ff;border:0;border-radius:50%;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);color:#fff;cursor:pointer;display:inline-flex;font-family:Segoe UI,system-ui,-apple-system,sans-serif;font-size:.875em;font-weight:600;height:56px;letter-spacing:1px;overflow:hidden;padding:0;position:relative;text-indent:-9999px;text-overflow:initial;text-transform:uppercase;width:56px}@media (min-width:1264px){.w-actions__fab{border-radius:28px;padding:0 24px 0 52px;text-indent:0;width:auto}}.w-actions__fab:active,.w-actions__fab:hover{background-color:#3740ff}.w-actions__fab:active{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.w-actions__fab:active,.w-actions__fab:focus,.w-actions__fab:hover{outline:0;text-decoration:none}.w-actions__fab::before{background-size:24px 24px;content:"";height:24px;left:16px;position:absolute;top:16px;width:24px}.w-actions__fab::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}.w-actions__fab:hover::after{background-color:rgba(255,255,255,.08)}.w-actions__fab:focus::after{background-color:rgba(255,255,255,.24)}.w-actions__fab:active::after{background-color:rgba(255,255,255,.32)}.w-actions__fab--share::before{background-image:url(/images/icons/share_white.svg)}.w-actions__fab--subscribe{background-color:#fff;color:#3740ff}.w-actions__fab--subscribe:active,.w-actions__fab--subscribe:hover{background-color:#fff}.w-actions__fab--subscribe::before{background-image:url(/images/icons/subscribe.svg)}.w-actions__fab--subscribe:hover::after{background-color:rgba(55,64,255,.04)}.w-actions__fab--subscribe:focus::after{background-color:rgba(55,64,255,.12)}.w-actions__fab--subscribe:active::after{background-color:rgba(55,64,255,.16)}:root{--app-bar-height:64px}.w-article-header{margin:0 0 48px;padding-top:40px}@media (min-width:865px){.w-article-header{margin:0 0 64px;padding-top:56px}}@media print{.w-article-header{margin:0;padding-top:0}}.w-article-header__headline{font-size:27px;font-weight:400;line-height:33px;margin:0 auto 11px}@media (min-width:241px){.w-article-header__headline{font-size:31px;line-height:38px}}@media (min-width:321px){.w-article-header__headline{font-size:36px;line-height:44px}}@media (min-width:865px){.w-article-header__headline{font-size:44px;line-height:52px}}.w-article-header__subhead{font-family:"Google Sans",sans-serif;font-size:16px;line-height:28px;margin:12px auto}@media (min-width:241px){.w-article-header__subhead{font-size:18px;line-height:32px;margin:16px auto}}.w-article-navigation{background-color:#dadce0;display:flex;flex-direction:column;padding:1px 0}@media (min-width:481px){.w-article-navigation{flex-direction:row}}@media print{.w-article-navigation{display:none}}.w-article-navigation__link{align-items:center;background-color:#fff;color:#202124;display:flex;font-family:"Google Sans",sans-serif;position:relative}.w-article-navigation__link:active,.w-article-navigation__link:focus,.w-article-navigation__link:hover{background-color:#fff;outline:0;text-decoration:none}.w-article-navigation__link::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal}.w-article-navigation__link::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}.w-article-navigation__link:hover::after{background-color:rgba(32,33,36,.04)}.w-article-navigation__link:focus::after{background-color:rgba(32,33,36,.12)}.w-article-navigation__link:active::after{background-color:rgba(32,33,36,.16)}.w-article-navigation__link--back{flex-basis:33.3%;margin:0 0 1px;padding:32px 32px 32px 80px}@media (min-width:481px){.w-article-navigation__link--back{margin:0 1px 0 0}}.w-article-navigation__link--back::before,.w-aside::after{content:"arrow_back";left:32px;position:absolute}.w-article-navigation__link--single{flex:1;margin:0}@media (min-width:481px){.w-article-navigation__link--single{margin:0}}.w-article-navigation code{background:0 0;border:0;color:inherit;padding:0}.w-aside{font-family:Segoe UI,system-ui,-apple-system,sans-serif;font-size:13.5px;line-height:21px;margin:48px 0 32px;padding:24px 0 0 48px;position:relative}@media (min-width:241px){.w-aside{font-size:15px;line-height:28px}}@media (min-width:321px){.w-aside{font-size:18px;line-height:32px}}.w-aside strong{font-weight:700}.w-aside::after{content:"";height:2px;left:0;right:0;top:0}.w-aside::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;float:left;margin:4px 0 0 -48px}.w-aside--note{color:#3740ff}.w-aside--note::after{background-color:#3740ff}.w-aside--note::before{content:"star"}.w-aside--caution{color:#c0580c}.w-aside--caution::after{background-color:#c0580c}.w-aside--caution::before{content:"error"}.w-aside--warning{color:#eb0f00}.w-aside--warning::after{background-color:#eb0f00}.w-aside--warning::before{content:"warning"}.w-aside--success{color:#018642}.w-aside--success::after{background-color:#018642}.w-aside--success::before{content:"done"}.w-aside a,.w-aside code,.w-aside p{color:inherit}.w-aside code{white-space:pre-wrap}.w-aside a{text-decoration:underline}.w-aside p{font-family:inherit;letter-spacing:normal;margin:0}.w-aside p+p{margin-top:8px}.w-aside p,.w-aside ul li{font-size:inherit;line-height:inherit}.w-authors{display:flex;flex-wrap:wrap;gap:32px}.w-author{display:flex;padding:8px}.w-author__image{background-color:#dadce0;border-radius:50%;border:2px solid #fff;flex-shrink:0;height:64px;margin:0 12px 0 0;min-width:64px;object-fit:cover;overflow:hidden;width:64px}.w-author__name,.w-author__published{display:block;font-size:14px;font-style:normal}.w-author__name{color:#202124}.w-author__name-link{display:inline-block;color:inherit}.w-author__name-link:focus,.w-author__name-link:hover{text-decoration:none}.w-post-content .w-author__name-link{text-decoration:none}.w-post-content .w-author__name-link:focus,.w-post-content .w-author__name-link:hover{text-decoration:underline}.w-author__published{color:#5f6368}.w-author__link,web-event-schedule{display:block}.w-author__link-list{display:flex;flex-wrap:wrap;list-style:none;overflow:hidden;margin-top:9px}.w-author__link-listitem{font-size:14px;display:flex}.w-author__link-listitem+.w-author__link-listitem::before{content:"·";display:block;margin:0 4px}.w-author__link:focus{box-shadow:inset 0 0 0 1px #3740ff;outline:0}.w-breadcrumbs,.w-breadcrumbs__crumb{align-items:center;display:flex;min-width:0}.w-breadcrumbs{margin:0;padding:0}.w-breadcrumbs__crumb{font-size:.875rem}.w-breadcrumbs__icon{width:1.1rem;height:1.1rem;fill:#5f6368}.w-breadcrumbs__crumb:not(:last-of-type){flex-shrink:0}.w-breadcrumbs__crumb:last-of-type>a{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.w-breadcrumbs__link{color:#5f6368;padding:0 8px}.w-breadcrumbs__link--left-justify{margin-left:-8px}.w-button{-webkit-tap-highlight-color:transparent;align-items:center;background:0 0;border:0;border-radius:3px;color:#3740ff;cursor:pointer;display:inline-flex;font:500 .875rem/2.25rem Segoe UI,system-ui,-apple-system,sans-serif;height:56px;justify-content:center;letter-spacing:1px;outline:0;padding:0 16px;text-decoration:none;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;overflow:hidden;position:relative;transition:background-color .2s,box-shadow .2s;vertical-align:middle;white-space:nowrap}.w-button::-moz-focus-inner{border:0}@media (hover:hover){.w-button:focus,.w-button:hover{background:#fff;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);outline:0;text-decoration:none}}.w-button:active{background:#fff;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);outline:0;text-decoration:none}.w-button:focus{outline:1px solid rgba(55,64,255,.8);outline-offset:-3px}.w-button[disabled]{background:#dadce0;box-shadow:none;color:rgba(0,0,0,.26);cursor:default;pointer-events:none}.w-button::after{bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .2s,border .2s;z-index:1}@media (hover:hover){.w-button:hover::after{background-color:rgba(55,64,255,.04)}.w-button:focus::after{background-color:rgba(55,64,255,.12)}}.w-button:active::after{background-color:rgba(55,64,255,.16)}.w-button--primary,.w-button--primary:active,.w-button--primary:focus,.w-button--primary:hover{background-color:#3740ff;color:#fff}@media (hover:hover){.w-button--primary:hover::after{background-color:rgba(255,255,255,.08)}.w-button--primary:focus::after{background-color:rgba(255,255,255,.24)}}.w-button--primary:active::after{background-color:rgba(255,255,255,.32)}.w-button--primary:focus{outline:1px solid rgba(255,255,255,.8)}.w-button--secondary,.w-button--secondary:active,.w-button--secondary:focus,.w-button--secondary:hover{background-color:#fff;border:1px solid #dadce0;color:#202124}@media (hover:hover){.w-button--secondary:hover::after{background-color:rgba(0,0,0,.04)}.w-button--secondary:focus::after{background-color:rgba(0,0,0,.08)}}.w-button--secondary:active::after{background-color:rgba(0,0,0,.1)}.w-button--secondary:focus{outline:1px solid rgba(32,33,36,.6)}.w-button--icon,.w-button--svg{-webkit-tap-highlight-color:transparent;align-items:center;background:0 0;border:0;border-radius:3px;cursor:pointer;display:inline-flex;font:500 .875rem/2.25rem Segoe UI,system-ui,-apple-system,sans-serif;height:56px;justify-content:center;letter-spacing:1px;outline:0;position:relative;text-decoration:none;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeSpeed;color:#5f6368;height:3rem;overflow:unset;padding:0;transition:background .2s ease,color .2s ease;width:3rem}@media (hover:hover){.w-button--icon:focus,.w-button--icon:hover,.w-button--svg:focus,.w-button--svg:hover{background:#f1f3f4;color:#202124}}.w-button--icon:active,.w-button--svg:active{background:#e8eaed}.w-button--icon:focus,.w-button--svg:focus{box-shadow:0 0 0 1px #3740ff;outline:0}.w-button--round{border-radius:50%}.w-button--icon::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;content:attr(data-icon);display:inline-block;height:24px;speak:none;width:24px;margin:0}.button{appearance:none;border:0;background:0 0;padding:0}.w-chips{display:flex;flex-flow:row wrap}.w-chip,.w-post-content .w-chip{background-color:transparent;border:1px solid rgba(32,33,36,.16);border-radius:20px;box-sizing:border-box;color:#202124;display:block;font-size:14px;height:32px;line-height:30px;margin:0 8px 12px 0;overflow:hidden;padding:0 12px;text-decoration:none;transition:background-color .2s,border .2s}.w-chip:active,.w-chip:focus,.w-chip:hover,.w-post-content .w-chip:active,.w-post-content .w-chip:focus,.w-post-content .w-chip:hover{outline:0;text-decoration:none}.w-chip:hover,.w-post-content .w-chip:hover{background-color:rgba(32,33,36,.04);border:1px solid rgba(32,33,36,.2)}.w-chip:focus,.w-post-content .w-chip:focus{background-color:rgba(32,33,36,.12);border:1px solid rgba(32,33,36,.28)}.w-chip:active,.w-post-content .w-chip:active{background-color:rgba(0,0,0,.16);border:1px solid rgba(32,33,36,.43);box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.w-callout__header{padding-bottom:1rem}.w-callout__lockup{font:500 13.5px/1.4814814815 "Google Sans",sans-serif;margin-top:36px;margin-bottom:12px;display:inline-flex;margin:0 0 .75rem!important}@media (min-width:241px){.w-callout__lockup{font:500 16px/1.375 "Google Sans",sans-serif;margin-top:42px;margin-bottom:14px}}@media (min-width:321px){.w-callout__lockup{font:500 20px/1.2 "Google Sans",sans-serif;margin-top:48px;margin-bottom:16px}}.w-callout__lockup::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;display:inline-block;font-size:20px;margin:0 8px 0 0}.w-callout__blurb{margin:0}.w-details{border:1px solid #dadce0;border-width:1px 0;margin:36px 0;padding:18px 0;position:relative}.w-details+.w-details{border-top:0;margin-top:-36px}.w-details__summary{-webkit-tap-highlight-color:transparent;cursor:pointer;font:inherit;list-style:none}.w-details__summary::marker{display:none}.w-details__summary:focus{outline:0}@media (hover:hover){.w-details__summary:focus .w-details__header::after,.w-details__summary:hover .w-details__header::after{background:#e7e8ff}}.w-details__summary:focus .w-details__header::after{box-shadow:0 0 0 1px #3740ff}.w-details__summary:active .w-details__header::after{background:#c3c6ff}.w-details__header{color:#3740ff;margin:0;padding:.75rem 40px .75rem 0;position:relative}.w-details__header::after{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;border-radius:50%;content:"expand_more";cursor:pointer;font-size:24px;padding:2px;position:absolute;right:1px;speak:none;top:50%;transform:translateY(-50%);transition:background .2s;visibility:visible}@media (min-width:321px){.w-details__header{padding:1.125em 48px 1.125em 0}.w-details__header::after{padding:.25em}}.w-details[open] .w-details__header::after{transform:rotate(180deg) translateY(50%)}.w-details__header:only-child{line-height:1.5rem;padding:.375rem 40px .375rem 0}h2.w-details__header:only-child{line-height:1.3333em;padding:.75rem 40px .75rem 0}.w-details>p:first-of-type{margin-top:0}.drawer-default__contents{background:#fff;display:flex;flex-direction:column;height:100vh;width:268px;max-width:90vw}.drawer-default__header{align-items:center;display:flex;padding:16px;border-bottom:1px solid #dadce0}.drawer-default__hide{height:2.75rem;margin:0 10px 0 -6px;width:2.75rem;color:#5f6368}.drawer-default__link{border-bottom:1px solid #dadce0;color:#5f6368;font-size:14px;font-weight:500;padding:16px 24px}.drawer-default__link[active]{-webkit-box-shadow:0 -2px 0 #3740ff inset;box-shadow:0 -2px 0 #3740ff inset}.drawer-default__link:active,.drawer-default__link:focus,.drawer-default__link:hover{text-decoration:none;outline:0}.drawer-default__link:hover{background-color:rgba(32,33,36,.04)}.drawer-default__link:focus{background-color:rgba(32,33,36,.12)}.drawer-default__link:active{background-color:rgba(32,33,36,.16)}.w-footer{border-top:1px solid #dadce0}@media print{.w-footer{display:none}}.w-footer__license{padding-top:32px;width:100%}.w-footer__license p{font-size:.75rem;margin:0;max-width:960px}.w-footer__linkboxes{background:#fff;display:block;font:400 14px/16px Segoe UI,system-ui,-apple-system,sans-serif}.w-footer__linkboxes-list{display:block;list-style:none;padding:24px 0}@media (min-width:865px){.w-footer__linkboxes-list{display:flex;padding:24px 12px 0}}.w-footer__linkbox{flex-grow:1;padding:0 16px 24px}@media (min-width:865px){.w-footer__linkbox{flex:1;margin:0}}.w-footer__linkbox:last-of-type{padding:0 16px}.w-footer__linkbox-heading{font:500 14px/16px Segoe UI,system-ui,-apple-system,sans-serif;margin:0 0 8px}.w-footer__linkbox-list{list-style-type:none;padding:0}.w-footer__linkbox-item{margin:0}.w-footer__linkbox-link{color:#202124;display:block;padding:16px 0}.w-footer__linkbox-link:focus,.w-footer__linkbox-link:hover,.w-footer__utility-link:focus,.w-footer__utility-link:hover{color:#3740ff;text-decoration:none}.w-footer__utility{background:#fff;display:block}.w-footer__utility-nav{border-top:1px solid #ddd;display:block;font:400 14px/16px Segoe UI,system-ui,-apple-system,sans-serif;margin:0 16px;padding:24px 0}@media (min-width:865px){.w-footer__utility-nav{align-items:center;display:flex;flex-wrap:wrap;margin:0 24px}}.w-footer__utility-list{display:block;list-style:none;padding:0}@media (min-width:865px){.w-footer__utility-list{align-items:center;display:flex;flex:1;flex-wrap:wrap}}.w-footer__utility-item{margin:0}@media (min-width:865px){.w-footer__utility-item{margin-right:40px}}.w-footer__utility-link{color:#202124;display:block;padding:16px 0}.w-footer__utility-logo-link{display:block;line-height:1;margin-right:40px}.w-footer__utility-logo{margin:-2px 0 16px;max-width:185px}@media (min-width:865px){.w-footer__utility-logo{margin:-2px 0 0}}.header-default{position:fixed;top:0}.header-default [data-open-drawer-button]{margin:0 8px 0 -8px}@media (min-width:865px){.header-default [data-open-drawer-button]{display:none}}.header-default__middle{align-items:center;display:flex;flex:1;height:100%;overflow:hidden;position:relative}.header-default__links{display:none;flex:1;height:100%;line-height:20px;min-width:50%;padding-left:48px}@media (min-width:865px){.header-default__links{display:flex}}.header-default__link{align-items:center;color:#202124;display:flex;font-weight:500;margin:0;padding:0 16px;position:relative}.header-default__link[active]{box-shadow:0 -2px 0 #3740ff inset}@media (min-width:1264px){.header-default__link{padding:0 24px}}.header-default__link:active,.header-default__link:focus,.header-default__link:hover{outline:0;text-decoration:none}.header-default__link:hover{background-color:rgba(32,33,36,.04)}.header-default__link:focus{background-color:rgba(32,33,36,.12)}.header-default__link:active{background-color:rgba(32,33,36,.16)}.header-default web-search{flex:1}@media (min-width:865px){.header-default web-search .web-search__input-wrapper{max-width:calc(200% - 16px*2);min-width:calc(200% - 16px*2);transform:translateX(calc(50% - 200px + 16px));transition:var(--web-search-animation-time) transform;width:calc(200% - 16px*2);display:flex}.header-default web-search .web-search__close-btn,.header-default web-search .web-search__open-btn{display:none}.header-default web-search[expanded] .web-search__input-wrapper{transform:translate(calc(-50% + 16px))}}.header-default .web-search-popout{border-top:1px solid #ddd;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15);left:0;padding:16px 0;position:absolute;top:55px;width:calc(100% - 45px)}@media (min-width:865px){.header-default .web-search-popout{left:calc(16px*2);width:calc(100% - 16px*2)}}web-header.web-header--has-expanded-search .header-default__logo-link,web-header.web-header--has-expanded-search web-profile-switcher-container{display:none}@media (min-width:865px){web-header.web-header--has-expanded-search .header-default__logo-link{display:inline}}web-header.web-header--has-expanded-search .header-default__middle{overflow:visible}@media (min-width:865px){web-header.web-header--has-expanded-search web-profile-switcher-container{display:flex}}.header-default~main{margin-top:64px}.icon{fill:currentColor}.w-hero,web-table-of-contents,web-table-of-contents-button[opened]{display:none}@media (min-width:481px){.w-hero{display:block;margin:0 auto;max-height:480px;width:1600px}}.w-hero--cover{object-fit:cover}.w-layout-container--narrow{box-sizing:content-box;margin:0 auto;overflow:visible;padding:24px}@media (min-width:481px){.w-layout-container--narrow{padding:32px}}.w-layout-container--narrow{max-width:800px}:root{--grid-min:150px;--grid-max:.5fr;--grid-gap:24px}web-livestream-container{background-color:#fff;display:flex;margin:auto;max-width:1600px}@media (min-width:865px){web-livestream-container{border-left:1px solid #dadce0;border-right:1px solid #dadce0}}web-subscribe:not(:defined){display:flex;justify-content:center;width:100%}.w-subscribe__error{color:#eb0f00}@media (min-width:865px){main.w-toc-open>*{width:calc(100% - 268px)}main.w-toc-open>* .w-actions{right:calc(24px + 268px)}}web-table-of-contents h2{line-height:32px}web-table-of-contents .w-scroll-spy__active{position:relative;display:inline-block}web-table-of-contents .w-scroll-spy__active::before{content:"";display:inline-block;border-left:3px solid #3740ff;margin-left:-24px;padding-left:21px;height:100%;position:absolute;top:0;left:0}web-table-of-contents[opened]{background-color:#fff;border-bottom:1px solid #dadce0;border-top:1px solid #dadce0;display:block;padding:24px 0;top:63px;width:100%;z-index:100}@media (min-width:481px){web-table-of-contents[opened]{padding-top:32px}}@media (min-width:865px){web-table-of-contents[opened]{border-bottom:0;border-left:1px solid #dadce0;border-top:0;height:calc(100% - 64px);position:fixed;right:0;width:268px}}.w-toc__button--open{background-color:#fff;border:1px solid #dadce0;height:40px;overflow:hidden;padding:8px}web-table-of-contents-button{display:flex;height:0;justify-content:flex-end;margin-bottom:-24px;margin-right:24px;padding-top:24px;top:64px;z-index:1}@media (min-width:481px){web-table-of-contents-button{margin-bottom:-32px;padding-top:32px}}@media (min-width:865px){web-table-of-contents-button{max-height:none;position:sticky}}@media print{web-table-of-contents-button{display:none}}.w-toc__content{height:calc(100% - 24px);overflow-y:auto;padding:0 24px}@media (min-width:481px){.w-toc__content{height:calc(100% - 32px)}}.w-toc__content a{display:inline-block}.w-toc__header{margin-bottom:12px;margin-top:12px}.w-toc__header--link{font-family:"Google Sans",sans-serif;font-size:1.2rem;font-weight:500}@media (min-width:865px){.w-toc__header--link{color:#202124}.w-toc__header--link.w-scroll-spy__active,.w-toc__header--link:hover{color:#3740ff}}.w-toc__label{display:flex;height:40px;justify-content:space-between;padding:0 24px}.w-toc__label>*{font-size:.9rem;height:40px;line-height:40px;vertical-align:middle}.w-toc__list ul{margin:0;padding:0}.w-toc__list ul li::before{content:none}.w-toc__list ul li a{font-size:1rem}@media (min-width:865px){.w-toc__list ul li a{color:#202124}.w-toc__list ul li a.w-scroll-spy__active,.w-toc__list ul li a:hover{color:#3740ff}}.w-headline-link{color:transparent;display:none;font-weight:500;margin-left:4px}@media (min-width:481px){.w-headline-link{display:inline}}.w-headline-link:focus,:hover>.w-headline-link{color:#5f6368;display:inline}.w-tooltip{background:#000;border-radius:3px;color:#fff;font:500 12px/1 Segoe UI,system-ui,-apple-system,sans-serif;left:50%;letter-spacing:.3px;opacity:0;padding:6px 8px;pointer-events:none;position:absolute;text-transform:none;top:calc(100% + 3px);transform:scale(.85) translateX(-50%);transform-origin:top left;transition:opacity 75ms,transform 0s 75ms,visibility 0s 75ms;visibility:hidden;white-space:nowrap;z-index:1}.w-tooltip--left{left:0;transform:scale(.85)}.w-tooltip--right{left:100%;transform:translateX(-100%) scale(.85);transform-origin:top right}@media (hover:hover){:hover>.w-tooltip{opacity:.77;transform:scale(1) translateX(-50%);transition:opacity .15s .3s,transform .15s .3s,visibility 0s;visibility:visible}:hover>.w-tooltip--left{transform:scale(1)}:hover>.w-tooltip--right{transform:translateX(-100%) scale(1)}}:active>.w-tooltip,:focus .w-tooltip{opacity:.77;transform:scale(1) translateX(-50%);transition:opacity .15s .3s,transform .15s .3s,visibility 0s;visibility:visible}:active>.w-tooltip{transition:opacity .15s .5s,transform .15s .5s,visibility 0s}:active>.w-tooltip--left,:focus .w-tooltip--left{transform:scale(1)}:active>.w-tooltip--right,:focus .w-tooltip--right{transform:translateX(-100%) scale(1)}web-audio-fab{border-radius:50%;bottom:12px;box-shadow:0 8px 12px 6px rgba(60,64,67,.15),0 4px 4px rgba(60,64,67,.3);display:block;height:56px;opacity:0;pointer-events:none;position:fixed;right:12px;transition:opacity .2s cubic-bezier(.4,0,.2,1);width:56px;z-index:1}web-audio-fab[showing]{opacity:1;pointer-events:auto}web-copy-code{display:block;position:relative}web-copy-code:active .web-copy-code__button,web-copy-code:focus .web-copy-code__button,web-copy-code:hover .web-copy-code__button{opacity:1}web-copy-code .web-copy-code__button{color:#202124;height:48px;margin:8px;opacity:0;position:absolute;right:0;width:48px}web-copy-code .web-copy-code__button::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:24px/1 "Material Icons";font-feature-settings:"liga";text-rendering:optimizeSpeed;text-transform:none;word-wrap:normal;content:"content_copy"}web-copy-code .web-copy-code__button:focus,web-copy-code .web-copy-code__button:hover{background-color:rgba(63,196,255,.2);opacity:1}web-copy-code .web-copy-code__button:active{background-color:rgba(63,196,255,.4);opacity:1}web-header{align-items:center;background:#fff;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15);color:#202124;contain:layout;display:flex;font-size:14px;height:64px;padding:0 24px;width:100%;z-index:200}@media print{web-header{display:none}}web-navigation-drawer{display:block;height:100%;left:0;pointer-events:none;position:fixed;top:0;width:100%;z-index:300}web-navigation-drawer [data-drawer-container]{box-shadow:2px 0 12px rgba(0,0,0,.4);position:relative;transform:translateX(-110%);width:fit-content}@media (min-width:1264px){web-navigation-drawer[type=standard]{align-self:flex-start;position:sticky;pointer-events:auto;top:0;width:auto}web-navigation-drawer[type=standard] [data-drawer-container]{box-shadow:none;transform:none}web-navigation-drawer[type=standard] [data-drawer-close-button]{visibility:hidden}}web-navigation-drawer::before{content:"";display:block;position:absolute;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.4);opacity:0;transition:opacity .2s cubic-bezier(.4,0,.2,1)}web-navigation-drawer[open]{pointer-events:auto;visibility:visible}web-navigation-drawer[open]::before{opacity:1}web-navigation-drawer[open] [data-drawer-container]{transform:none}web-navigation-drawer[animating] [data-drawer-container],web-navigation-drawer[open][animating] [data-drawer-container]{transition:transform .2s cubic-bezier(.4,0,.2,1)}.youtube{padding-top:56.25%;position:relative;width:100%;border-radius:8px;overflow:hidden}lite-youtube{height:100%;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%}web-codelab{display:flex;flex-flow:column;padding:16px}@media (min-width:865px){web-codelab{flex-flow:row}}web-codelab .web-codelab__glitch{min-height:160px}.w-event-carousel__day{color:#3c4043;font-family:"Google Sans",sans-serif;font-size:14px;font-weight:500;margin-right:16px}.w-event-carousel__day:last-child{margin-right:0}.w-event-carousel__day.w-event-carousel__pending{opacity:.6}.w-event-carousel__thumbnail{margin-bottom:8px;background-color:#e8eaed;border-radius:3px;overflow:hidden;width:178px;height:110px}.w-event-carousel__thumbnail>img{height:100%;object-fit:cover}.w-event-schedule__video{align-self:center;font-weight:500;z-index:1}web-progress-bar{background-color:#fff;visibility:hidden;z-index:1}.guide-landing-page{position:relative}.w-post-breadcrumbs{padding:0 0 32px}@media (min-width:865px){.w-post-breadcrumbs{padding:0 0 44px}}.w-post-content{margin-bottom:64px}@media (min-width:481px){.w-post-content{margin-bottom:160px}}.w-post-github-link{color:#5f6368;font-size:.875em}:root{--course-content-margin:24px}.w-text--center{text-align:center!important}.w-display--flex{display:flex}.w-justify-content--center{justify-content:center}.w-mb--non{margin-bottom:0!important}.w-mb--sm{margin-bottom:8px!important}.w-mt--sm{margin-top:8px!important}.w-mr--sm{margin-right:8px!important}.w-pt--sm{padding-top:8px!important}.w-mb--l{margin-bottom:32px!important}.w-mt--l{margin-top:32px!important}.w-mt--xl{margin-top:56px!important}.hidden,[hidden]{display:none!important}:not(body).unresolved,web-tabs.unresolved>:not(.w-tabs-default){display:none}web-tabs.unresolved{padding-top:50px;display:block}web-event-time.unresolved{min-height:120px;display:block}</style><link href=/fonts/material-icons/regular.woff2 rel=preload as=font crossorigin><link href=/fonts/google-sans/regular/latin.woff2 rel=preload as=font crossorigin><link href=/fonts/google-sans/bold/latin.woff2 rel=preload as=font crossorigin><meta content=#fff name=theme-color><title>Bringing service workers to Google Search</title><meta content="Search for just about any topic on Google, and you're presented with a page of meaningful, relevant results. What you probably didn't realize is that this search results page may be served by a powerful piece of web technology called a service worker. " name=description><link href=https://web.dev/google-search-sw/ rel=canonical><meta content="Bringing service workers to Google Search" itemprop=name><meta content="Search for just about any topic on Google, and you're presented with a page of meaningful, relevant results. What you probably didn't realize is that this search results page may be served by a powerful piece of web technology called a service worker. " itemprop=description><meta content="https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&fit=max&w=1200&fm=auto" itemprop=image><meta content=en_US property=og:locale><meta content=article property=og:type><meta content=https://web.dev/google-search-sw/ property=og:url><meta content=web.dev property=og:site_name><meta content="Bringing service workers to Google Search" property=og:title><meta content="Search for just about any topic on Google, and you're presented with a page of meaningful, relevant results. What you probably didn't realize is that this search results page may be served by a powerful piece of web technology called a service worker. " property=og:description><meta content="https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&fit=max&w=1200&fm=auto" property=og:image><meta content="An illustration of a service worker interacting with a cache." property=og:image:alt><meta content=performance property=tag><meta content=service-worker property=tag><meta content=case-study property=tag><meta content=summary_large_image name=twitter:card><meta content="Bringing service workers to Google Search" name=twitter:title><meta content="Search for just about any topic on Google, and you're presented with a page of meaningful, relevant results. What you probably didn't realize is that this search results page may be served by a powerful piece of web technology called a service worker. " name=twitter:description><meta content="https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&fit=max&w=1200&fm=auto" name=twitter:image><link href=/feed.xml rel=alternate type=application/atom+xml data-title="web.dev feed"><link href=/manifest.webmanifest rel=manifest><link href=/images/favicon.ico rel="shortcut icon"><link href=/images/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/images/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/images/safari-pinned-tab.svg rel=mask-icon color=#0054ff><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-126406676-2"),ga("set","transport","beacon"),ga("set","anonymizeIp",!0),ga("set","page",window.location.pathname),ga("set","dimension5","4"),ga("send","pageview");</script><script>function loadScript(e,t){const d=document.createElement("script");if(d.src=e,t&&(d.type=t),"module"===t){d.async=!1;const t=document.createElement("link");t.rel="modulepreload",t.href=e,document.head.append(t),window.addEventListener("DOMContentLoaded",(()=>{document.head.append(d)}))}else document.head.append(d)}loadScript("/js/app.js?v=c4d27698","module"),loadScript("/js/content.js?v=9e7685c5","module"),loadScript("https://www.google-analytics.com/analytics.js",null);</script></head><body class=unresolved><web-snackbar-container></web-snackbar-container><web-header class=header-default role=navigation><button aria-label="Open menu" class="w-button--round w-button--svg" data-open-drawer-button><svg class=icon height=24 viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg aria-label=menu role=img><path d="M0 0h24v24H0z" fill=none /><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <span class="w-tooltip w-tooltip--left">Open menu</span></button> <a href=/ class="gc-analytics-event header-default__logo-link" data-category="Site-Wide Custom Events" data-label="Site logo"><img alt=web.dev height=30 src=/images/lockup.svg width=125 class=header-default__logo></a><div class=header-default__middle><div class=header-default__links><a href=/learn/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Learn">Learn </a><a href=/measure/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Measure">Measure </a><a href=/blog/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: Blog">Blog </a><a href=/about/ class="gc-analytics-event header-default__link" data-category="Site-Wide Custom Events" data-label="Tab: About">About</a></div><web-search results-id=search-main-results></web-search><web-search-results id=search-main-results></web-search-results></div><web-profile-switcher-container></web-profile-switcher-container></web-header><web-navigation-drawer class=drawer-default type=modal><nav data-drawer-container><div class=drawer-default__contents><div class=drawer-default__header><button aria-label=Close class="w-button--round w-button--svg drawer-default__hide" data-drawer-close-button><svg class=icon height=24 viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg aria-label=close role=img><path d="M0 0h24v24H0z" fill=none /><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <span class=w-tooltip>Close</span></button> <a href=/ class=gc-analytics-event data-category="Site-Wide Custom Events" data-label="Site logo"><img alt=web.dev height=30 src=/images/lockup.svg width=125 class=drawer-default__logo></a></div><a href=/learn/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Learn">Learn </a><a href=/measure/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Measure">Measure </a><a href=/blog/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: Blog">Blog </a><a href=/about/ class="gc-analytics-event drawer-default__link" data-category="Site-Wide Custom Events" data-label="SideNav: About">About</a></div></nav></web-navigation-drawer><main><div id=content><div class=guide-landing-page><img alt="An illustration of a service worker interacting with a cache." height=480 src="https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format" width=1600 class="w-hero w-hero--cover" decoding=auto sizes=100vw srcset="https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=200 200w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=228 228w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=260 260w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=296 296w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=338 338w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=385 385w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=439 439w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=500 500w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=571 571w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=650 650w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=741 741w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=845 845w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=964 964w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/admin/SEsw9jtfge6PSYNqTkUl.jpg?auto=format&w=1600 1600w"><web-table-of-contents><h2 class=w-toc__header><a href=#bringing-service-workers-to-google-search class=w-toc__header--link>Bringing service workers to Google Search</a></h2><div class=w-toc__list><ul><li><a href=#background>Background</a></li><li><a href=#key-reasons-for-exploring-service-workers>Key reasons for exploring service workers</a></li><li><a href=#limited-search-result-caching>Limited search result caching</a></li><li><a href=#meaningful-offline-experience>Meaningful offline experience</a></li><li><a href=#smarter-javascript-caching-and-serving>Smarter JavaScript caching and serving</a></li><li><a href=#challenges-and-solutions>Challenges and solutions</a></li><li><a href=#problem:-service-worker-overhead>Problem: service worker overhead</a></li><li><a href=#solution:-use-navigation-preload>Solution: use navigation preload</a></li><li><a href=#problem:-service-worker-scopes>Problem: service worker scopes</a></li><li><a href=#solution:-create-a-dispatch-and-routing-framework>Solution: create a dispatch and routing framework</a></li><li><a href=#problem:-personalized-results-and-metrics>Problem: personalized results and metrics</a></li><li><a href=#solution:-send-cookies-using-postmessage>Solution: send cookies using postMessage</a></li><li><a href=#problem:-experiments-and-dynamism>Problem: experiments and dynamism</a></li><li><a href=#solution:-dynamically-generated-service-worker-script>Solution: dynamically generated service worker script</a></li><li><a href=#problem:-coordinating-updates>Problem: coordinating updates</a></li><li><a href=#solution:-balance-freshness-and-cache-utilization>Solution: balance freshness and cache-utilization</a></li><li><a href=#key-takeaways>Key Takeaways</a></li><li><a href="#by-default-service-workers-aren't-performance-neutral">By default, service workers aren't performance neutral</a></li><li><a href=#service-workers-are-(still!)-a-progressive-enhancement>Service workers are (still!) a progressive enhancement</a></li><li><a href=#measure-everything>Measure everything</a></li><li><a href=#non-goals>Non-goals</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></div></web-table-of-contents><web-table-of-contents-button></web-table-of-contents-button><div class=w-actions><share-action authors=@jeffposnick class="gc-analytics-event w-actions__fab w-actions__fab--share" data-action=click data-category=web.dev data-icon=share data-label=share role=button tabindex=0><span>Share</span></share-action><a href=/newsletter/ class="gc-analytics-event w-actions__fab w-actions__fab--subscribe" data-category=web.dev data-label=view-subscribe data-action=click><span>subscribe</span></a></div><div class="w-layout-container--narrow w-post-content"><header class=w-article-header><div class=w-post-breadcrumbs><ul class=w-breadcrumbs><li class=w-breadcrumbs__crumb><a href=/ class="gc-analytics-event w-breadcrumbs__link w-breadcrumbs__link--left-justify" data-category=web.dev data-label="post, home breadcrumb" data-action=click>Home</a></li><svg class=w-breadcrumbs__icon height=24 viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg aria-hidden=true><path d="M0 0h24v24H0V0z" fill=none /><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg><li class=w-breadcrumbs__crumb><a href=/blog class="gc-analytics-event w-breadcrumbs__link" data-category=web.dev data-label="post, path breadcrumb" data-action=click>All articles</a></li></ul></div><h1 class=w-article-header__headline id=bringing-service-workers-to-google-search>Bringing service workers to Google Search</h1><p class="w-article-header__subhead w-mb--non">The story of what shipped, how the impact was measured, and the tradeoffs that were made.</p><div class=w-author__published><time>Jun 20, 2019</time></div><div class="w-authors w-mt--xl w-pt--sm"><div class=w-author><a href=/authors/jeffposnick/ ><img alt="Jeff Posnick" height=64 src="https://web-dev.imgix.net/image/admin/uskKSRCW1HyOTCjtdMdo.jpg?auto=format&fit=crop&h=64&w=64" width=64 class=w-author__image decoding=async sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/uskKSRCW1HyOTCjtdMdo.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75, https://web-dev.imgix.net/image/admin/uskKSRCW1HyOTCjtdMdo.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x, https://web-dev.imgix.net/image/admin/uskKSRCW1HyOTCjtdMdo.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x, https://web-dev.imgix.net/image/admin/uskKSRCW1HyOTCjtdMdo.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x, https://web-dev.imgix.net/image/admin/uskKSRCW1HyOTCjtdMdo.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x" loading=lazy></a><div class=w-author__info style="display: flex; flex-direction: column; justify-content: center;"><cite class=w-author__name><a href=/authors/jeffposnick/ class=w-author__name-link>Jeff Posnick</a></cite><ul class=w-author__link-list><li class=w-author__link-listitem><a href=https://twitter.com/jeffposnick class=w-author__link>Twitter</a></li><li class=w-author__link-listitem><a href=https://github.com/jeffposnick class=w-author__link>GitHub</a></li><li class=w-author__link-listitem><a href=https://glitch.com/@jeffposnick class=w-author__link>Glitch</a></li><li class=w-author__link-listitem><a href=https://twitter.com/jeffposnick class=w-author__link>Blog</a></li></ul></div></div></div></header><h2 id=background>Background <a href=#background class=w-headline-link>#</a></h2><p>Search for just about any topic on Google, and you're presented with an instantly recognizable page of meaningful, relevant results. What you probably <em>didn't</em> realize is that this search results page is, under certain scenarios, served by a powerful piece of web technology called a <a href=/service-workers-cache-storage/ >service worker</a>.</p><p>Rolling out service worker support for Google Search without negatively impacting the performance required dozens of engineers working across multiple teams. This is the story of what shipped, how performance was measured, and what tradeoffs were made.</p><h2 id=key-reasons-for-exploring-service-workers>Key reasons for exploring service workers <a href=#key-reasons-for-exploring-service-workers class=w-headline-link>#</a></h2><p>Adding a service worker to a web app, just like making any architectural change to your site, should be done with a clear set of goals in mind. For the Google Search team, there were a few key reasons why adding a service worker was worth exploring.</p><div class="w-aside w-aside--note"><p>A service worker is extra code that sits in between your web app and the network, and running that code isn't free, so you need to make sure that what you're doing inside the service worker adds enough of a caching or functionality benefit to justify the cost of running the code. (This <a href="https://www.youtube.com/watch?v=25aCD5XL1Jk" rel=noopener>talk</a> at the Chrome Dev Summit 2018 does a great job of exploring that idea in more detail.) An upfront understanding what you hope to achieve—and then collecting a full set of metrics to ensure that you've actually achieved it—should be the first step in your service worker journey.</p></div><h3 id=limited-search-result-caching>Limited search result caching <a href=#limited-search-result-caching class=w-headline-link>#</a></h3><p>The Google Search team found that it's common for users to search for the same terms more than once within a short period of time. Rather than trigger a new backend request just to get what's likely to be the same results, the Search team wanted to take advantage of caching and fulfill those repeat requests locally.</p><p>The importance of freshness can't be discounted, and sometimes users search for the same terms repeatedly because it's an evolving topic, and they expect to see fresh results. Using a service worker allows the Search team to implement fine-grained logic to control the lifetime of locally cached search results, and achieve the exact balance of speed vs. freshness that they believe best serves users.</p><h3 id=meaningful-offline-experience>Meaningful offline experience <a href=#meaningful-offline-experience class=w-headline-link>#</a></h3><p>Additionally, the Google Search team wanted to provide a meaningful offline experience. When a user wants to find out about a topic, they want to go straight to the Google Search page and start searching, without worrying about an active Internet connection.</p><p>Without a service worker, visiting the Google search page while offline would just lead to the browser's standard network error page, and users would have to remember to come back and try again once their connection returned. With a service worker, it's possible to serve a custom offline HTML response, and allow users to enter their search query immediately.</p><img alt="A screenshot of the background retry interface." height=634 src="https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format" width=343 decoding=async sizes="(min-width: 343px) 343px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/admin/Q60UfWp6FNp0b9vbqJXc.png?auto=format&w=686 686w" loading=lazy><p>The results won't be available until there's an Internet connection, but the service worker allows the search to be deferred and sent to Google's servers as soon as the device goes back online using the <a href=https://developers.google.com/web/updates/2015/12/background-sync rel=noopener>background sync API</a>.</p><h3 id=smarter-javascript-caching-and-serving>Smarter JavaScript caching and serving <a href=#smarter-javascript-caching-and-serving class=w-headline-link>#</a></h3><p>Another motivation was to optimize the caching and loading of the modularized JavaScript code that powers the various types of features on the search results page. There are a number of benefits offered by JavaScript bundling that make sense when there's no service worker involvement, so the Search team did not want to simply stop bundling entirely.</p><p>By using a service worker's ability to version and cache fine-grained chunks of JavaScript at runtime, the Search team suspected that they could reduce the amount of cache churn and ensure that JavaScript reused in the future can be cached efficiently. The logic inside of their service worker can analyze an outgoing HTTP request for a bundle that contains multiple JavaScript modules, and fulfill it by piecing together multiple, locally cached modules—effectively "unbundling" when possible. This saves user bandwidth, and improves overall responsiveness.</p><div class="w-aside w-aside--success"><p><strong>Success</strong>: On average, repeat visits handled by the service worker result in <strong>half as much new JavaScript downloaded</strong>, and that directly leads to <strong>6% fewer delayed user interactions</strong>.</p></div><p>There are also performance benefits of using cached JavaScript served by a service worker: in Chrome, <a href=https://v8.dev/blog/code-caching-for-devs#use-service-worker-caches rel=noopener>a parsed, byte code representation</a> of that JavaScript is stored and reused, leading to less work that needs to be done at runtime in order to execute the JavaScript on the page.</p><h2 id=challenges-and-solutions>Challenges and solutions <a href=#challenges-and-solutions class=w-headline-link>#</a></h2><p>Here are a few of the hurdles that needed to be overcome in order to achieve the team's stated goals. While some of these challenges are specific to Google Search, many of them are applicable to a wide range of sites that might be considering a service worker deployment.</p><h3 id=problem:-service-worker-overhead>Problem: service worker overhead <a href=#problem:-service-worker-overhead class=w-headline-link>#</a></h3><p>The biggest challenge, and the one true blocker for launching a service worker on Google Search, was to ensure that it did not do anything that might increase user-perceived latency. Google Search takes performance <em>very</em> seriously, and in the past, has blocked launches of new functionality if it contributed even tens of milliseconds of additional latency for a given user population.</p><p>When the team started collecting performance data during their earliest experiments, it became obvious that there would be a problem. The HTML returned in response to <a href=https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests rel=noopener>navigation requests</a> for the search result page is dynamic, and varies greatly depending on logic that needs to run on Search's web servers. There's currently no way for the service worker to replicate this logic and return cached HTML immediately—the best it could do is to pass along navigation requests to the backend web servers, which necessitates a network request.</p><p>Without a service worker, this network request happens immediately upon user navigation. When a service worker is registered, it always needs to be started up and given a chance to execute its <a href=https://developers.google.com/web/fundamentals/primers/service-workers/#cache_and_return_requests rel=noopener><code>fetch</code> event handlers</a>, even when there's no chance those fetch handlers will do anything other than go to the network. The amount of time that it takes to start up and run the service worker code is pure overhead added on top of every navigation:</p><img alt="An illustration of the SW startup blocking the navigation request." height=96 src="https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format" width=768 decoding=async sizes="(min-width: 768px) 768px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=1252 1252w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=1428 1428w, https://web-dev.imgix.net/image/admin/W9v9DmCDOo6VJp7gOXPB.png?auto=format&w=1536 1536w" loading=lazy><p>This puts the service worker implementation at too much of a latency disadvantage to justify any other benefits. Additionally, the team found that, based on measuring service worker boot times on real-world devices, there was a wide distribution of startup times, with some low-end mobile devices taking almost as much time to start up the service worker as it might take to make the network request for the results page's HTML.</p><h3 id=solution:-use-navigation-preload>Solution: use navigation preload <a href=#solution:-use-navigation-preload class=w-headline-link>#</a></h3><p>The single, most crucial feature that allowed the Google Search team to move ahead with their service worker launch is <a href=https://developers.google.com/web/updates/2017/02/navigation-preload rel=noopener>navigation preload</a>. Using navigation preload is a key performance win for any service worker that needs to use a response from the network to satisfy navigation requests. It provides a hint to the browser to start making the navigation request immediately, at the same time as the service worker starts up:</p><img alt="An illustration of the SW startup done in parallel with the navigation request." height=179 src="https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format" width=614 decoding=async sizes="(min-width: 614px) 614px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=200 200w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=228 228w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=260 260w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=296 296w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=338 338w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=385 385w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=439 439w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=500 500w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=571 571w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=650 650w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=741 741w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=845 845w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=964 964w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=1098 1098w, https://web-dev.imgix.net/image/admin/rFkXhIK4xLREiROkxITA.png?auto=format&w=1228 1228w" loading=lazy><p>As long as the amount of time it takes for the service worker to start up is less than the amount of time it takes to get a response back from the network, there shouldn't be any latency overhead introduced by the service worker.</p><p>The Search team also needed to avoid using a service worker on low-end mobile devices where the service worker boot time could exceed the navigation request. Since there's no hard-and-fast rule for what constitutes a "low-end" device, they came up with the heuristic of <a href=https://developers.google.com/web/updates/2017/12/device-memory rel=noopener>checking the total RAM</a> installed on the device. Anything less than 2 gigabytes of memory fell into their low-end device category, where service worker startup time would be unacceptable.</p><p>Available storage space is another consideration, since the full set of resources to be cached for future use can run to several megabytes. The <a href=https://developers.google.com/web/updates/2017/08/estimating-available-storage-space rel=noopener><code>navigator.storage</code> interface</a> allows the Google Search page to figure out in advance whether their attempts to cache data run the risk of failing due to storage quota failures.</p><p>This left the Search team with multiple pieces of criteria that they could use to determine whether or not to use a service worker: if a user comes to the Google Search page using a browser that supports navigation preload, and has at least 2 gigabytes of RAM, and enough free storage space, then a <a href=https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#the_first_service_worker rel=noopener>service worker is registered</a>. Browsers or devices that don't meet that criteria won't end up with a service worker, but they'll still see the same Google Search experience as they always have.</p><p>One side benefit of this selective registration is the ability to ship a smaller, more efficient service worker. Targeting fairly modern browsers to run the service worker code eliminates the overhead of transpilation and polyfills for older browsers. This ended up cutting out around 8 kilobytes of uncompressed JavaScript code from the total size of the service worker's implementation.</p><h3 id=problem:-service-worker-scopes>Problem: service worker scopes <a href=#problem:-service-worker-scopes class=w-headline-link>#</a></h3><p>Once the Search team ran enough latency experiments and were confident that using navigation preload offered them a viable, latency-neutral path for using a service worker, some practical issues started moving to the forefront. One of those issues has to do with service worker's <a href=https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope rel=noopener>scoping rules</a>. A service worker's scope determines which pages it can potentially take control of.</p><p>Scoping works based on the URL path prefix. For domains that host a single web app, this isn't an issue, as you'd normally just use a service worker with the maximal scope of <code>/</code>, which could take control of any page under the domain. But Google Search's URL structure is a little more complicated.</p><p>If the service worker were given the maximal scope of <code>/</code>, it would end up being able to take control of any page hosted under <code>www.google.com</code> (or the regional equivalent), and there are URLs under that domain that have nothing to do with Google Search. A more reasonable, restrictive scope would be <code>/search</code>, which at least would eliminate URLs completely unrelated to search results.</p><p>Unfortunately, even that <code>/search</code> URL path is shared amongst different flavor of Google Search results, with URL query parameters determining which specific type of search result is shown. Some of those flavors use completely different codebases than the traditional web search result page. For example, Image Search and Shopping Search are both served under the <code>/search</code> URL path with different query parameters, but neither of those interfaces were ready to ship their own service worker experience (yet).</p><h3 id=solution:-create-a-dispatch-and-routing-framework>Solution: create a dispatch and routing framework <a href=#solution:-create-a-dispatch-and-routing-framework class=w-headline-link>#</a></h3><p>While there are <a href=https://github.com/w3c/ServiceWorker/issues/1373 rel=noopener>some proposals</a> that allow for something more powerful than URL path prefixes to determine service worker scopes, the Google Search team was stuck deploying a service worker that did nothing for a subset of pages it controlled.</p><p>To work around this, the Google Search team built up a bespoke dispatch and routing framework that could be configured to check for criteria like the query parameters of the client page, and use those to determine which specific code path to go down. Rather than hardcoding rules, the system was built to be flexible and allow teams that share the URL space, like Image Search and Shopping Search, to drop in their own service worker logic down the line, if they decide to implement it.</p><div class="w-aside w-aside--note"><p>While this custom solution is internal to Google, the same general principle can be applied to any domain that includes a number of different logical web apps, all of whom live under a common URL.</p></div><h3 id=problem:-personalized-results-and-metrics>Problem: personalized results and metrics <a href=#problem:-personalized-results-and-metrics class=w-headline-link>#</a></h3><p>Users can sign in to Google Search using their Google Accounts, and their search results experience may be customized based on their particular account data. Logged in users are identified by specific <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies rel=noopener>browser cookies</a>, which is a venerable and widely-supported standard.</p><p>One downside of using browser cookies, though, is that they are not exposed inside of a service worker, and there is no way of automatically examining their values and ensuring that they have not changed due to a user logging out or switching accounts. (There is effort underway to <a href=https://developers.google.com/web/updates/2018/09/asynchronous-access-to-http-cookies#welcome_service_workers rel=noopener>bring cookie access to service workers</a>, but as of this writing, the approach is <a href=https://developers.google.com/web/updates/2018/09/asynchronous-access-to-http-cookies#origin-trial rel=noopener>experimental</a> and is not widely supported.)</p><p>A mismatch between the service worker's view of the current logged in user and the actual user logged in to the Google Search web interface could lead to incorrectly personalized search results or misattributed metrics and logging. Any of those failure scenarios would be a serious issue for the Google Search team.</p><h3 id=solution:-send-cookies-using-postmessage>Solution: send cookies using postMessage <a href=#solution:-send-cookies-using-postmessage class=w-headline-link>#</a></h3><p>Rather than wait for experimental APIs to launch and provide direct access to the browser's cookies inside of a service worker, the Google Search team went with a stop-gap solution: whenever a page controlled by the service worker is loaded, the page reads the relevant cookies and uses <a href=https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage rel=noopener><code>postMessage()</code></a> to send them to the service worker.</p><p>The service worker then checks the current cookie value against the value that it expects, and if there's a mismatch, it takes steps to purge any user-specific data from its storage, and reloads the search results page without any incorrect personalization.</p><p>The specific steps that the service worker takes to reset things to a baseline are particular to Google Search's requirements, but the same general approach may be useful to other developers who deal with personalized data keyed off of browsers cookies.</p><h3 id=problem:-experiments-and-dynamism>Problem: experiments and dynamism <a href=#problem:-experiments-and-dynamism class=w-headline-link>#</a></h3><p>As mentioned, the Google Search team relies heavily on running experiments in production, and testing the effects of new code and features in the real world before turning them on by default. This can be a bit of a challenge with a static service worker that relies heavily on cached data, since opting users in and out of experiments often requires communication with the backend server.</p><h3 id=solution:-dynamically-generated-service-worker-script>Solution: dynamically generated service worker script <a href=#solution:-dynamically-generated-service-worker-script class=w-headline-link>#</a></h3><p>The solution that the team went with was to use a dynamically generated service worker script, customized by the web server for each individual user, instead of a single, static service worker script that gets generated ahead of time. Information about experiments that might affect the service worker's behavior or network requests in general are included directly in this customized service worker scripts. Changing the sets of active experiences for a user is done via a combination of traditional techniques, like browser cookies, as well as serving updated code in the registered service worker URL.</p><p>Using a dynamically generated service worker script also makes it easier to provide an escape hatch in the unlikely event that a service worker implementation has a fatal bug that needs to be avoided. The dynamic server worker response could be a <a href=https://stackoverflow.com/a/38980776/385997 rel=noopener>no-op implementation</a>, effectively disabling the service worker for some or all of the current users.</p><h3 id=problem:-coordinating-updates>Problem: coordinating updates <a href=#problem:-coordinating-updates class=w-headline-link>#</a></h3><p>One of the toughest challenges facing any real-world service worker deployment is to devise a reasonable tradeoff between avoiding the network in favor of the cache, while at the same time, ensuring that existing users get critical updates and changes soon after they're deployed to production. The right balance depends on a lot of factors:</p><ul><li>Whether your web app is a long-lived <a href=https://en.wikipedia.org/wiki/Single-page_application rel=noopener>single page app</a> that a user keeps open indefinitely, without navigating to new pages.</li><li>What the deployment cadence is for updates to your backend web server.</li><li>Whether the average user would tolerate using a slightly out-of-date version of your web app, or whether freshness is the top priority.</li></ul><p>While experimenting with service workers, the Google Search team made sure to keep the experiments running across a number of scheduled backend updates, to ensure that the metrics and user experience would more closely match what return users would end up seeing in the real-world.</p><div class="w-aside w-aside--caution"><p><strong>Caution</strong>: It's important to remember that shipping a service worker is <strong>not a one-time deployment</strong>—you need to have a process in place, tailored to your own production infrastructure, to make sure that updates happen smoothly over time!</p></div><h3 id=solution:-balance-freshness-and-cache-utilization>Solution: balance freshness and cache-utilization <a href=#solution:-balance-freshness-and-cache-utilization class=w-headline-link>#</a></h3><p>After testing a number of different configuration options, the Google Search team found that the following setup provided the right balance between freshness and cache-utilization.</p><p>The service worker script URL is served with the <code>Cache-Control: private, max-age=1500</code> (1500 seconds, or 25 minutes) response header, and is <a href=https://developers.google.com/web/updates/2018/06/fresher-sw#updateviacache rel=noopener>registered with updateViaCache set to 'all'</a> to ensure that the header is honored. The Google Search web backend is, as you might imagine, a large, globally distributed set of servers that requires as close to 100% uptime as possible. Deploying a change that would affect the service worker script's contents is done in a rolling fashion.</p><p>If a user hits a backend that has been updated, and then quickly navigates to another page which hits a backend that hasn't yet received the updated service worker, they'd end up flip-flopping between versions multiple times. Therefore, telling the browser to only bother checking for an updated script if 25 minutes has passed since the last check does not have a significant downside. The upside of opting-in to this behavior is cutting down significantly on the traffic received by the endpoint that dynamically generates the service worker script.</p><p>Additionally, an ETag header is set on the service worker script's HTTP response, ensuring that when an update check is made after 25 minutes has passed, the server can respond efficiently with an <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/304 rel=noopener>HTTP 304</a> response if there haven't been any updates to the service worker deployed in the interim.</p><p>While some interactions within the Google Search web app use single page app-style navigations (i.e. via the <a href=https://developer.mozilla.org/en-US/docs/Web/API/History_API#Adding_and_modifying_history_entries rel=noopener>History API</a>), for the most part, Google Search is a traditional web app that uses "real" navigations. This comes into play when the team decided that it would be effective to use two options that accelerate the service worker update lifecycle: <a href=https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#clientsclaim rel=noopener><code>clients.claim()</code></a> and <a href=https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase rel=noopener><code>skipWaiting()</code></a>. Clicking around Google Search's interface generally ends up navigating to new HTML documents. Calling <code>skipWaiting</code> ensures that an updated service worker gets a chance to handle those new navigation requests immediately after installation. Similarly, calling <code>clients.claim()</code> means that the updated service worker gets a chance to start controlling any open Google Search pages that are uncontrolled, following service worker activation.</p><p>The approach that Google Search went with isn't necessarily a solution that works for everyone—it was the result of carefully A/B testing various combinations of serving options until they found what worked best for them. Developers whose backend infrastructure allow them to deploy updates more quickly might prefer that the browser check for an updated service worker script as frequently as possible, by <a href=https://developers.google.com/web/updates/2018/06/fresher-sw#whats_changing rel=noopener>always ignoring the HTTP cache</a>. If you're building a single page app that users will might keep open for a long period of time, using <code>skipWaiting()</code> is probably not the right choice for you—you <a href=https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase rel=noopener>risk running into cache inconsistencies</a> if you allow the new service worker to activate while there are long-lived clients.</p><h2 id=key-takeaways>Key Takeaways <a href=#key-takeaways class=w-headline-link>#</a></h2><h3 id="by-default-service-workers-aren't-performance-neutral">By default, service workers aren't performance neutral <a href="#by-default-service-workers-aren't-performance-neutral" class=w-headline-link>#</a></h3><p>Adding a service worker to your web app means inserting an additional piece of JavaScript that needs to be loaded and executed before your web app gets responses to its requests. If those responses end up coming from a local cache rather than from the network, then the overhead of running the service worker is usually negligible in comparison to the performance win from going cache-first. But if you know that your service worker always has to consult the network when handling navigation requests, using navigation preload is a crucial performance win.</p><h3 id=service-workers-are-(still!)-a-progressive-enhancement>Service workers are (still!) a progressive enhancement <a href=#service-workers-are-(still!)-a-progressive-enhancement class=w-headline-link>#</a></h3><p>The service worker support story is much brighter today than it was even a year ago. All modern browsers now feature at least some <a href=https://jakearchibald.github.io/isserviceworkerready/ rel=noopener>support for service workers</a>, but unfortunately, there are some advanced service worker features—like background sync and navigation preload—that aren't rolled out universally. Feature checking for the specific subset of features that you know you need, and only registering a service worker when those are present, is still a reasonable approach to take.</p><p>Similarly, if you've run experiments in the wild, and know that low-end devices end up performing poorly with the additional overhead of a service worker, you can abstain from registering a service worker in those scenarios as well.</p><p>You should continue to treat service workers as a <a href=https://en.wikipedia.org/wiki/Progressive_enhancement rel=noopener>progressive enhancement</a> that gets added to a web app when all the prerequisites are met and the service worker adds something positive to user experience and overall loading performance.</p><h3 id=measure-everything>Measure everything <a href=#measure-everything class=w-headline-link>#</a></h3><p>The only way you can figure out whether shipping a service worker has had a positive or negative impact on your users' experiences is to experiment and measure the results.</p><p>The specifics of setting up meaningful measurements depends on what analytics provider you're using, and how you normally conduct experiments in your deployment setup. One approach, using Google Analytics to collect metrics, is detailed in <a href=https://developers.google.com/web/showcase/2016/service-worker-perf rel=noopener>this case study</a> based on the experience using service workers in the Google I/O web app.</p><h2 id=non-goals>Non-goals <a href=#non-goals class=w-headline-link>#</a></h2><p>While many in the web development community associate service workers with <a href=https://developers.google.com/web/progressive-web-apps/ rel=noopener>Progressive Web Apps</a>, building a "Google Search PWA" was not an initial goal of the team. The Google Search web app doesn't currently provide metadata via a <a href=https://developers.google.com/web/fundamentals/web-app-manifest/ rel=noopener>web app manifest</a>, nor does it encourage users to go through the <a href=https://developers.google.com/web/fundamentals/app-install-banners/ rel=noopener>Add to Home Screen flow</a>. The Search team is currently satisfied with users coming to their web app via the traditional entry points for Google Search.</p><p>Rather than trying to turn the Google Search web experience into the equivalent of what you'd expect from an installed application, the focus on the initial roll out was to progressively enhance the existing web site.</p><h2 id=acknowledgements>Acknowledgements <a href=#acknowledgements class=w-headline-link>#</a></h2><p>Thanks to the entire Google Search web development team for their work on the service worker implementation, and for sharing the background material that went into writing this article. Particular thanks goes to Philippe Golle, Rajesh Jagannathan, R. Samuel Klatchko, Andy Martone, Leonardo Peña, Rachel Shearer, Greg Terrono, and Clay Woolam.</p><div class=w-chips><a href=/tags/performance/ class=w-chip>Performance</a> <a href=/tags/service-worker/ class=w-chip>Service Worker</a> <a href=/tags/case-study/ class=w-chip>Case Study</a></div><div class="w-mb--l w-mt--l w-post-github-link"><span class=w-mr--sm>Last updated: <time>Jun 20, 2019</time> </span><a href=https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/google-search-sw/index.md>Improve article</a></div><web-feedback additional-questions=""></web-feedback></div><nav class=w-article-navigation><a href=/blog class="gc-analytics-event w-article-navigation__link w-article-navigation__link--back w-article-navigation__link--single" data-category=web.dev data-label="navigation, go back" data-action=click>Return to all articles</a></nav></div></div></main><footer class=w-footer><nav class=w-footer__linkboxes><ul class=w-footer__linkboxes-list><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Contribute</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title=" class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">File a bug</a></li><li class=w-footer__linkbox-item><a href=https://github.com/googlechrome/web.dev class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">View source</a></li></ul></li><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Related content</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href=https://blog.chromium.org/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">Chrome updates</a></li><li class=w-footer__linkbox-item><a href=https://developers.google.com/web/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">Web Fundamentals</a></li><li class=w-footer__linkbox-item><a href=https://developers.google.com/web/showcase/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">Case studies</a></li><li class=w-footer__linkbox-item><a href=https://devwebfeed.appspot.com/ class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">DevWeb Content Firehose</a></li><li class=w-footer__linkbox-item><a href=/podcasts/ class=w-footer__linkbox-link data-category=Podcasts data-label="Footer Link (index 5)">Podcasts</a></li><li class=w-footer__linkbox-item><a href=/shows/ class=w-footer__linkbox-link data-category=Shows data-label="Footer Link (index 6)">Shows</a></li></ul></li><li class=w-footer__linkbox><h3 class=w-footer__linkbox-heading>Connect</h3><ul class=w-footer__linkbox-list><li class=w-footer__linkbox-item><a href=https://www.twitter.com/ChromiumDev class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">Twitter</a></li><li class=w-footer__linkbox-item><a href=https://www.youtube.com/user/ChromeDevelopers class=w-footer__linkbox-link data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">YouTube</a></li></ul></li></ul></nav><div class=w-footer__utility><nav class=w-footer__utility-nav><a href=https://developers.google.com/ class=w-footer__utility-logo-link data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link"><img alt="Google Developers" height=33 src=/images/lockup-color.png width=185 class=w-footer__utility-logo loading=lazy></a><ul class=w-footer__utility-list><li class=w-footer__utility-item><a href=https://developer.chrome.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">Chrome</a></li><li class=w-footer__utility-item><a href=https://firebase.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Firebase Link">Firebase</a></li><li class=w-footer__utility-item><a href=https://cloud.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Google Cloud Platform Link">Google Cloud Platform</a></li><li class=w-footer__utility-item><a href=https://developers.google.com/products class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer All products Link">All products</a></li></ul><web-language-select current=en></web-language-select></nav><nav class=w-footer__utility-nav><ul class=w-footer__utility-list><li class=w-footer__utility-item><a href=https://policies.google.com/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Terms and Privacy link">Terms & Privacy</a></li><li class=w-footer__utility-item><a href=/community-guidelines/ class=w-footer__utility-link data-category="Site-Wide Custom Events" data-label="Footer Community Guidelines link">Community Guidelines</a></li></ul><div class=w-footer__license><p>Except as otherwise noted, the content of this page is licensed under the <a href=https://creativecommons.org/licenses/by/4.0/ >Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href=https://www.apache.org/licenses/LICENSE-2.0>Apache 2.0 License</a>. For details, see the <a href=https://developers.google.com/terms/site-policies>Google Developers Site Policies</a>.</p></div></nav></div></footer></body></html>