<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Counting Bloom Filter | Programming.Guide</title>
    <link href="css/base.css" rel="stylesheet" />
    <link href="favicon.ico" rel="icon" />
    <meta
      content="A counting Bloom filter is a Bloom filter that uses counters instead of bits. It shares many of the properties of regular Bloom filters: Insertions and lookups run in constant time, and lookups may give false positives."
      name="description"
    />
    <meta
      content="bloom filter, counting bloom filter, deletion, hash, example, counting"
      name="keywords"
    />
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-62262792-2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-62262792-2");
    </script>
    <script>
      /**
       * https://support.google.com/analytics/answer/1136920?hl=en
       *
       * Function that tracks a click on an outbound link in Analytics.
       * This function takes a valid URL string as an argument, and uses that URL string
       * as the event label. Setting the transport method to 'beacon' lets the hit be sent
       * using 'navigator.sendBeacon' in browser that support it.
       */
      var trackOutboundLink = function (url) {
        ga("send", "event", "outbound", "click", url, {
          transport: "beacon",
          hitCallback: function () {
            document.location = url;
          },
        });
      };
    </script>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
    ></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1475100101081278",
        enable_page_level_ads: true,
      });
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="cookieconsent.min.js"></script>
    <script>
      window.addEventListener("load", function () {
        window.cookieconsent.initialise({
          palette: {
            popup: {
              background: "#006699",
            },
            button: {
              background: "#cccccc",
            },
          },
          theme: "classic",
          dismissOnScroll: 200,
          dismissOnWindowClick: true,
          content: {
            message:
              "By interacting with this site you approve the use of cookies.",
            href: "/terms-and-conditions.html",
          },
        });
      });
    </script>
    <link href="css/go-highlighting.css" rel="stylesheet" />
  </head>
  <body>
    <header>
      <div class="ad">
        <script
          async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
        ></script>
        <ins
          class="adsbygoogle"
          data-ad-client="ca-pub-1475100101081278"
          data-ad-format="link"
          data-ad-slot="6424388494"
          data-full-width-responsive="true"
          style="display: block"
        ></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
    </header>
    <main>
      <aside id="primary-aside">
        <div class="ad">
          <script
            async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
          ></script>
          <ins
            class="adsbygoogle"
            data-ad-client="ca-pub-1475100101081278"
            data-ad-format="auto"
            data-ad-slot="4885566806"
            data-full-width-responsive="true"
            style="display: block"
          ></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
        <h2>Resources</h2>
        <div style="margin-bottom: 1em">
          <a href="bloom-filter.html">Bloom Filter</a><br />
          <span style="color: grey; font-style: italic; font-size: smaller"
            >Programming.Guide</span
          >
        </div>
        <div style="margin-bottom: 1em">
          <a href="https://en.wikipedia.org/wiki/Counting_Bloom_filter"
            >Counting Bloom filter</a
          ><br />
          <span style="color: grey; font-style: italic; font-size: smaller"
            >Wikipedia</span
          >
        </div>
        <h2>Top Algorithm Articles</h2>
        <ol class="nostyle">
          <li>
            <a href="dynamic-programming-vs-memoization-vs-tabulation.html"
              >Dynamic programming vs memoization vs tabulation</a
            >
          </li>
          <li>
            <a href="big-o-notation-explained.html">Big O notation explained</a>
          </li>
          <li>
            <a href="sliding-window-example.html"
              >Sliding Window Algorithm with Example</a
            >
          </li>
          <li>
            <a href="what-makes-a-good-loop-invariant.html"
              >What makes a good loop invariant?</a
            >
          </li>
          <li>
            <a href="random-point-within-circle.html"
              >Generating a random point within a circle (uniformly)</a
            >
          </li>
        </ol>
        <p>
          <a href="algorithms.html"
            ><strong>See all algorithm articles</strong></a
          >
        </p>
      </aside>
      <aside id="secondary-aside">
        <div class="ad">
          <script
            async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
          ></script>
          <ins
            class="adsbygoogle"
            data-ad-client="ca-pub-1475100101081278"
            data-ad-format="auto"
            data-ad-slot="6240200444"
            data-full-width-responsive="true"
            style="display: block"
          ></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
        <h2>Top Java Articles</h2>
        <ol class="nostyle">
          <li>
            <a href="java/do-interfaces-inherit-from-object.html"
              >Do interfaces inherit from Object?</a
            >
          </li>
          <li>
            <a href="java/executing-code-in-comments.html"
              >Executing code in comments?!</a
            >
          </li>
          <li>
            <a href="java/functional-interfaces.html">Functional Interfaces</a>
          </li>
          <li>
            <a href="java/handling-interrupted-exceptions.html"
              >Handling InterruptedException</a
            >
          </li>
          <li>
            <a href="java/why-wait-must-be-in-synchronized.html"
              >Why wait must be called in a synchronized block</a
            >
          </li>
        </ol>
        <p>
          <a href="java/index.html"><strong>See all Java articles</strong></a>
        </p>
      </aside>
      <article>
        <h1>Counting Bloom Filter</h1>
        <p>
          A counting Bloom filter is a
          <a href="bloom-filter.html">Bloom filter</a> that uses
          <strong>counters instead of bits</strong>. It shares many of the
          properties of regular Bloom filters: Insertions and lookups run in
          constant time, and lookups may give false positives. In addition
          counting Bloom filters…
        </p>
        <ul>
          <li>
            …can store multiple copies of the same element (be used as a
            <strong>multiset</strong>)
          </li>
          <li>
            …can <strong>delete elements</strong> (by "undoing" insertions)
          </li>
          <li>…consumes <strong>more memory</strong></li>
        </ul>
        <div
          style="
            text-align: center;
            margin: 3em 0em;
            width: 100%;
            display: table;
          "
        >
          <div style="display: table-row">
            <div style="display: table-cell">
              <object
                data="bloom-filter/switches.svg"
                style="max-height: 15em; margin-bottom: 1em"
                type="image/svg+xml"
              ></object>
            </div>
            <div style="display: table-cell">
              <object
                data="bloom-filter/counters.svg"
                style="max-height: 15em; margin-bottom: 1em"
                type="image/svg+xml"
              ></object>
            </div>
          </div>
          <div style="display: table-row">
            <div style="display: table-cell; padding-right: 1em">
              Regular Bloom Filter
            </div>
            <div style="display: table-cell; padding-left: 1em">
              Counting Bloom Filter
            </div>
          </div>
        </div>
        <h2>Insertion &amp; Lookup</h2>
        <p>
          Insertion is done by <strong>incrementing counters</strong> (instead
          of just setting bits).
        </p>
        <p>
          Lookup can either just check that all counters associated with an
          element are greater than zero, or more generally, take a
          <strong>threshold</strong> as an extra argument and check that all
          counters are greater than or equal to that threshold.
        </p>
        <h2>False Positives and False Negatives</h2>
        <p>
          Just as with regular Bloom filters, a counting Bloom filter can report
          false positives. Adding “foo” and “bar” three times each, could for
          example make it look like “baz” has been added three times.
        </p>
        <p>
          Similarly to how standard Bloom filters never report false negatives,
          a counting Bloom filter would be able to say with certainty that “baz”
          has <em>not</em> been added more than three times.
        </p>
        <h2>Deleting Elements</h2>
        <p>
          A regular Bloom filters does not support deletion of elements. Two
          elements could have overlapping indexes in the bit vector, which mean
          that resetting the bits for one element would cause false negatives
          during subsequent lookups of the other element.
        </p>
        <p>
          In a counting Bloom filter however, deletion can be implemented by
          <strong>decrementing counters</strong>.
        </p>
        <div class="article-box">
          <p>
            The reason counting Bloom filters can undo insertions is that
            <strong
              >the operations of incrementing and decrementing counters
              commute</strong
            >: For example, [+1, +1, −1], gives the same end result as [+1, −1,
            +1]. The operations of regular Bloom filters, setting and unsetting
            bits do not commute: [set bit, set bit, unset bit] does
            <em>not</em> given the same result as [set bit, unset bit, set bit].
          </p>
        </div>
        <p>
          One caveat here is that you may only delete an element that has
          previously been inserted. Or, more precisely, insertions and deletions
          of an element must be balanced in the same way as parentheses are
          balanced in an expression.
        </p>
        <h2>Maxing out a counter</h2>
        <p>
          When a counter reaches its maximum value, trying to increment it
          further will have no effect. If the filter is implemented in a way
          such that the insertion still goes through, the operations no longer
          commute and semantics will start to sway:
        </p>
        <ul>
          <li>
            Lookups with thresholds may start to report false negatives. If
            “foo” is added 10 times but some counter maxed out after 5, the
            lookup function with a given threshold of 7 may respond with
            <em
              >No, element “foo” has definitely not been added more than 7
              times!</em
            >
          </li>
          <li>
            Deletions may start to misbehave. If you add “foo” 10 times but a
            counter maxed out after 5, and you try to delete “foo” 10 times, you
            might inadvertedly delete unrelated elements.
          </li>
        </ul>
        <p>
          To avoid this, you can let insertions fail whenever an attempt is made
          to increment an already maxed out counter. Another alternative is to
          dynamically allocate more memory. Create a new vector with the same
          number of counters, but with one additional bit per counter
          (effectively doubling the range of each counter), and copy over the
          values from the old vector to the new.
        </p>
        <h2>How large counters to allocate?</h2>
        <p>
          In practice there's always a memory constraint, and how large counters
          to allocate becomes a tradeoff:
        </p>
        <div class="article-box">
          <div style="width: 90%; margin: 0em auto">
            <div
              style="
                display: flex;
                justify-content: space-between;
                text-align: center;
              "
            >
              <div style="width: 40%">Small counters</div>
              <div style="width: 40%">Large counters</div>
            </div>
            <div style="display: flex; text-align: center; margin: 0.8em 0em">
              <div
                style="
                  flex-grow: 0;
                  width: 30px;
                  background-repeat: no-repeat;
                  background-position-x: right;
                  background-position-y: center;
                  background-image: url('data:image/svg+xml;utf8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;30px&quot; height=&quot;20px&quot; viewBox=&quot;0 -10 30 20&quot;&gt;&lt;line x1=&quot;5&quot; y1=&quot;0&quot; x2=&quot;30&quot; y2=&quot;0&quot; stroke=&quot;black&quot; /&gt;&lt;path d=&quot;M 0,0 l 25,-8 q -10,8 0,16 l -25,-8&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;');
                "
              >
                &nbsp;
              </div>
              <div
                style="
                  flex-grow: 1;
                  background-repeat: repeat-x;
                  background-position-y: center;
                  background-image: url('data:image/svg+xml;utf8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;20px&quot; height=&quot;20px&quot; viewBox=&quot;0 -10 20 20&quot;&gt;&lt;line x1=&quot;5&quot; x2=&quot;5&quot; y1=&quot;-3&quot; y2=&quot;3&quot; stroke=&quot;black&quot;/&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke=&quot;black&quot; /&gt;&lt;/svg&gt;');
                "
              ></div>
              <div
                style="
                  flex-grow: 0;
                  width: 30px;
                  background-repeat: no-repeat;
                  background-position-x: left;
                  background-position-y: center;
                  background-image: url('data:image/svg+xml;utf8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;30px&quot; height=&quot;20px&quot; viewBox=&quot;0 -10 30 20&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;15&quot; y2=&quot;0&quot; stroke=&quot;black&quot; /&gt;&lt;path d=&quot;M 30,0 l -25,-8 q 10,8 0,16 l 25,-8&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;');
                "
              >
                &nbsp;
              </div>
            </div>
            <div style="display: flex; justify-content: space-between">
              <div style="width: 40%">
                More counters which means fewer collisions and fewer false
                positives.
              </div>
              <div style="width: 40%">
                Longer before counters max out, i.e. more ressilient to problems
                due to collisions.
              </div>
            </div>
          </div>
        </div>
        <p>A common choice is to use 3 or 4 bits per counter.</p>
        <div>
          <h2>Comments</h2>
          <div style="margin-bottom: 1.5em">Be the first to comment!</div>
          <form
            action="https://programming.guide/_comments/add-comment"
            method="post"
          >
            <input
              name="reply_to"
              type="hidden"
              value="counting-bloom-filter.html"
            />
            <textarea name="text" placeholder="Comment"></textarea>
            <input name="author" placeholder="Name" type="text" />
            <input
              name="email"
              placeholder="E-mail (will not be published)"
              type="text"
            />
            <input type="submit" value="Submit" />
          </form>
        </div>
      </article>
    </main>
    <footer>
      © 2016–2021 Programming.Guide,
      <a
        href="terms-and-conditions.html"
        style="color: inherit; text-decoration: underline"
        >Terms&nbsp;and&nbsp;Conditions</a
      >
    </footer>
    <script>
      // Copied from http://blog.dynamicdrive.com/detecting-adblock-on-your-site-and-logging-it-to-google-analytics/
      var test = document.createElement("div");
      test.innerHTML = "&nbsp;";
      test.className = "adsbox";
      document.body.appendChild(test);
      window.setTimeout(function () {
        if (test.offsetHeight === 0) {
          ga("send", "event", "Ad Setting", "Adblock", "Enabled");
        }
        test.remove();
      }, 400);
    </script>
  </body>
</html>
