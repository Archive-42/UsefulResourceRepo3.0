<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>
      The most copied StackOverflow snippet of all time is flawed! |
      Programming.Guide
    </title>
    <link href="css/base.css" rel="stylesheet" />
    <link href="favicon.ico" rel="icon" />
    <meta
      content="In a recent study titled Usage and Attribution of Stack Overflow Code Snippets in GitHub Projects, an answer I wrote almost a decade ago was found to be the most copied snippet on Stack Overflow. Ironically it happens to be buggy."
      name="description"
    />
    <meta
      content="bug, floating point, stackoverflow, copy paste"
      name="keywords"
    />
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-62262792-2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-62262792-2");
    </script>
    <script>
      /**
       * https://support.google.com/analytics/answer/1136920?hl=en
       *
       * Function that tracks a click on an outbound link in Analytics.
       * This function takes a valid URL string as an argument, and uses that URL string
       * as the event label. Setting the transport method to 'beacon' lets the hit be sent
       * using 'navigator.sendBeacon' in browser that support it.
       */
      var trackOutboundLink = function (url) {
        ga("send", "event", "outbound", "click", url, {
          transport: "beacon",
          hitCallback: function () {
            document.location = url;
          },
        });
      };
    </script>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
    ></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1475100101081278",
        enable_page_level_ads: true,
      });
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="cookieconsent.min.js"></script>
    <script>
      window.addEventListener("load", function () {
        window.cookieconsent.initialise({
          palette: {
            popup: {
              background: "#006699",
            },
            button: {
              background: "#cccccc",
            },
          },
          theme: "classic",
          dismissOnScroll: 200,
          dismissOnWindowClick: true,
          content: {
            message:
              "By interacting with this site you approve the use of cookies.",
            href: "/terms-and-conditions.html",
          },
        });
      });
    </script>
    <link href="css/go-highlighting.css" rel="stylesheet" />
  </head>
  <body>
    <header>
      <div class="ad">
        <script
          async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
        ></script>
        <ins
          class="adsbygoogle"
          data-ad-client="ca-pub-1475100101081278"
          data-ad-format="link"
          data-ad-slot="6424388494"
          data-full-width-responsive="true"
          style="display: block"
        ></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
    </header>
    <main>
      <aside id="primary-aside">
        <div class="ad">
          <script
            async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
          ></script>
          <ins
            class="adsbygoogle"
            data-ad-client="ca-pub-1475100101081278"
            data-ad-format="auto"
            data-ad-slot="4885566806"
            data-full-width-responsive="true"
            style="display: block"
          ></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
        <h2>Related</h2>
        <div style="margin-bottom: 1em">
          <a href="java/formatting-byte-size-to-human-readable-format.html"
            >Java: Formatting byte size to human readable format</a
          ><br />
          <span style="color: grey; font-style: italic; font-size: smaller"
            >Programming.Guide</span
          >
        </div>
        <div style="margin-bottom: 1em">
          <a href="https://stackoverflow.com/q/3758606/276052"
            >How to convert byte size into human readable format in java?</a
          ><br />
          <span style="color: grey; font-style: italic; font-size: smaller"
            >Stack Overflow</span
          >
        </div>
        <div style="margin-bottom: 1em">
          <a
            href="https://empirical-software.engineering/assets/pdf/emse18-snippets.pdf"
            >Usage and Attribution of Stack Overflow Code Snippets in GitHub
            Projects</a
          >
          (pdf)<br />
          <span style="color: grey; font-style: italic; font-size: smaller"
            >by Sebastian Baltes, Stephan Diehl</span
          >
        </div>
        <h2>Top Algorithm Articles</h2>
        <ol class="nostyle">
          <li>
            <a href="dynamic-programming-vs-memoization-vs-tabulation.html"
              >Dynamic programming vs memoization vs tabulation</a
            >
          </li>
          <li>
            <a href="big-o-notation-explained.html">Big O notation explained</a>
          </li>
          <li>
            <a href="sliding-window-example.html"
              >Sliding Window Algorithm with Example</a
            >
          </li>
          <li>
            <a href="what-makes-a-good-loop-invariant.html"
              >What makes a good loop invariant?</a
            >
          </li>
          <li>
            <a href="random-point-within-circle.html"
              >Generating a random point within a circle (uniformly)</a
            >
          </li>
        </ol>
        <p>
          <a href="algorithms.html"
            ><strong>See all algorithm articles</strong></a
          >
        </p>
      </aside>
      <aside id="secondary-aside">
        <div class="ad">
          <script
            async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
          ></script>
          <ins
            class="adsbygoogle"
            data-ad-client="ca-pub-1475100101081278"
            data-ad-format="auto"
            data-ad-slot="6240200444"
            data-full-width-responsive="true"
            style="display: block"
          ></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
        <h2>Top Java Articles</h2>
        <ol class="nostyle">
          <li>
            <a href="java/do-interfaces-inherit-from-object.html"
              >Do interfaces inherit from Object?</a
            >
          </li>
          <li>
            <a href="java/executing-code-in-comments.html"
              >Executing code in comments?!</a
            >
          </li>
          <li>
            <a href="java/functional-interfaces.html">Functional Interfaces</a>
          </li>
          <li>
            <a href="java/handling-interrupted-exceptions.html"
              >Handling InterruptedException</a
            >
          </li>
          <li>
            <a href="java/why-wait-must-be-in-synchronized.html"
              >Why wait must be called in a synchronized block</a
            >
          </li>
        </ol>
        <p>
          <a href="java/index.html"><strong>See all Java articles</strong></a>
        </p>
      </aside>
      <article>
        <h1>The most copied StackOverflow snippet of all time is flawed!</h1>
        <p><span style="color: #999">by Andreas Lundblad, 2019-12-02</span></p>
        <p>
          <strong
            >In a recent study titled
            <em
              >Usage and Attribution of Stack Overflow Code Snippets in GitHub
              Projects</em
            >, an
            <a href="https://stackoverflow.com/a/3758880/276052">answer</a> I
            wrote almost a decade ago was found to be the most copied snippet on
            Stack Overflow. Ironically it happens to be buggy.</strong
          >
        </p>
        <h2>A Long Long Time Ago…</h2>
        <p>
          Back in 2010 I was sitting in my office and doing what I wasn’t
          supposed to be doing: code golfing and chasing reputation on Stack
          Overflow.
        </p>
        <p>
          The following question got my attention: How do you print a byte count
          in a human readable format? That is, how do you format something like
          123,456,789 bytes as “123.5&nbsp;MB”.
        </p>
        <div style="text-align: center; margin: 2em">
          <a href="https://stackoverflow.com/q/3758606/276052"
            ><img
              alt="How to convert byte size into human-readable format in Java? Like 1024 should become '1 Kb' and 1024*1024 should become '1 Mb'."
              class="screenshot"
              src="the-most-copied-so-snippet/so-screenshot.png"
              style="width: 100%"
          /></a>
          <div class="caption">
            <p>
              The good ol’ 2010 look, courtesy the
              <a href="https://archive.org/web/">Wayback Machine</a>.
            </p>
          </div>
        </div>
        <p>
          The implicit spec here is that the resulting string should have a
          value between 1 and 999.9 followed by a suffix with an appropriate
          magnitude.
        </p>
        <p>
          One answer had already been posted. The code in that answer was based
          on a loop. The idea was simple: Try all magnitudes, going from the
          largest (EB = 10<sup>18</sup> bytes) down to the smallest (B = 1 byte)
          and use the first one that is smaller than the number of bytes. In
          pseudo code it looks something like this:
        </p>
        <pre><code>suffixes   = [ <span class="text_lit">"EB"</span>, <span class="text_lit">"PB"</span>, <span class="text_lit">"TB"</span>, <span class="text_lit">"GB"</span>, <span class="text_lit">"MB"</span>, <span class="text_lit">"kB"</span>, <span class="text_lit">"B"</span> ]
magnitudes = [ <span class="num_lit" style="display: inline-block; width: 4ch; text-align: right;">10<sup>18</sup></span>, <span class="num_lit" style="display: inline-block; width: 4ch; text-align: right;">10<sup>15</sup></span>, <span class="num_lit" style="display: inline-block; width: 4ch; text-align: right;">10<sup>12</sup></span>, <span class="num_lit" style="display: inline-block; width: 4ch; text-align: right;">10<sup>9</sup></span>, <span class="num_lit" style="display: inline-block; width: 4ch; text-align: right;">10<sup>6</sup></span>, <span class="num_lit" style="display: inline-block; width: 4ch; text-align: right;">10<sup>3</sup></span>, <span class="num_lit" style="display: inline-block; width: 3ch; text-align: right;">10<sup>0</sup></span> ]
i = <span class="num_lit">0</span>
<span class="keyword">while</span> (i &lt; magnitudes.length &amp;&amp; magnitudes[i] &gt; byteCount)
    i++
printf(<span class="text_lit">"%.1f %s"</span>, byteCount / magnitudes[i], suffixes[i])
</code></pre>
        <p>
          Usually when there’s a correct answer posted that already has a
          positive score, it’s hard to catch up with it. In Stack Overflow lingo
          it’s referred to as the
          <a href="https://meta.stackexchange.com/q/9731/147319"
            >Fastest Gun in the West Problem</a
          >. In this case the existing answer had a few flaws, so I still saw an
          opportunity to top it. At the very least, the loop based code could be
          cleaned up significantly.
        </p>
        <h2>This is Algebra, I know this!</h2>
        <p>
          Then it hit me. The kB, MB, GB,&nbsp;… suffixes are nothing but powers
          of 1000 (or 1024 in
          <a href="https://en.wikipedia.org/wiki/Binary_prefix">IEC standard</a
          >) which means it should be possible to compute the right suffix using
          logarithms instead of a loop.
        </p>
        <p>Based on this idea, I posted the following:</p>
        <pre><code class="dynamic-font-size"><span class="keyword">public</span> <span class="keyword">static</span> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a> <span class="static_method">humanReadableByteCount</span>(<span class="keyword">long</span> <span class="type">bytes</span>, <span class="keyword">boolean</span> <span class="type">si</span>) {
    <span class="keyword">int</span> <span class="type">unit</span> = <span class="type">si</span> ? <span class="num_lit">1000</span> : <span class="num_lit">1024</span>;
    <span class="keyword">if</span> (<span class="type">bytes</span> &lt; <span class="type">unit</span>) <span class="keyword">return</span> <span class="type">bytes</span> + <span class="text_lit">" B"</span>;
    <span class="keyword">int</span> <span class="type">exp</span> = (<span class="keyword">int</span>) (<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#log(double)"><span class="static_method">log</span></a>(<span class="type">bytes</span>) / <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#log(double)"><span class="static_method">log</span></a>(<span class="type">unit</span>));
    <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a> <span class="type">pre</span> = (<span class="type">si</span> ? <span class="text_lit">"kMGTPE"</span> : <span class="text_lit">"KMGTPE"</span>).<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#charAt(int)"><span class="method">charAt</span></a>(<span class="type">exp</span>-<span class="num_lit">1</span>) + (<span class="type">si</span> ? <span class="text_lit">""</span> : <span class="text_lit">"i"</span>);
    <span class="keyword">return</span> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#format(java.lang.String,java.lang.Object:A)"><span class="static_method">format</span></a>(<span class="text_lit">"%.1f %sB"</span>, <span class="type">bytes</span> / <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#pow(double,double)"><span class="static_method">pow</span></a>(<span class="type">unit</span>, <span class="type">exp</span>), <span class="type">pre</span>);
}</code></pre>
        <p>
          Granted it’s not very readable and
          <span class="no-wrap">log / pow</span> probably makes it less
          efficient than other solutions. But there were no loops and almost no
          branching which I thought was pretty neat.
        </p>
        <div class="article-box">
          <p>
            <strong>The math behind this</strong> is straight forward. The byte
            count is expressed as
            <span class="no-wrap"
              >byteCount = 1000<sup><em>s</em></sup></span
            >
            where <em>s</em> represents the scale. (For binary notation, base
            1024 is used.) Solving for <em>s</em> gives
            <span class="no-wrap"
              ><em>s</em> = log<sub>1000</sub>(byteCount)</span
            >.
          </p>
          <p>
            There’s no log<sub>1000</sub> readily available in the API, but we
            can express it in terms of the natural logarithm as follows
            <span class="no-wrap"><em>s</em> = log(byteCount) / log(1000)</span
            >. We then floor <em>s</em> (cast to int) since if we for example
            have more than one megabyte (but not a full gigabyte) we want to use
            MB as magnitude.
          </p>
          <p>
            At this point if <span class="no-wrap"><em>s</em> = 1</span> the
            scale is kilobytes, if
            <span class="no-wrap"><em>s</em> = 2</span> the scale is megabytes,
            and so on. We divide the byteCount with 1000<sup><em>s</em></sup>
            and slap on the corresponding letter prefix.
          </p>
        </div>
        <p>
          All I could do now was to wait and see if the community would
          appreciate the answer. Little did I know that this would become the
          most copied snippet on Stack Overflow.
        </p>
        <h2>A Study on Attribution</h2>
        <p>
          Fast forward to 2018. A PhD student by the name Sebastian Baltes
          publishes a paper in the journal of
          <em>Empirical Software Engineering</em>. The title is
          <a href="https://doi.org/10.1007/s10664-018-9650-5"
            ><em
              >Usage and Attribution of Stack Overflow Code Snippets in GitHub
              Projects</em
            ></a
          >
          and it basically tries to answer one question: Is Stack Overflow’s CC
          BY-SA 3.0 license respected? I.e. to what extent is proper attribution
          given, when copying code from Stack Overflow.
        </p>
        <p>
          As part of their analysis they extracted code snippets from the
          <a href="https://archive.org/details/stackexchange"
            >Stack Overflow data dump</a
          >
          and matched them against code from public GitHub repos. Quoting the
          abstract:
        </p>
        <blockquote>
          <p>
            <em
              >We present results of a large-scale empiricalstudy analyzing the
              usage and attribution of non-trivial Java code snippetsfrom SO
              answers in public GitHub (GH) projects.</em
            >
          </p>
        </blockquote>
        <p>
          (Spoiler alert: No, most people do not include proper attribution.)
        </p>
        <p>In the paper, they include the following table:</p>
        <div style="text-align: center; margin: 1em 0em">
          <object
            data="the-most-copied-so-snippet/table-tear.svg"
            style="max-width: 100%"
            type="image/svg+xml"
          ></object>
        </div>
        <p>
          That answer at the top with id
          <a href="https://stackoverflow.com/a/3758880/276052">3758880</a>
          happens to be the answer I had posted eight years earlier. At this
          point the answer had over a hundreds of thousands of views and over a
          thousand upvotes.
        </p>
        <p>
          A quick search on GitHub indeed shows thousands of occurrences of
          <code>humanReadableByteCount</code>.
        </p>
        <p>
          <img
            class="screenshot"
            src="the-most-copied-so-snippet/github-search.png"
            style="margin: 2em 0em"
          />
        </p>
        <p>
          To check if you happen to have the code in a locally checked out repo:
        </p>
        <pre><code>$ git grep humanReadableByteCount
</code></pre>
        <div class="article-box">
          <p>
            <strong>Fun side story:</strong> How did I first hear about this
            study?
          </p>
          <p>
            Sebastian had found a match in the OpenJDK repository. There was no
            attribution and the OpenJDK license is not compatible with CC BY-SA
            3.0. He
            <a
              href="http://mail.openjdk.java.net/pipermail/jdk9-dev/2016-December/005327.html"
              >reached out to the dev mailing list</a
            >
            asking if the code on Stack Overflow was copied from OpenJDK, or if
            it was the other way around.
          </p>
          <p>
            The funny part here is that I used to work at Oracle, on the OpenJDK
            project, so a former colleague and friend of mine
            <a
              href="http://mail.openjdk.java.net/pipermail/jdk9-dev/2016-December/005328.html"
              >replied</a
            >
            with the following:
          </p>
          <div class="indented" style="font-style: italic">
            <p>Hi,</p>
            <p>
              why not ask the author of this SO post (aioobe) directly? He is an
              OpenJDK contributor and was employed by Oracle at the time this
              code appeared in the OpenJDK source repos.
            </p>
            <p>/Claes</p>
          </div>
          <p>
            Oracle doesn’t take these things lightly. I happen to know that some
            people at Oracle took a sigh of relief when they read this reply,
            and saw it as a bit of a triumph after the “accusation”.
          </p>
          <p>
            Sebastian then reached out to me to straighten it out, which I did:
            I had <em>not</em> yet started at Oracle when that commit was
            merged, and I did <em>not</em> contribute that patch. Jokes on
            Oracle. Shortly after, an issue was
            <a href="https://bugs.openjdk.java.net/browse/JDK-8170860">filed</a>
            and the code was
            <a
              href="http://hg.openjdk.java.net/jdk9/jdk9/hotspot/rev/b552b596203f"
              >removed</a
            >.
          </p>
        </div>
        <h2>The Bug</h2>
        <p>
          I bet you’ve already given it some thought. What is that bug in the
          code snippet?
        </p>
        <p>Here it is again:</p>
        <pre><code class="dynamic-font-size"><span class="keyword">public</span> <span class="keyword">static</span> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a> <span class="static_method">humanReadableByteCount</span>(<span class="keyword">long</span> <span class="type">bytes</span>, <span class="keyword">boolean</span> <span class="type">si</span>) {
    <span class="keyword">int</span> <span class="type">unit</span> = <span class="type">si</span> ? <span class="num_lit">1000</span> : <span class="num_lit">1024</span>;
    <span class="keyword">if</span> (<span class="type">bytes</span> &lt; <span class="type">unit</span>) <span class="keyword">return</span> <span class="type">bytes</span> + <span class="text_lit">" B"</span>;
    <span class="keyword">int</span> <span class="type">exp</span> = (<span class="keyword">int</span>) (<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#log(double)"><span class="static_method">log</span></a>(<span class="type">bytes</span>) / <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#log(double)"><span class="static_method">log</span></a>(<span class="type">unit</span>));
    <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a> <span class="type">pre</span> = (<span class="type">si</span> ? <span class="text_lit">"kMGTPE"</span> : <span class="text_lit">"KMGTPE"</span>).<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#charAt(int)"><span class="method">charAt</span></a>(<span class="type">exp</span>-<span class="num_lit">1</span>) + (<span class="type">si</span> ? <span class="text_lit">""</span> : <span class="text_lit">"i"</span>);
    <span class="keyword">return</span> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#format(java.lang.String,java.lang.Object:A)"><span class="static_method">format</span></a>(<span class="text_lit">"%.1f %sB"</span>, <span class="type">bytes</span> / <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#pow(double,double)"><span class="static_method">pow</span></a>(<span class="type">unit</span>, <span class="type">exp</span>), <span class="type">pre</span>);
}</code></pre>
        <p>
          After exabytes, 10<sup>18</sup>, comes zettabytes, 10<sup>21</sup>.
          Could it be that a really large input causes an index out of bounds on
          the <code>"kMGTPE"</code> string? Nope. The maximum
          <code>long</code> value is
          <span class="no-wrap">2<sup>63</sup> - 1 ≈ 9.2 × 10<sup>18</sup></span
          >, so no <code>long</code> value will ever go beyond EB.
        </p>
        <p>
          Could it be a mix-up between SI and binary? Nope. There was a mix-up
          in an early version of the answer, but that was fixed rather quickly.
        </p>
        <p>
          Can <code>exp</code> end up being 0 causing
          <code>charAt(exp-1)</code> to fail? Nope. The first if-statement
          covers that case. The <code>exp</code> value will always be at least
          1.
        </p>
        <p>
          Could there be some weird rounding error in the output? Now we’re
          getting there…
        </p>
        <h2>Lots of 9’s</h2>
        <p>
          The solution works all the way up until it approaches 1 MB. When given
          999,999 bytes as input, the result (in SI mode) is
          <code>"1000.0 kB"</code>. While it is true that 999,999 is closer to
          <span class="no-wrap">1,000 × 1000<sup>1</sup></span> than it is to
          <span class="no-wrap">999.9 × 1000<sup>1</sup></span
          >, the 1,000 “significand” is out of range according to spec. The
          correct result is <code>"1.0 MB"</code>.
        </p>
        <p>
          FWIW, <em>all</em> 22 answers posted, including the ones using Apache
          Commons and Android libraries, had this bug (or a variation of it) at
          the time of writing this article.
        </p>
        <p>
          So how do we fix this? First of all, we note that the exponent
          (<code>exp</code>) should change from ‘k’ to ‘M’ as soon as the number
          of bytes is closer to
          <span class="no-wrap">1 × 1,000<sup>2</sup></span> (1 MB) than it is
          to <span class="no-wrap">999.9 × 1000<sup>1</sup></span> (999.9 k).
          This happens at 999,950. Similarly, we should switch from ‘M’ to ‘G’
          when we pass 999,950,000 and so on.
        </p>
        <p>
          To achieve this we calculate this threshold and bump
          <code>exp</code> if <code>bytes</code> is larger. (For the binary
          case, this threshold is not an integer, se we need to ceil the
          result.)
        </p>
        <pre><code><span class="keyword">if</span> (<span class="type">bytes</span> &gt;= <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#ceil(double)"><span class="static_method">ceil</span></a>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#pow(double,double)"><span class="static_method">pow</span></a>(<span class="type">unit</span>, <span class="type">exp</span>) * (<span class="type">unit</span> - <span class="num_lit">0.05</span>)))
    <span class="type">exp</span>++;</code></pre>
        <p>
          With this change the code works well all the way up until the byte
          count approaches 1&nbsp;EB.
        </p>
        <h2>Even More 9’s</h2>
        <p>
          Given the input 999,949,999,999,999,999 the result is now
          <code>1000.0 PB</code> while correct result is <code>999.9 PB</code>.
          Mathematically the code is accurate, so what’s going on here?
        </p>
        <p>
          At this point we’re running into the precision limitations of a
          <code>double</code>.
        </p>
        <div class="article-box">
          <h3>Floating Point Arithmetic 101</h3>
          <p>
            Due to the IEEE 754 representation floating point values close to
            zero are very dense, and large values are very sparse. In fact, half
            of all values are found between −1 and 1, and when talking large
            doubles, a value as large as <code>Long.MAX_VALUE</code> means
            nothing. Literally.
          </p>
          <pre><code><span class="keyword">double</span> <span class="type">a</span> = <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Double.html"><span class="type">Double</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Double.html#MAX_VALUE"><span class="static_final_field">MAX_VALUE</span></a>;
<span class="keyword">double</span> <span class="type">b</span> = <span class="type">a</span> - <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html"><span class="type">Long</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html#MAX_VALUE"><span class="static_final_field">MAX_VALUE</span></a>;
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/System.html"><span class="type">System</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/System.html#err"><span class="static_final_field">err</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/PrintStream.html#println(boolean)"><span class="method">println</span></a>(<span class="type">a</span> == <span class="type">b</span>);  <span class="comment">// prints true</span>
</code></pre>
          <p>
            See
            <a href="bits-of-a-floating-point-value.html"
              >Bits of a Floating Point Value</a
            >
            for a deep dive.
          </p>
        </div>
        <p>There are two problematic computations:</p>
        <ul>
          <li>The division in the <code>String.format</code> argument, and</li>
          <li>The threshold for bumping <code>exp</code>.</li>
        </ul>
        <p>
          We could switch to <code>BigDecimal</code>, but where’s the fun in
          that?! Besides, it gets messy anyway because there’s no
          <code>BigDecimal</code> log function in the standard API.
        </p>
        <h3>Scaling down intermediate values</h3>
        <p>
          For the first issue we can scale down the <code>bytes</code> value to
          a range where the the precision is better, and adjust
          <code>exp</code> accordingly. The end result is rounded anyway, so it
          doesn’t matter that we’re throwing out the least significant digits.
        </p>
        <pre><code class="dynamic-font-size"><span class="keyword">if</span> (<span class="type">exp</span> &gt; <span class="num_lit">4</span>) {
    <span class="type">bytes</span> /= <span class="type">unit</span>;
    <span class="type">exp</span>--;
}
</code></pre>
        <h3>Adjusting the least significant bits</h3>
        <p>
          For the second issue, we <em>do</em> care about the least significant
          bits (999,949,99…9 and 999,950,00…0 should end up with different
          exponents) so this issue calls for a different solution.
        </p>
        <p>
          First we note that there are 12 different possible values for the
          threshold (6 for each mode), and only one of them ends up faulty. The
          faulty result can be uniquely identified by the fact that it ends with
          D00<sub>16</sub>. If this is the case we simply adjust it to the
          correct value.
        </p>
        <pre><code class="dynamic-font-size"><span class="keyword">long</span> <span class="type">th</span> = (<span class="keyword">long</span>) <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#ceil(double)"><span class="static_method">ceil</span></a>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#pow(double,double)"><span class="static_method">pow</span></a>(<span class="type">unit</span>, <span class="type">exp</span>) * (<span class="type">unit</span> - <span class="num_lit">0.05</span>));
<span class="keyword">if</span> (<span class="type">exp</span> &lt; <span class="num_lit">6</span> &amp;&amp; <span class="type">bytes</span> &gt;= <span class="type">th</span> - ((<span class="type">th</span> &amp; <span class="num_lit">0xFFF</span>) == <span class="num_lit">0xD00</span> ? <span class="num_lit">51</span> : <span class="num_lit">0</span>))
    <span class="type">exp</span>++;
</code></pre>
        <p>
          Since we rely on specific bit patterns in floating-point results, we
          slap on <code>strictfp</code> to ensure it works regardless of the
          hardware running the code.
        </p>
        <h2>Negative input</h2>
        <p>
          It’s unclear under what circumstances a negative byte count could be
          relevant, but since Java doesn’t have unsigned <code>long</code>, we
          better deal with it. Right now an input such as −10,000 results in
          <code>-10000 B</code>.
        </p>
        <p>Let’s introduce <code>absBytes</code>:</p>
        <pre><code class="dynamic-font-size"><span class="keyword">long</span> <span class="field">absBytes</span> = <span class="type">bytes</span> == <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html"><span class="type">Long</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html#MIN_VALUE"><span class="static_final_field">MIN_VALUE</span></a> ? <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html"><span class="type">Long</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html#MAX_VALUE"><span class="static_final_field">MAX_VALUE</span></a> : <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#abs(int)"><span class="static_method">abs</span></a>(<span class="type">bytes</span>);
</code></pre>
        <p>
          The complicated expression is due to the fact that
          <code>-Long.MIN_VALUE == Long.MIN_VALUE</code>. Now we perform all
          computations related to <code>exp</code> using
          <code>absBytes</code> instead of <code>bytes</code>.
        </p>
        <h2>Final Version</h2>
        <p>
          Here’s the final version of the code, golfed and compacted in the
          spirit of the original version:
        </p>
        <pre><code class="dynamic-font-size"><span class="comment">// From: https://programming.guide/worlds-most-copied-so-snippet.html</span>
<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">strictfp</span> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a> <span class="static_method">humanReadableByteCount</span>(<span class="keyword">long</span> <span class="type">bytes</span>, <span class="keyword">boolean</span> <span class="type">si</span>) {
    <span class="keyword">int</span> <span class="type">unit</span> = <span class="type">si</span> ? <span class="num_lit">1000</span> : <span class="num_lit">1024</span>;
    <span class="keyword">long</span> <span class="type">absBytes</span> = <span class="type">bytes</span> == <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html"><span class="type">Long</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html#MIN_VALUE"><span class="static_final_field">MIN_VALUE</span></a> ? <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html"><span class="type">Long</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html#MAX_VALUE"><span class="static_final_field">MAX_VALUE</span></a> : <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#abs(long)"><span class="static_method">abs</span></a>(<span class="type">bytes</span>);
    <span class="keyword">if</span> (<span class="type">absBytes</span> &lt; <span class="type">unit</span>) <span class="keyword">return</span> <span class="type">bytes</span> + <span class="text_lit">" B"</span>;
    <span class="keyword">int</span> <span class="type">exp</span> = (<span class="keyword">int</span>) (<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#log(double)"><span class="static_method">log</span></a>(<span class="type">absBytes</span>) / <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#log(double)"><span class="static_method">log</span></a>(<span class="type">unit</span>));
    <span class="keyword">long</span> <span class="type">th</span> = (<span class="keyword">long</span>) <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#ceil(double)"><span class="static_method">ceil</span></a>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#pow(double,double)"><span class="static_method">pow</span></a>(<span class="type">unit</span>, <span class="type">exp</span>) * (<span class="type">unit</span> - <span class="num_lit">0.05</span>));
    <span class="keyword">if</span> (<span class="type">exp</span> &lt; <span class="num_lit">6</span> &amp;&amp; <span class="type">absBytes</span> &gt;= <span class="type">th</span> - ((<span class="type">th</span> &amp; <span class="num_lit">0xFFF</span>) == <span class="num_lit">0xD00</span> ? <span class="num_lit">51</span> : <span class="num_lit">0</span>)) <span class="type">exp</span>++;
    <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a> <span class="type">pre</span> = (<span class="type">si</span> ? <span class="text_lit">"kMGTPE"</span> : <span class="text_lit">"KMGTPE"</span>).<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#charAt(int)"><span class="method">charAt</span></a>(<span class="type">exp</span> - <span class="num_lit">1</span>) + (<span class="type">si</span> ? <span class="text_lit">""</span> : <span class="text_lit">"i"</span>);
    <span class="keyword">if</span> (<span class="type">exp</span> &gt; <span class="num_lit">4</span>) {
        <span class="type">bytes</span> /= <span class="type">unit</span>;
        <span class="type">exp</span> -= <span class="num_lit">1</span>;
    }
    <span class="keyword">return</span> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html"><span class="type">String</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#format(java.lang.String,java.lang.Object:A)"><span class="static_method">format</span></a>(<span class="text_lit">"%.1f %sB"</span>, <span class="type">bytes</span> / <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html"><span class="type">Math</span></a>.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#pow(double,double)"><span class="static_method">pow</span></a>(<span class="type">unit</span>, <span class="type">exp</span>), <span class="type">pre</span>);
}
</code></pre>
        <p>
          Note that this started out as a challenge to avoid loops and excessive
          branching. After ironing out all corner cases the code is even less
          readable than the original version. Personally I would not copy this
          snippet into production code.
        </p>
        <p>
          For <strong>updated code that is of production quality</strong> see
          separate article:
          <a href="java/formatting-byte-size-to-human-readable-format.html"
            >Formatting byte size to human readable format</a
          >
        </p>
        <h2>Key Takeaways</h2>
        <ul>
          <li>
            <p>
              Stack Overflow snippets can be buggy, even if they have thousands
              of upvotes.
            </p>
          </li>
          <li>
            <p>
              Test all edge cases, <em>especially</em> for code copied from
              Stack Overflow.
            </p>
          </li>
          <li>
            <p>Floating-point arithmetic is hard.</p>
          </li>
          <li>
            <p>
              Do include proper attribution when copying code. Someone might
              just call you out on it.
            </p>
          </li>
        </ul>
        <div>
          <h2>Comments (11)</h2>
          <div class="article-comment" id="c1575414054-aveiSoh5">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/d4a2f69d78ee7a7cd0be47f92ad3a114?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>Whoa! What a writeup. Thanks for sharing</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by Nick&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575414054-aveiSoh5"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
            </div>
          </div>
          <div class="article-comment" id="c1575431393-aet3OPhu">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/af0c24a85eac0b47ac8027eb36e11e75?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>This is a really hard problem.</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by Ssuching&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575431393-aet3OPhu"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
            </div>
          </div>
          <div class="article-comment" id="c1575454325-abeCohl4">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/2f86996e30f54a0d42d93e5904b74e8c?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>Brilliant. Attitude too. Thanks a lot.</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by syjmick&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575454325-abeCohl4"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
            </div>
          </div>
          <div class="article-comment" id="c1575455440-sho7Gaey">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/a01d535d38a2fe0aff4a981308915203?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>
                  I think key takeaway here is: prefer short and simple loops
                  over math. As you already said, the math is very hard to get
                  exactly right (so, error prone and hard to read). But I
                  believe it is also at least an order of magnitude slower than
                  the loop-based solution.
                </p>
                <p>Did you run any benchmarks?</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by Ivan&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575455440-sho7Gaey"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
              <div class="article-comment" id="c1575475836-aoeu">
                <div class="article-comment-avatar">
                  <img
                    alt="User avatar"
                    src="https://www.gravatar.com/avatar/99e100243aaa8b1469b1ed4e8bbecb06?d=mp"
                  />
                </div>
                <div class="article-comment-content">
                  <div>
                    <p>
                      In general I agree with you. In this particular case
                      however, one should note that the rounding error, negative
                      input, and floating-point precision problems would apply
                      also to a simple loop solution.
                    </p>
                    <p>
                      I have not done any benchmarking. Would be interesting for
                      sure.
                    </p>
                  </div>
                  <details>
                    <summary class="article-comment-footer">
                      <span style="color: grey"
                        >by Andreas Lundblad&nbsp;|&nbsp;</span
                      >
                      <span class="reply-button">Reply</span>
                    </summary>
                    <form
                      action="https://programming.guide/_comments/add-comment"
                      method="post"
                    >
                      <input
                        name="reply_to"
                        type="hidden"
                        value="1575475836-aoeu"
                      />
                      <textarea name="text" placeholder="Comment"></textarea>
                      <input name="author" placeholder="Name" type="text" />
                      <input
                        name="email"
                        placeholder="E-mail (will not be published)"
                        type="text"
                      />
                      <input type="submit" value="Submit" />
                    </form>
                  </details>
                </div>
              </div>
            </div>
          </div>
          <div class="article-comment" id="c1575468068-Ai0eengu">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/4d400194f4d28fee7487eb826d463d9e?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>This is fantastically done. Thanks for posting this.</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by John Doe&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575468068-Ai0eengu"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
            </div>
          </div>
          <div class="article-comment" id="c1575532582-etha1ahJ">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/a2452b2d1c9315f8cc62c7290c9a26f2?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>
                  This is very interesting article, I worked with floating point
                  but always had difficulty to grasp the special cases of
                  rounding. This article is good academic view of special cases
                  to consider.
                </p>
                <p>Thanks! Five stars for this article. ★★★★★</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by Audiory&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575532582-etha1ahJ"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
            </div>
          </div>
          <div class="article-comment" id="c1575555484-auGh7hai">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/38b8a18199083b31074a90b47810b1ce?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>This article was quite a journey! Thanks :)</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by swiatek7&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575555484-auGh7hai"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
            </div>
          </div>
          <div class="article-comment" id="c1575671337-Il5che5l">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/124aca96dfe03819a6bc6e782e18d006?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>Awesome! Thanks for sharing!</p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by Adam&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575671337-Il5che5l"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
            </div>
          </div>
          <div class="article-comment" id="c1575719090-ohXah7iu">
            <div class="article-comment-avatar">
              <img
                alt="User avatar"
                src="https://www.gravatar.com/avatar/1eaa7f930b2393cba93e21925ca58ab5?d=mp"
              />
            </div>
            <div class="article-comment-content">
              <div>
                <p>
                  Nice article, thanks for sharing this story! So, how is it
                  done in Unix? Some commands like <code>ls</code>,
                  <code>df</code> have the <code>-h</code> human readable
                  option.
                </p>
              </div>
              <details>
                <summary class="article-comment-footer">
                  <span style="color: grey">by IvanV&nbsp;|&nbsp;</span>
                  <span class="reply-button">Reply</span>
                </summary>
                <form
                  action="https://programming.guide/_comments/add-comment"
                  method="post"
                >
                  <input
                    name="reply_to"
                    type="hidden"
                    value="1575719090-ohXah7iu"
                  />
                  <textarea name="text" placeholder="Comment"></textarea>
                  <input name="author" placeholder="Name" type="text" />
                  <input
                    name="email"
                    placeholder="E-mail (will not be published)"
                    type="text"
                  />
                  <input type="submit" value="Submit" />
                </form>
              </details>
              <div class="article-comment" id="c1575732527-aoeu">
                <div class="article-comment-avatar">
                  <img
                    alt="User avatar"
                    src="https://www.gravatar.com/avatar/99e100243aaa8b1469b1ed4e8bbecb06?d=mp"
                  />
                </div>
                <div class="article-comment-content">
                  <div>
                    <p>
                      The implementation for coreutils is found in
                      <a
                        href="https://github.com/coreutils/gnulib/blob/master/lib/human.c"
                        ><code>human.c</code></a
                      >
                    </p>
                  </div>
                  <details>
                    <summary class="article-comment-footer">
                      <span style="color: grey"
                        >by Andreas Lundblad&nbsp;|&nbsp;</span
                      >
                      <span class="reply-button">Reply</span>
                    </summary>
                    <form
                      action="https://programming.guide/_comments/add-comment"
                      method="post"
                    >
                      <input
                        name="reply_to"
                        type="hidden"
                        value="1575732527-aoeu"
                      />
                      <textarea name="text" placeholder="Comment"></textarea>
                      <input name="author" placeholder="Name" type="text" />
                      <input
                        name="email"
                        placeholder="E-mail (will not be published)"
                        type="text"
                      />
                      <input type="submit" value="Submit" />
                    </form>
                  </details>
                </div>
              </div>
            </div>
          </div>
          <h3>Add comment</h3>
          <form
            action="https://programming.guide/_comments/add-comment"
            method="post"
          >
            <input
              name="reply_to"
              type="hidden"
              value="worlds-most-copied-so-snippet.html"
            />
            <textarea name="text" placeholder="Comment"></textarea>
            <input name="author" placeholder="Name" type="text" />
            <input
              name="email"
              placeholder="E-mail (will not be published)"
              type="text"
            />
            <input type="submit" value="Submit" />
          </form>
        </div>
      </article>
    </main>
    <footer>
      © 2016–2021 Programming.Guide,
      <a
        href="terms-and-conditions.html"
        style="color: inherit; text-decoration: underline"
        >Terms&nbsp;and&nbsp;Conditions</a
      >
    </footer>
    <script>
      // Copied from http://blog.dynamicdrive.com/detecting-adblock-on-your-site-and-logging-it-to-google-analytics/
      var test = document.createElement("div");
      test.innerHTML = "&nbsp;";
      test.className = "adsbox";
      document.body.appendChild(test);
      window.setTimeout(function () {
        if (test.offsetHeight === 0) {
          ga("send", "event", "Ad Setting", "Adblock", "Enabled");
        }
        test.remove();
      }, 400);
    </script>
  </body>
</html>
